<!DOCTYPE html>
<html lang="en">
    <head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<link rel="apple-touch-icon" sizes="180x180" href="https://www.cyanilux.com/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://www.cyanilux.com/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://www.cyanilux.com/favicon-16x16.png">
<link rel="manifest" href="https://www.cyanilux.com/site.webmanifest">
<meta name="msapplication-TileColor" content="#00aba9">
<meta name="theme-color" content="#ffffff">
<link rel="alternate" type="application/rss+xml" title="RSS Feed" href="https://www.cyanilux.com/index.xml"> 
<link rel="stylesheet" type="text/css" href="https://www.cyanilux.com/css/style.css?v=6 ">


 


<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "FAQPage",
  "mainEntityOfPage" : "https://www.cyanilux.com/faq/",
  "headline": "FAQ",
  "name": "FAQ",
  "description": "List of frequent (or interesting) questions I've answered",
  "datePublished": "2024-03-13",
  "dateModified": "2024-03-13",
  "author": {
	"@type": "Person",
	"name": "Cyanilux",
	"url": "https://www.cyanilux.com"
  },
  "url": "https://www.cyanilux.com/faq/",
  "inLanguage": "en-gb",
  "wordCount": "10042",
  "isPartOf": {
    "@type" : "Blog",
    "@id": "https://www.cyanilux.com",
    "name": "Cyanilux - Game Dev Blog & Tutorials"
  },
  "keywords": [
    "Unity", 
    "Tutorial"
  ],
  "mainEntity" : [
	{
		"@type": "Question",
		"name": "Scene Materials are Magenta/Pink",
		"acceptedAnswer": { 
			"@type": "Answer", 
			"text": "<p>You’ll commonly see your materials turn magenta if you’ve tried switching to a different render pipeline. This occurs because each pipeline uses different shaders.</p><br><p>You can automatically convert any materials using Unity’s shaders (e.g. Standard) :</p><br><ul><br><li>URP (2021.2+) : <a href=\"https://docs.unity3d.com/Packages/com.unity.render-pipelines.universal@12.1/manual/features/rp-converter.html\">RP Converter Window</a></li><br><li>URP (older versions) : <a href=\"https://docs.unity3d.com/Packages/com.unity.render-pipelines.universal@11.0/manual/upgrading-your-shaders.html\">Upgrading Materials</a></li><br><li>HDRP : <a href=\"https://docs.unity3d.com/Packages/com.unity.render-pipelines.high-definition@13.1/manual/Render-Pipeline-Wizard.html\">Render Pipeline Wizard</a></li><br></ul><br><p>Any custom shaders (that you’ve written or from downloaded assets) <em>cannot be converted automatically</em>. You would need to rewrite them or a find a replacement asset.</p><br><p>If you aren’t upgrading, materials can also turn magenta when there is an error in the shader syntax (Should be able to see these in the Console, or in the Inspector when the shader asset is selected).</p><br><p>If a magenta material is using a Shader Graph, be sure the <a href=\"/faq/#sg-magenta\">target is assigned correctly</a>, and save the graph using the <strong>Save Asset</strong> button in the top left of the shader graph window.</p><br><p>In a build, magenta materials could also mean the shader uses a <a href=\"https://docs.unity3d.com/Manual/SL-ShaderCompileTargets.html\">compile target</a> which is higher than what is supported by the platform.</p><br>"
		}
	},
	{
		"@type": "Question",
		"name": "Material/Shaders are animated during Play Mode but not in Editor / Scene View",
		"acceptedAnswer": { 
			"@type": "Answer", 
			"text": "<div class=\"img-right\"><br><a href=\"scene-always-refresh.png\" target=\"_blank\" rel=\"noopener noreferrer\"><br><img loading=\"lazy\" width=\"182\" height=\"143\" alt=\"(Image)\" src=\"scene-always-refresh.png\" /><br></a><br><p class=\"img-text\"></p><br></div><br><p>By default the Scene View does not constantly re-render it’s camera to help with editor performance.</p><br><p>If requried though, there’s a dropdown in the top right where you can enable “Always Refresh” (or “Animated Materials” in older versions)</p><br>"
		}
	},
	{
		"@type": "Question",
		"name": "Issues with sorting Transparent faces/objects.",
		"acceptedAnswer": { 
			"@type": "Answer", 
			"text": "<p>Correctly sorting transparent geometry can be difficult. It’s basically an unsolved problem in realtime computer graphics. There usually isn’t a single answer that can solve every case.</p><br><p>Opaque objects don’t have this problem as they write to the <strong>Depth Buffer</strong> (ZWrite), which allows <strong>Depth Testing</strong> (ZTest) to occur to sort on a per-fragment/pixel basis. Unity also will render opaque objects closer to the camera first, so we don’t need to waste time rendering pixels behind others.</p><br><p>But with the Transparent queue, shaders typically don’t write to the depth buffer and we have to render objects further away first, in order to achieve the correct Alpha Blending. Even if depth write was enabled, it still wouldn’t sort correctly when blending is involved.</p><br><p>Quick tips :</p><br><ul><br><li>Always split <strong>Opaque</strong> and <strong>Transparent</strong> parts of a model into separate meshes (or at least separate sub-meshes) and apply separate materials.</li><br><li>If your object doesn’t need <em>partial transparency</em>, consider using <strong>Opaque</strong> with <strong>Alpha Clipping</strong> instead.<br><ul><br><li>In HLSL, use <code>clip(alpha - threshold)</code> or <code>if (alpha < threshold) discard;</code></li><br><li>In Shader Graph, can find this in <strong>Graph Settings</strong></li><br><li>This could also be paired with <strong>Dithering</strong> to fake some transparency. For example, see <a href=\"https://danielilett.com/2020-04-19-tut5-5-urp-dither-transparency/\">this Shader Graph tutorial by Daniel Ilett</a></li><br></ul><br></li><br><li>In some cases, can swap to a different blend mode. Additive (<code>Blend One One</code>) and Multiplicative (i.e. <code>Blend Zero SrcColor</code>) blending modes in particular would produce the same results regardless of the order those objects are rendered in!</li><br></ul><br><p>Solutions to fixing common transparent sorting issues are listed below.</p><br><h4 id=\"render-queue\">Render Queue</h4><br><p>Transparent objects will sort based on their mesh origin. If you know that a particular transparent material should <strong>always appear behind / on top</strong> of others, you can use the <strong>Render Queue</strong> or <strong>Sorting Priority</strong> on the material to force the render order.</p><br><div class=\"img-center\"><br><a href=\"sorting-priority.png\" target=\"_blank\" rel=\"noopener noreferrer\"><br><img loading=\"lazy\" width=\"384\" height=\"59\" alt=\"(Image)\" src=\"sorting-priority.png\" /><br></a><br><p class=\"img-text\"></p><br></div><br><h4 id=\"pre-sorting-mesh-triangle-order\">Pre-sorting Mesh Triangle Order</h4><br><p>When rendering a mesh, the faces are rendered in order of their <strong>indices/triangles</strong> array. In cases where you don’t have intersecting geometry, it may be possible to <strong>pre-sort the triangles</strong> to force the draw order. This can be more performant than using the above method, but requires some setup in the modelling program.</p><br><div class=\"img-center\"><br><a href=\"transparent-sorting.png\" target=\"_blank\" rel=\"noopener noreferrer\"><br><img loading=\"lazy\" width=\"537\" height=\"248\" alt=\"(Image)\" src=\"transparent-sorting.png\" /><br></a><br><p class=\"img-text\">A mesh consisting of layered spheres.<br><br>Left : The inner spheres are incorrectly rendering on top.<br><br>Right : Sorting corrected by combining layers in specific order in Blender.</p><br></div><br><p>It may vary in each 3D modelling program, but as you combine multiple meshes, the assumption is that the triangles are appended.</p><br><p>Example in Blender :</p><br><ol><br><li>Separate each “layer” of triangles into separate objects.</li><br><li>Select two layers - <strong>outer most layer first</strong>. I find it easiest to do this in the <strong>Outliner</strong> while holding <strong>Ctrl</strong></li><br><li>Combine/Join with <strong>Ctrl+J</strong> (while hovering over the 3D Viewport)</li><br><li>Repeat steps 2 & 3 until each layer is collapsed down into a single mesh</li><br></ol><br><div class=\"img-center\"><br><a href=\"transparent-sorting-blender.png\" target=\"_blank\" rel=\"noopener noreferrer\"><br><img loading=\"lazy\" width=\"750\" height=\"132\" alt=\"(Image)\" src=\"transparent-sorting-blender.png\" /><br></a><br><p class=\"img-text\">Blender Outliner, showing each layer being combined after repeating these steps.</p><br></div><br><ul><br><li>Note that using some Modifiers could change the triangle ordering.</li><br><li>You would want to keep using <code>Cull Back</code> with this method. If you need back faces you’d need to duplicate the geometry will flipped faces/normals, and sort these triangles appropriately.</li><br><li>May also need to untick the “Optimise Mesh : Polygon Order” on the model import in Unity. As this may reorganise the triangle order.</li><br></ul><br><h4 id=\"transparent-depth-prepass\">Transparent Depth Prepass</h4><br><p>When you don’t want to see overlapping faces of the model through itself, we can use a prepass to write to the depth buffer only. When we then render our object normally it can ZTest against this.</p><br><div class=\"img-center\"><br><a href=\"transparent-depth-prepass.png\" target=\"_blank\" rel=\"noopener noreferrer\"><br><img loading=\"lazy\" width=\"365\" height=\"276\" alt=\"(Image)\" src=\"transparent-depth-prepass.png\" /><br></a><br><p class=\"img-text\">Left : Normal Render<br><br>Right : Render with Prepass<br><br>(Character from <a href=\"https://www.kenney.nl/assets/animated-characters-2\">Kenney Animated Characters 2</a>)</p><br></div><br><p>For Built-in RP, can add a pass before your main one :</p><br><div class=\"highlight\"><div style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"><br><table style=\"border-spacing:0;padding:0;margin:0;border:0;\"><tr><td style=\"vertical-align:top;padding:0;margin:0;border:0;\"><br><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"><code><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\">1<br></span><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\">2<br></span><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\">3<br></span><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\">4<br></span></code></pre></td><br><td style=\"vertical-align:top;padding:0;margin:0;border:0;;width:100%\"><br><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"><code class=\"language-c\" data-lang=\"c\"><span style=\"display:flex;\"><span>Pass {<br></span></span><span style=\"display:flex;\"><span>    ZWrite On       <span style=\"color:#75715e\">// Write to the Depth Buffer<br></span></span></span><span style=\"display:flex;\"><span><span style=\"color:#75715e\"></span>    ColorMask <span style=\"color:#ae81ff\">0</span>     <span style=\"color:#75715e\">// Don't write to the Color Buffer<br></span></span></span><span style=\"display:flex;\"><span><span style=\"color:#75715e\"></span>}</span></span></code></pre></td></tr></table><br></div><br></div><br><p>(Can find another example here : <a href=\"https://forum.unity.com/threads/transparent-depth-shader-good-for-ghosts.149511/\">https://forum.unity.com/threads/transparent-depth-shader-good-for-ghosts.149511/</a>)</p><br><p>In other pipelines we can’t use multi-pass shaders, but you can instead use a separate shader/material with -1 on the Sorting Priority (or Render Queue). Can use the following code in a <code>.shader</code> file (Create → Unlit Shader)</p><br><div class=\"highlight\"><div style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"><br><table style=\"border-spacing:0;padding:0;margin:0;border:0;\"><tr><td style=\"vertical-align:top;padding:0;margin:0;border:0;\"><br><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"><code><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"> 1<br></span><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"> 2<br></span><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"> 3<br></span><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"> 4<br></span><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"> 5<br></span><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"> 6<br></span><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"> 7<br></span><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"> 8<br></span><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"> 9<br></span><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\">10<br></span></code></pre></td><br><td style=\"vertical-align:top;padding:0;margin:0;border:0;;width:100%\"><br><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"><code class=\"language-c\" data-lang=\"c\"><span style=\"display:flex;\"><span>Shader <span style=\"color:#e6db74\">"Custom/DepthPrepass"</span> {<br></span></span><span style=\"display:flex;\"><span>    Properties { }<br></span></span><span style=\"display:flex;\"><span>    SubShader {<br></span></span><span style=\"display:flex;\"><span>        Tags { <span style=\"color:#e6db74\">"Queue"</span><span style=\"color:#f92672\">=</span><span style=\"color:#e6db74\">"Transparent-1"</span> }<br></span></span><span style=\"display:flex;\"><span>        Pass {<br></span></span><span style=\"display:flex;\"><span>            ZWrite On<br></span></span><span style=\"display:flex;\"><span>            ColorMask <span style=\"color:#ae81ff\">0</span><br></span></span><span style=\"display:flex;\"><span>        }<br></span></span><span style=\"display:flex;\"><span>    }<br></span></span><span style=\"display:flex;\"><span>}</span></span></code></pre></td></tr></table><br></div><br></div><br><ul><br><li>Can then attach it as a <strong>second material on the Mesh Renderer</strong>.</li><br><li>If the mesh already has multiple sub-meshes / materials, may be better to separate that part of the mesh and use another GameObject & MeshRenderer too.</li><br><li>For URP, if you have <em>many</em> objects that need this prepass, then rather than using multiple materials / GameObjects, you can use the <strong>Render Objects</strong> feature. This allows us to re-render a particular <strong>Layer</strong> with an <strong>Override Material</strong> (using our DepthPrepass shader)</li><br></ul><br><div class=\"img-center\"><br><a href=\"transparent-depth-prepass-renderobjects.png\" target=\"_blank\" rel=\"noopener noreferrer\"><br><img loading=\"lazy\" width=\"308\" height=\"235\" alt=\"(Image)\" src=\"transparent-depth-prepass-renderobjects.png\" /><br></a><br><p class=\"img-text\"></p><br></div><br><ul><br><li>But note that using this removes the ability to see any other transparent objects through the mesh. (Unless they are moved to the Before Rendering Transparents event too)</li><br></ul><br><h4 id=\"oit\">OIT</h4><br><p>There are also methods to achieve <a href=\"https://en.wikipedia.org/wiki/Order-independent_transparency\">Order Independent Transparency</a> - But I’m not at all familiar with these. I think they’re quite expensive (either in terms of performance or memory), and Unity does not include any support for them so you’d need to implement this stuff yourself (or find an asset/package that handles it for you. This would require custom shaders too though, so not easy to implement)</p><br>"
		}
	},
	{
		"@type": "Question",
		"name": "Material with custom shader is invisible in URP",
		"acceptedAnswer": { 
			"@type": "Answer", 
			"text": "<p>2021.2+ versions of the URP have a <a href=\"https://docs.unity3d.com/Packages/com.unity.render-pipelines.universal@14.0/manual/urp-universal-renderer.html#rendering:~:text=.-,Depth%C2%A0Priming,-Mode\">Depth Priming</a> option on the <strong>Universal Renderer Asset</strong> while using the Forward path. In the URP template this is set to Auto (enabled if URP is already doing a Depth Prepass rather than a CopyDepth pass. Can check Frame Debugger to see what is used)</p><br><div class=\"img-center\"><br><a href=\"urp-depth-priming.png\" target=\"_blank\" rel=\"noopener noreferrer\"><br><img loading=\"lazy\" width=\"514\" height=\"336\" alt=\"(Image)\" src=\"urp-depth-priming.png\" /><br></a><br><p class=\"img-text\"></p><br></div><br><p>Depth Priming allows rendering opaque objects with a Depth Prepass, to populate the depth buffer without the fragment shading cost - potentially reducing the cost of overdraw in the opaque stage.</p><br><p>It requires shaders to have a pass with the <strong>DepthOnly</strong> LightMode tag in the shader (and <strong>DepthNormals</strong> if using a renderer feature that requires the Camera Normals Texture - such as SSAO or Decals). If a shader doesn’t have these passes, the forward pass is still rendered (but with ZWrite Off) and the skybox later draws over it, hence it appears invisible.</p><br><p>For example of how to set these passes up, see the templates here : <a href=\"https://github.com/Cyanilux/URP_ShaderCodeTemplates/\">https://github.com/Cyanilux/URP_ShaderCodeTemplates/</a></p><br><p>You could instead set Depth Priming to Disabled, which will make the object visible. However without the DepthOnly/DepthNormals passes, objects still may not appear in the Camera Depth Texture (<b class=\"node\">Scene Depth</b> node) or Camera Normals Texture.</p><br><p>An alternative is using Shader Graph, which will generate the passes required by URP.</p><br>"
		}
	},
	{
		"@type": "Question",
		"name": "OnRenderImage in URP",
		"acceptedAnswer": { 
			"@type": "Answer", 
			"text": "<p>OnRenderImage does not work in URP.</p><br><p>If you are using it to apply image effects with <code>Graphics.Blit</code>, In 2022.2+ should use the <strong>Fullscreen Pass Renderer Feature</strong> and <strong>Fullscreen Graph</strong> - or custom shader including <a href=\"https://github.com/Unity-Technologies/Graphics/blob/master/Packages/com.unity.render-pipelines.core/Runtime/Utilities/Blit.hlsl\">Blit.hlsl</a>. Use the Vert function as the vertex shader and call FragBlit in your fragment shader.</p><br><p>For prior versions, can use my <a href=\"https://github.com/Cyanilux/URP_BlitRenderFeature\">Blit Renderer Feature</a>.</p><br><p>For effects that require more than just a Blit, may need to write your own <a href=\"/tutorials/custom-renderer-features/\">Custom Renderer Feature</a> - my post on them may help (aimed at 2022+).</p><br>"
		}
	},
	{
		"@type": "Question",
		"name": "Material greyed out / Cannot edit properties",
		"acceptedAnswer": { 
			"@type": "Answer", 
			"text": "<p>If you want to edit materials from <strong>imported models</strong> in Unity, you need to <strong>extract</strong> those materials before they can be edited. Click on the model file in the Project window under your assets, then the <a href=\"https://docs.unity3d.com/Manual/FBXImporter-Materials.html\">Materials tab</a> in the Inspector. Should be a button to extract there.</p><br><p>Alternatively / For models with no materials / or for Unity default objects (Cube, Sphere, Capsule, etc) :</p><br><ul><br><li>Unity will automatically assign a default material which cannot be edited. You need to create your own material instead. In the Project window under your assets, right-click and select <strong>Create → Material</strong>. Choose an appropiate shader from the dropdown and adjust properties. Then drag the material onto the object, or assign it under the Renderer component (e.g. MeshRenderer, SpriteRenderer, UI Image, etc.)</li><br></ul><br>"
		}
	},
	{
		"@type": "Question",
		"name": "Shader Graph Material greyed out / Cannot edit properties",
		"acceptedAnswer": { 
			"@type": "Answer", 
			"text": "<p>As of Unity 2022, Shader Graph automatically generates a <strong>Material</strong> under each graph asset. These materials cannot be edited from Unity’s Inspector, but uses the default values assigned to properties within Shader Graph. To adjust them, select the property in the <strong>Blackboard</strong> and edit the <strong>Default</strong> field in the <strong>Graph Inspector</strong> window inside Shader Graph.</p><br><p>If you want a Material with values different than the defaults, you need to create a new Material asset using the shader. In the Project window under your assets, right-click the Shader Graph Asset then select <strong>Create → Material</strong>.</p><br>"
		}
	},
	{
		"@type": "Question",
		"name": "Main Preview is Magenta/Pink",
		"acceptedAnswer": { 
			"@type": "Answer", 
			"text": "<div class=\"img-right\"><br><a href=\"sg-magenta.png\" target=\"_blank\" rel=\"noopener noreferrer\"><br><img loading=\"lazy\" width=\"230\" height=\"230\" alt=\"(Image)\" src=\"sg-magenta.png\" /><br></a><br><p class=\"img-text\"></p><br></div><br><p>The <strong>Main Preview</strong> showing as Magenta/Pink usually means that the graph <strong>Target</strong> is not supported in the current <strong>Render Pipeline</strong>. This can be found under the <strong>Graph Settings</strong> tab of the <strong>Graph Inspector</strong> window - which you can toggle with a button in the top right of the graph.</p><br><p>If you have created a “Blank Shader Graph” you would also need to add a target to that list before you can use the graph on a material.</p><br><p>In 2021.2+ it is possible to add the Built-in RP as a target. Older verisons do not have support for Built-in and must use URP or HDRP. Once the URP or HDRP package is installed, there is more that is required to properly configure Unity to use those pipelines, such as assigning a pipeline asset under <strong>Project Settings</strong>.</p><br><p>See the documentation for steps (can select version in top left of these pages) :</p><br><ul><br><li>URP : <a href=\"https://docs.unity3d.com/Packages/com.unity.render-pipelines.universal@15.0/manual/InstallURPIntoAProject.html\">Install URP into a Project</a></li><br><li>HDRP : <a href=\"https://docs.unity3d.com/Packages/com.unity.render-pipelines.high-definition@15.0/manual/Upgrading-To-HDRP.html\">Upgrading to HDRP</a></li><br></ul><br><p>If you have already done this, check the <strong>Target</strong> (under the <strong>Graph Settings</strong> tab of the <strong>Graph Inspector</strong> window). Make sure this matches the the pipeline you have installed & configured. Then save the graph using the <strong>Save Asset</strong> button in the top left.</p><br><p>May be able to find more information in my <a href=\"/tutorials/intro-to-shader-graph/\">Intro to Shader Graph</a> post.</p><br><p>Note that you may also see other previews showing as Magenta/Pink when obtaining undefined values (NAN), such as when dividing by zero, or using negative values in the Power node (as the hlsl pow function only supports positive ranges).</p><br>"
		}
	},
	{
		"@type": "Question",
		"name": "How do I get the small redirect node?",
		"acceptedAnswer": { 
			"@type": "Answer", 
			"text": "<p>In v10+ (Unity 2020.2+), you can obtain a redirect node by <strong>double left-clicking a connection wire</strong>. Or right-click and select “Add Redirect”.</p><br><p><a href=\"/tutorials/intro-to-shader-graph/#redirect\">Intro to Shader Graph post - Redirect</a></p><br>"
		}
	},
	{
		"@type": "Question",
		"name": "Preview on <b class=\"node\">Sample Texture 2D</b> looks stretched out when using a texture with alpha",
		"acceptedAnswer": { 
			"@type": "Answer", 
			"text": "<p>This is intentional. Previews inside nodes <strong>do not show alpha/transparency</strong>, only the RGB data. It’s common for colours to “stretch out” in fully transparent areas to avoid artifacts. If it was instead black in these areas, the colour might darken along the transparent edge. (That may look even worse when dealing with mipmaps, though you typically wouldn’t have those with sprites in particular)</p><br><p>Only the Main Preview will show transparency.</p><br><div class=\"img-center\"><br><a href=\"sg-stretched-texture.png\" target=\"_blank\" rel=\"noopener noreferrer\"><br><img loading=\"lazy\" width=\"464\" height=\"306\" alt=\"(Image)\" src=\"sg-stretched-texture.png\" /><br></a><br><p class=\"img-text\">(Robot Character from <a href=\"https://www.kenney.nl/assets/toon-characters-1\">Kenney Toon Characters 1</a>)</p><br></div><br><p>Even with these stretched-out previews, the final result should look correct provided the alpha channel (A output from <b class=\"node\">Sample Texture 2D</b>) is connected to the <strong>Alpha</strong> port in the <strong>Master Stack</strong>.</p><br><ul><br><li>If you don’t see that port (or it is greyed out), your graph is currently set to be <strong>Opaque</strong>. Can change this to <strong>Transparent</strong> in the <strong>Graph Settings</strong> (tab of <strong>Graph Inspector</strong> window, toggled with button in top right of graph). Sprite graphs are always transparent by default.</li><br><li>If you still don’t see the Alpha port, try adding the block manually (see <a href=\"/tutorials/intro-to-shader-graph/#master-stack\">Intro to Shader Graph post - Master Stack</a>)</li><br></ul><br><p>If for some reason you do need the texture masked correctly to the alpha, can <b class=\"node\">Multiply</b> the RGBA and A outputs. Or if you need to control the background color, put the A output into the T input on a <b class=\"node\">Lerp</b> with A as the background and B as the RGBA output.</p><br>"
		}
	},
	{
		"@type": "Question",
		"name": "Can’t connect node to Vertex stage ports (Position, Normal, Tangent) in Master Stack",
		"acceptedAnswer": { 
			"@type": "Answer", 
			"text": "<p>Some nodes can only be connected to the Fragment stage.</p><br><ul><br><li>The <b class=\"node\">Is Front Face</b> node uses the <code>SV_IsFrontFace</code> semantic which is only available as an input to the fragment shader. This should make sense, as the vertex shader runs on vertices - which do not have any information about how they connect or the faces yet.</li><br><li>Partial screen space derivative functions (<b class=\"node\">DDX</b>,  <b class=\"node\">DDY</b>, <b class=\"node\">DDXY</b>) are also only supported by the fragment shader, as they compare values for neighbouring fragments/pixels.</li><br></ul><br><p>Shader Graph does not make this problem very clear, but it is most commonly encountered when dealing with the <b class=\"node\">Sample Texture 2D</b> node, which uses these derivatives behind the scenes to calculate the mipmap level when sampling. You would instead need to use the <b class=\"node\">Sample Texture 2D LOD</b> version.</p><br><p>There are other nodes that rely on the derivates, such as <b class=\"node\">Normal From Height</b> and the various procedural shapes (e.g. <b class=\"node\">Ellipse</b>, <b class=\"node\">Rectangle</b>, <b class=\"node\">Polygon</b>, <b class=\"node\">Rounded Rectangle</b>, <b class=\"node\">Rounded Polygon</b>).</p><br><p>There are also nodes that use <code>SAMPLE_TEXTURE2D(tex, sampler, uv)</code> in their code (e.g. <b class=\"node\">Triplanar</b>), but these could likely be rewritten manually via a <b class=\"node\">Custom Function</b> node to use the <code>SAMPLE_TEXTURE2D_LOD(tex, sampler, uv, lod)</code> macro instead, in order to support the vertex shader. (Can view generated code for a specific node by right-clicking it and selecting <strong>Show Generated Code</strong> or <strong>Open Documentation</strong>)</p><br><p>For more information / nodes affected, see <a href=\"/tutorials/intro-to-shader-graph/#fragment-only-nodes\">Intro to Shader Graph post - Fragment-Only Nodes</a></p><br>"
		}
	},
	{
		"@type": "Question",
		"name": "Vertex Displacement doesn’t affect shading / How to update normal vectors",
		"acceptedAnswer": { 
			"@type": "Answer", 
			"text": "<p>Editing Vertex Positions does not automatically change the Normal Vectors, which are required to affect shading.</p><br><p>I have a few methods on how to calculate new normals listed here : <a href=\"/tutorials/vertex-displacement/#recalculating-normals\">Vertex Displacement post - Recalculating Normals</a></p><br>"
		}
	},
	{
		"@type": "Question",
		"name": "Back faces are darker when using Lit Graph & Two-Sided / Render Face : Both",
		"acceptedAnswer": { 
			"@type": "Answer", 
			"text": "<p>This occurs because the <strong>Normal</strong> vectors stored in the mesh are intended for the front faces only. We can flip them for back faces by making use of the <b class=\"node\">Is Front Face</b> and <b class=\"node\">Branch</b> nodes.</p><br><p>If using a Normal Map, we would use the result of our <b class=\"node\">Sample Texture 2D</b> in the <strong>True</strong> input, and <b class=\"node\">Multiply</b> it by (1, 1, -1) for the <strong>False</strong> input. This would then go into the <strong>Normal (Tangent Space)</strong> port on the Fragment stage of the <strong>Master Stack</strong>.</p><br><div class=\"img-center\"><br><a href=\"sg-two-sided-normal-tangent.png\" target=\"_blank\" rel=\"noopener noreferrer\"><br><img loading=\"lazy\" width=\"750\" height=\"191\" alt=\"(Image)\" src=\"sg-two-sided-normal-tangent.png\" /><br></a><br><p class=\"img-text\"></p><br></div><br><p>If not using a Normal Map, we could use the <b class=\"node\">Normal Vector</b> node in <strong>Tangent</strong> space - or just a <b class=\"node\">Vector3</b> set to (0, 0, 1) as those will be equal…</p><br><p>But it should actually be cheaper to change the <strong>Fragment Normal Space</strong> to “World” in the <strong>Graph Settings</strong> (tab of <strong>Graph Inspector</strong>, toggled with button in the top right of graph), as this avoids the need for the Tangent → World transformation. We can then use the <b class=\"node\">Normal Vector</b> node in <strong>World</strong> space for the <strong>True</strong> input and put through a <b class=\"node\">Negate</b> node for the <strong>False</strong> input.</p><br><div class=\"img-center\"><br><a href=\"sg-two-sided-normal-world.png\" target=\"_blank\" rel=\"noopener noreferrer\"><br><img loading=\"lazy\" width=\"750\" height=\"205\" alt=\"(Image)\" src=\"sg-two-sided-normal-world.png\" /><br></a><br><p class=\"img-text\"></p><br></div><br>"
		}
	},
	{
		"@type": "Question",
		"name": "Pixellation along seams in UV when using <b class=\"node\">Fraction</b> with <b class=\"node\">Sample Texture 2D</b>",
		"acceptedAnswer": { 
			"@type": "Answer", 
			"text": "<p>In some cases you might want to use the <b class=\"node\">Fraction</b> node (aka <code>frac()</code> in HLSL) on the UVs (e.g. for repeating sections of a larger texture). But when using this with the <b class=\"node\">Sample Texture 2D</b> you may notice some strange pixellation artifacts along the seam produced by the jump in the UV coordinates.</p><br><p>This isn’t limited to the <b class=\"node\">Fraction</b> node, but I find that this is the most common place where it is noticeable. It occurs for anything that causes a jump in the UVs. Another fairly common example is the seam in the Y component when using the <b class=\"node\">Polar Coordinates</b> node.</p><br><div class=\"img-center\"><br><a href=\"sg-pixellated-seams.png\" target=\"_blank\" rel=\"noopener noreferrer\"><br><img loading=\"lazy\" width=\"501\" height=\"219\" alt=\"(Image)\" src=\"sg-pixellated-seams.png\" /><br></a><br><p class=\"img-text\"></p><br></div><br><p>This pixellation occurs because the <b class=\"node\">Sample Texture 2D</b> calculates the <strong>mipmap level</strong> for sampling by using the partial screenspace derivatives (<b class=\"node\">DDX</b>, <b class=\"node\">DDY</b>), which compare values between neighbouring pixels. The fragment shader can do this as it runs in 2x2 pixel blocks.</p><br><p>Usually this mipmapping is a good thing, as it reduces artifacts when viewing the texture at a distance. But when comparing values for pixels along this seam, the jump is interpreted as needing to sample a higher LOD/mipmap level for those pixels. At mipmap resolutions this small, it basically results in the colour being an average of the entire texture.</p><br><p>This pixellation can be fixed in a few ways :</p><br><ul><br><li>A simple fix is to disable mip maps for that texture (in it’s import settings), or by using the <b class=\"node\">Sample Texture 2D LOD</b> node to only use LOD/mipmap level 0 (the full resolution texture). But this could cause the artifacts as I mentioned above.</li><br><li>A better way to fix this is by using a <b class=\"node\">Custom Function</b> node with <code>Out = SAMPLE_TEXTURE2D_GRAD(Texture, Texture.samplerstate, frac(UV), ddx(UV), ddy(UV));</code> with inputs “Texture” (Texture2D), “UV” (Vector2) and outputs “Out” (Vector4). You can then remove the <b class=\"node\">Fraction</b> node from your graph as it is handled in the code instead (but only on the 2nd parameter, not the derivates!)</li><br><li>If you aren’t using <b class=\"node\">Fraction</b> but a different method that causes seams, you could use a similar function, but provide a separate UV input for the derivates e.g. <code>Out = SAMPLE_TEXTURE2D_GRAD(Texture, Texture.samplerstate, UV, ddx(DerivativeUV), ddy(DerivativeUV));</code>. Can then set the DerivativeUV to the <b class=\"node\">UV</b> node.</li><br></ul><br><p>In Unity 2022.2+ can also now handle this all in graph by using the “Gradient” <strong>Mip Sampling Mode</strong> under the <strong>Node Settings</strong> on the <b class=\"node\">Sample Texture 2D</b> node itself, to expose derivative inputs. Use the <b class=\"node\">DDX</b> and <b class=\"node\">DDY</b> nodes on some continous UV coordinates when connecting to these ports.</p><br><div class=\"img-center\"><br><a href=\"sg-gradient-sample.png\" target=\"_blank\" rel=\"noopener noreferrer\"><br><img loading=\"lazy\" width=\"600\" height=\"355\" alt=\"(Image)\" src=\"sg-gradient-sample.png\" /><br></a><br><p class=\"img-text\"></p><br></div><br>"
		}
	},
	{
		"@type": "Question",
		"name": "Sampling Shadows in a Unlit Graph (URP)",
		"acceptedAnswer": { 
			"@type": "Answer", 
			"text": "<p>In order to get shadows working in an Unlit Graph you need to add some important keywords which allow the ShaderLibrary to calculate shadow info.</p><br><p>I’ve shared a <a href=\"https://github.com/Cyanilux/URP_ShaderGraphCustomLighting/\">Custom Lighting for Shader Graph</a> package on github, which can handle this for you. For supporting shadows, use the <strong>Main Light Shadows</strong> and <strong>Additional Lights</strong> subgraphs. Both of these will work in Unlit Graphs.</p><br><h4 id=\"main-light-shadows\">Main Light Shadows</h4><br><p>If you’d instead prefer to handle it yourself, Create these <strong>Boolean Keywords</strong> in the Shader Graph <strong>Blackboard</strong> :</p><br><ul><br><li><code>_MAIN_LIGHT_SHADOWS</code> - Required to calculate shadows</li><br><li><code>_MAIN_LIGHT_SHADOWS_CASCADE</code> - Required to obtain correct shadows when using cascades > 1</li><br><li><code>_SHADOWS_SOFT</code> - Adds support for the Soft Shadows option</li><br></ul><br><p>Make sure you set the Reference field, and not just the name. Also set them to Multi Compile and Global, and untick Exposed.</p><br><p>Can then sample shadows by calculating the <code>shadowCoord</code> :</p><br><ul><br><li><code>float4 shadowCoord = TransformWorldToShadowCoord(positionWS);</code></li><br></ul><br><p>Then use one of the following :</p><br><ul><br><li><code>Light light = GetMainLight(shadowCoord);</code> and <code>light.shadowAttenuation</code> to obtain the shadows.<br><ul><br><li>also equivalent to : <code>float shadowAtten = MainLightRealtimeShadow(shadowCoord);</code></li><br></ul><br></li><br><li>(v11+ / 2021.1+) <code>Light light = GetMainLight(shadowCoord, positionWS, shadowMask)</code>, which additionally allows supporting the “ShadowMask” baked GI mode. You would typically pass <code>SAMPLE_SHADOWMASK(lightmapUV)</code> into the <code>shadowMask</code> parameter.<br><ul><br><li>also equivalent to : <code>float shadowAtten = MainLightShadow(shadowCoord, positionWS, shadowMask, _MainLightOcclusionProbes);</code></li><br></ul><br></li><br></ul><br><h4 id=\"additional-light-shadows\">Additional Light Shadows</h4><br><p>For additional lights, you need the following keywords:</p><br><ul><br><li><code>_ADDITIONAL_LIGHT_SHADOWS</code> - Required to calculate shadows</li><br><li><code>_ADDITIONAL_LIGHTS</code> - Required to prevent the other keyword being stripped from builds</li><br></ul><br><p>In your light loop, you’d then use :</p><br><ul><br><li>(v8 to v10) <code>Light light = GetAdditionalLight(i, positionWS);</code>, again with <code>light.shadowAttenuation</code> to obtain shadows.</li><br><li>(v11+ / 2021.1+) <code>Light light = GetAdditionalLight(i, positionWS, shadowMask);</code>. The shadowMask parameter here can either be set to the same <code>SAMPLE_SHADOWMASK(lightmapUV)</code> variable, or can use <code>half4(1,1,1,1)</code> if you don’t require supporting it. You still need to specify the parameter for the function to calculate shadows.</li><br></ul><br><p>For better examples see <a href=\"https://github.com/Cyanilux/URP_ShaderGraphCustomLighting/blob/main/CustomLighting.hlsl\">CustomLighting.hlsl</a> in my Custom Lighting package. Also see the Lighting.hlsl, RealtimeLights.hlsl (v12+) and Shadows.hlsl files in the URP ShaderLibrary. Can find these under the Packages in the Project window, or via <a href=\"https://github.com/Unity-Technologies/Graphics/tree/master/Packages/com.unity.render-pipelines.universal/ShaderLibrary\">Unity/Graphics github</a>.</p><br>"
		}
	},
	{
		"@type": "Question",
		"name": "Disable Fog in a Lit Graph",
		"acceptedAnswer": { 
			"@type": "Answer", 
			"text": "<p>You can disable fog entirely via Unity’s Lighting window (under Environement tab). If you still want fog enabled, but a certain object to not include fog, you can disable fog in a Lit Graph by using a <b class=\"node\">Custom Function</b> node.</p><br><p>I’d recommend using String mode, with a Vector4 Input named “In” and a Vector4 Output named “Out”. The function name can be anything (e.g. DisableFog), while the body should use :</p><br><p>For URP Target :</p><br><div class=\"highlight\"><div style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"><br><table style=\"border-spacing:0;padding:0;margin:0;border:0;\"><tr><td style=\"vertical-align:top;padding:0;margin:0;border:0;\"><br><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"><code><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\">1<br></span><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\">2<br></span></code></pre></td><br><td style=\"vertical-align:top;padding:0;margin:0;border:0;;width:100%\"><br><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"><code class=\"language-c\" data-lang=\"c\"><span style=\"display:flex;\"><span>Out <span style=\"color:#f92672\">=</span> In;<br></span></span><span style=\"display:flex;\"><span><span style=\"color:#75715e\">#define MixFog(x,y) x</span></span></span></code></pre></td></tr></table><br></div><br></div><br><p>The function itself doesn’t do anything, except pass the input straight through. But by using the <code>#define</code> we override the later <code>MixFog</code> function call (in <a href=\"https://github.com/Unity-Technologies/Graphics/blob/master/Packages/com.unity.render-pipelines.universal/Editor/ShaderGraph/Includes/PBRForwardPass.hlsl\">URP/PBRForwardPass.hlsl</a>), so rather than applying fog it just outputs the unmodified colour.</p><br><p>For Built-in Target :</p><br><div class=\"highlight\"><div style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"><br><table style=\"border-spacing:0;padding:0;margin:0;border:0;\"><tr><td style=\"vertical-align:top;padding:0;margin:0;border:0;\"><br><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"><code><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\">1<br></span><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\">2<br></span><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\">3<br></span><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\">4<br></span></code></pre></td><br><td style=\"vertical-align:top;padding:0;margin:0;border:0;;width:100%\"><br><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"><code class=\"language-c\" data-lang=\"c\"><span style=\"display:flex;\"><span>Out <span style=\"color:#f92672\">=</span> In;<br></span></span><span style=\"display:flex;\"><span><span style=\"color:#75715e\">// Untested, but I think this should work<br></span></span></span><span style=\"display:flex;\"><span><span style=\"color:#75715e\"></span><span style=\"color:#75715e\">#undef UNITY_APPLY_FOG<br></span></span></span><span style=\"display:flex;\"><span><span style=\"color:#75715e\">#define UNITY_APPLY_FOG(x,y) y</span></span></span></code></pre></td></tr></table><br></div><br></div><br><p>For the Built-in version, they are already using the <code>UNITY_APPLY_FOG</code> macro (in <a href=\"https://github.com/Unity-Technologies/Graphics/blob/master/Packages/com.unity.shadergraph/Editor/Generation/Targets/BuiltIn/Editor/ShaderGraph/Includes/PBRForwardPass.hlsl\">SG/Built-in/PBRForwardPass.hlsl</a>), so we undefine and then redefine it to output the colour (second parameter).</p><br><p>This is <em>kinda</em> hacky (abusing what macros are supposed to be used for), but hey it works!~</p><br>"
		}
	},
	{
		"@type": "Question",
		"name": "Using Shader Graphs for UI",
		"acceptedAnswer": { 
			"@type": "Answer", 
			"text": "<p>As of 2023.2, Shader Graph has a “Canvas” material type to create shaders compatible with UI components. See <a href=\"https://portal.productboard.com/8ufdwj59ehtmsvxenjumxo82/c/50-ui-integration-with-shader-graph\">Roadmap</a></p><br><p>For previous versions :</p><br><p>Shader Graph does not have proper support for UI, however it is possible to still use it with some workarounds & drawbacks. This is written with URP in mind, but it may work the similar in other pipelines.</p><br><ul><br><li>Use the Unlit Graph, or Sprite Unlit Graph. UI should not use Lit or other graph types.</li><br><li>For Image component, use a Texture2D property with <code>_MainTex</code> name/reference to obtain the texture.</li><br><li>Avoid using <code>Screenspace-Overlay</code> mode on the Canvas</li><br><li>Graphs won’t work with UI Masking (e.g. Scroll Rect/View component) and causes warnings about not having correct Stencil properties.</li><br></ul><br><p>More detailed info/setup below</p><br><h4 id=\"canvas\">Canvas</h4><br><p>The Canvas can’t use <code>Screenspace-Overlay</code> mode with Shader Graphs, as that renders all shader passes generated by the graph (such as Shadowcaster / DepthOnly / DepthNormals / etc). Unless you edit the generated code (explained more in the section below), we must instead use <code>Screenspace-Camera</code> mode (and set camera field). Worldspace UI also works.</p><br><div class=\"img-center\"><br><a href=\"sg-overlayui.png\" target=\"_blank\" rel=\"noopener noreferrer\"><br><img loading=\"lazy\" width=\"750\" height=\"249\" alt=\"(Image)\" src=\"sg-overlayui.png\" /><br></a><br><p class=\"img-text\">UI Image rendering incorrectly on a <code>Screenspace-Overlay</code> Canvas. As you can see from the Frame Debugger, it’s rendering 5 times with each pass (such as the selected DepthNormalsOnly pass)</p><br></div><br><div class=\"img-center\"><br><a href=\"sg-cameraui.png\" target=\"_blank\" rel=\"noopener noreferrer\"><br><img loading=\"lazy\" width=\"750\" height=\"249\" alt=\"(Image)\" src=\"sg-cameraui.png\" /><br></a><br><p class=\"img-text\">UI Image rendering correctly on a <code>Screenspace-Camera</code> Canvas</p><br></div><br><p>If you don’t want Post Processing to affect the UI, can create an <strong>Overlay Camera</strong> with the Culling Mask set to UI and Post Processing off :</p><br><div class=\"img-center\"><br><a href=\"sg-overlaycamera.png\" target=\"_blank\" rel=\"noopener noreferrer\"><br><img loading=\"lazy\" width=\"443\" height=\"257\" alt=\"(Image)\" src=\"sg-overlaycamera.png\" /><br></a><br><p class=\"img-text\"></p><br></div><br><p>Then set the <code>Screenspace-Camera</code> <strong>Canvas</strong> to use that new camera and add it to the <strong>Stack</strong> on the <strong>Main Camera</strong>.</p><br><h4 id=\"masking\">Masking</h4><br><p>Graphs will cause the UI to not work with masking, such as the Scroll Rect/View and Mask components. This requires Stencil operations, which shader graph does not support/expose.</p><br><p>The RenderObjects feature can override Stencil operations, however we cannot use it here for a few reasons :</p><br><ul><br><li>It seems the Layer that UI GameObjects are on is ignored, only the layer of the Canvas is important. So it doesn’t actually filter correctly, without nesting a Canvas in the Scrollview Viewport.</li><br><li>Even if we do that, using a feature also moves rendering the object out of the regular Transparent queue. The mask already renders and is cleared before the feature executes.</li><br></ul><br><p>If you don’t need masking, but want to surpress warnings like “Material UI doesn’t have _Stencil property” you can create Float properties in the Blackboard with those names (<code>_Stencil, _StencilComp, _StencilOp, _StencilWriteMask, _StencilReadMask, _ColorMask</code>), however it is not possible to make them actually do anything from the graph.</p><br><p>If you require masking to work, you will need to <strong>copy the shader code generated by the graph</strong> and edit it. This would involve clicking the “View Generated Shader” button in the inspector when viewing the Shader Graph asset. Save the shader that appears in your assets, and use that on Materials instead of the graph.</p><br><div class=\"img-center\"><br><a href=\"sg-generate-code.png\" target=\"_blank\" rel=\"noopener noreferrer\"><br><img loading=\"lazy\" width=\"443\" height=\"162\" alt=\"(Image)\" src=\"sg-generate-code.png\" /><br></a><br><p class=\"img-text\"></p><br></div><br><p>To actually support the masking, add the following Properties and edit the SubShader :</p><br><div class=\"highlight\"><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;\"><code class=\"language-c\" data-lang=\"c\"><span style=\"display:flex;\"><span>Shader <span style=\"color:#e6db74\">"Shader Graphs/UITest"</span> {<br></span></span><span style=\"display:flex;\"><span>    Properties {<br></span></span><span style=\"display:flex;\"><span>        <span style=\"color:#75715e\">// ... (properties generated by graph)<br></span></span></span><span style=\"display:flex; background-color:#3c3d38\"><span><span style=\"color:#75715e\"></span>        _StencilComp (<span style=\"color:#e6db74\">"Stencil Comparison"</span>, Float) <span style=\"color:#f92672\">=</span> <span style=\"color:#ae81ff\">8</span><br></span></span><span style=\"display:flex; background-color:#3c3d38\"><span>        _Stencil (<span style=\"color:#e6db74\">"Stencil ID"</span>, Float) <span style=\"color:#f92672\">=</span> <span style=\"color:#ae81ff\">0</span><br></span></span><span style=\"display:flex; background-color:#3c3d38\"><span>        _StencilOp (<span style=\"color:#e6db74\">"Stencil Operation"</span>, Float) <span style=\"color:#f92672\">=</span> <span style=\"color:#ae81ff\">0</span><br></span></span><span style=\"display:flex; background-color:#3c3d38\"><span>        _StencilWriteMask (<span style=\"color:#e6db74\">"Stencil Write Mask"</span>, Float) <span style=\"color:#f92672\">=</span> <span style=\"color:#ae81ff\">255</span><br></span></span><span style=\"display:flex; background-color:#3c3d38\"><span>        _StencilReadMask (<span style=\"color:#e6db74\">"Stencil Read Mask"</span>, Float) <span style=\"color:#f92672\">=</span> <span style=\"color:#ae81ff\">255</span><br></span></span><span style=\"display:flex; background-color:#3c3d38\"><span>        _ColorMask (<span style=\"color:#e6db74\">"Color Mask"</span>, Float) <span style=\"color:#f92672\">=</span> <span style=\"color:#ae81ff\">15</span><br></span></span><span style=\"display:flex;\"><span>    }<br></span></span><span style=\"display:flex;\"><span>    SubShader {<br></span></span><span style=\"display:flex; background-color:#3c3d38\"><span>        Stencil {<br></span></span><span style=\"display:flex; background-color:#3c3d38\"><span>            Ref [_Stencil]<br></span></span><span style=\"display:flex; background-color:#3c3d38\"><span>            Comp [_StencilComp]<br></span></span><span style=\"display:flex; background-color:#3c3d38\"><span>            Pass [_StencilOp]<br></span></span><span style=\"display:flex; background-color:#3c3d38\"><span>            ReadMask [_StencilReadMask]<br></span></span><span style=\"display:flex; background-color:#3c3d38\"><span>            WriteMask [_StencilWriteMask]<br></span></span><span style=\"display:flex; background-color:#3c3d38\"><span>        }<br></span></span><span style=\"display:flex; background-color:#3c3d38\"><span>        ColorMask [_ColorMask]<br></span></span><span style=\"display:flex;\"><span>        <span style=\"color:#75715e\">// ... rest of shader (Tags, Pass, etc)<br></span></span></span></code></pre></div><br><p>Note the generated shader code may have <em>multiple SubShaders</em>, you would want to add this Stencil block (and ColorMask) to both.</p><br><p>With the material using this shader, the Image is now masked correctly :</p><br><div class=\"img-center\"><br><a href=\"sg-maskedui.png\" target=\"_blank\" rel=\"noopener noreferrer\"><br><img loading=\"lazy\" width=\"425\" height=\"174\" alt=\"(Image)\" src=\"sg-maskedui.png\" /><br></a><br><p class=\"img-text\"></p><br></div><br><p>You could also delete all passes except the UniversalForward, and use <code>ZTest [unity_GUIZTestMode]</code> (replacing the ZTest line in the Pass) to support rendering into a ScreenSpace-Overlay UI. All these changes are based on the <a href=\"https://github.com/TwoTailsGames/Unity-Built-in-Shaders/blob/master/DefaultResourcesExtra/UI/UI-Default.shader\">Built-in RP / UI-Default.shader</a>.</p><br><p>Note that the shader is now completely separate from the graph. If you want to make changes to the graph, you’ll need to regenerate the code and make these changes again. Provided you don’t need to make changes often, it isn’t that bad.</p><br>"
		}
	},
	{
		"@type": "Question",
		"name": "Using Shader Graphs for Terrain",
		"acceptedAnswer": { 
			"@type": "Answer", 
			"text": "<p>Shader Graph does not have proper support for Terrain, but it is still possible with some drawbacks. (Note this is for regular Draw mode, not Instanced Draw)</p><br><p>A Material can be assigned in the last tab on the Terrain component (cog symbol). When using a material with a graph shader, it will always display a warning that it “might be unsuitable”, but this can be ignored. It’s not possible to remove this warning afaik (without generating shader code from the graph), as we can’t add the TerrainCompatible tag from within the graph editor.</p><br><div class=\"img-center\"><br><a href=\"sg-terrain-1.png\" target=\"_blank\" rel=\"noopener noreferrer\"><br><img loading=\"lazy\" width=\"341\" height=\"300\" alt=\"(Image)\" src=\"sg-terrain-1.png\" /><br></a><br><p class=\"img-text\"></p><br></div><br><p>If you want to support painting of Terrain Layers, it is only possible to support 4 layers from a graph. You just need to use specific names/references. At it’s simplest, you’d want :</p><br><ul><br><li><code>_Control</code> (Texture2D) : Terrain splatmap. By default is red everywhere, but as you paint other layers it swaps to green/blue/alpha. Each channel represents the layer painted.</li><br><li><code>_Splat0</code>, <code>_Splat1</code>, <code>_Splat2</code>, <code>_Splat3</code> (Texture2D) : Albedo/Diffuse textures for each layer. For 2021.2+ make sure “Use Tiling And Offset” is enabled on these texture properties! For versions older, create Vector4 <code>_ST</code> properties and use a subgraph as shown in <a href=\"https://twitter.com/Cyanilux/status/1259584907329908737\">this tweet</a>.<br><ul><br><li>With the URP/TerrainLit shader, the alpha channel of these textures is also used as a Smoothness source. It’s up to you if you’d include that in your calculations.</li><br></ul><br></li><br></ul><br><div class=\"img-center\"><br><a href=\"sg-terrain-2.png\" target=\"_blank\" rel=\"noopener noreferrer\"><br><img loading=\"lazy\" width=\"750\" height=\"415\" alt=\"(Image)\" src=\"sg-terrain-2.png\" /><br></a><br><p class=\"img-text\">(Click image to view fullscreen)</p><br></div><br><p>Layers also provide additional data which the shader could support, such as :</p><br><ul><br><li><code>_Smoothness0</code>, <code>_Smoothness1</code>, <code>_Smoothness2</code>, <code>_Smoothness3</code> (Float) : Smoothness floats for each layer. Is typically multiplied with the alpha from the Albedo/Diffuse.</li><br><li><code>_Metallic0</code>, <code>_Metallic1</code>, <code>_Metallic2</code>, <code>_Metallic3</code> (Float) : Metallic floats for each layer</li><br><li><code>_Normal0</code>, <code>_Normal1</code>, <code>_Normal2</code>, <code>_Normal3</code> (Texture2D) : Normal/Bump textures for each layer</li><br><li><code>_Mask0</code>, <code>_Mask1</code>, <code>_Mask2</code>, <code>_Mask3</code> (Texture2D) : “Mask” textures for each layer<br><ul><br><li>It’s up to the shader how this is used, but with URP/TerrainLit :<br><ul><br><li>R = Metallic</li><br><li>G = Occlusion</li><br><li>B = Height (for height-based blending)</li><br><li>A = Smoothness (overrides the albedo alpha & <code>_SmoothnessN</code> values)</li><br></ul><br></li><br></ul><br></li><br><li>For a full list of properties, see <a href=\"https://github.com/Unity-Technologies/Graphics/blob/master/Packages/com.unity.render-pipelines.universal/Shaders/Terrain/TerrainLitInput.hlsl\">TerrainLitInput.hlsl</a>. Also see <a href=\"https://github.com/Unity-Technologies/Graphics/blob/master/Packages/com.unity.render-pipelines.universal/Shaders/Terrain/TerrainLitPasses.hlsl\">TerrainLitPasses.hlsl</a> to see how they are used.</li><br></ul><br><p>You’d handle these using the same sort of setup and connect to the appropiate ports on the Master Stack (if using a Lit Graph this would involve Smoothness, Metallic, <strong>Normal Vector (Tangent)</strong> & Ambient Occlusion).</p><br><p>If using Unlit Graph instead (with a Custom Lighting model, e.g. Toon Shaded), you’d <b class=\"node\">Transform</b> the calculated normal from Tangent to World space so it can be used in lighting calculations.</p><br>"
		}
	},
	{
		"@type": "Question",
		"name": "Using GPU Instancing (DrawMeshInstanced) with Shader Graph",
		"acceptedAnswer": { 
			"@type": "Answer", 
			"text": "<p>GPU Instancing is typically not required when using MeshRenderer and SkinnedMeshRenderers in URP, as these already use the SRP Batcher to optimise setup between draw calls. When using the SRP Batcher you should avoid using Material Property Blocks though and stick to multiple Materials (or instaniate materials, e.g. using <code>renderer.material</code>)</p><br><p>But if you wish to render lots (<em>many thousands</em>) of the same mesh, you could consider using GPU Instancing via <code>Graphics.DrawMeshInstanced</code>, to remove some of the overhead of GameObjects. Or even better, <code>DrawMeshInstancedIndirect</code> (see answer below instead).</p><br><p>To support <code>DrawMeshInstanced</code>, Materials should already have a “Enable GPU Instancing” tickbox which can be ticked.</p><br><p>However using any properties in the Shader Graph Blackboard will still break instancing. Instead, I’ve found that you can use a <b class=\"node\">Custom Function</b> to define the instancing buffer & properties. This is using macros similar to how you would set up instancing in a code-written shader.</p><br><div class=\"highlight\"><div style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"><br><table style=\"border-spacing:0;padding:0;margin:0;border:0;\"><tr><td style=\"vertical-align:top;padding:0;margin:0;border:0;\"><br><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"><code><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"> 1<br></span><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"> 2<br></span><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"> 3<br></span><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"> 4<br></span><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"> 5<br></span><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"> 6<br></span><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"> 7<br></span><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"> 8<br></span><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"> 9<br></span><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\">10<br></span><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\">11<br></span><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\">12<br></span><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\">13<br></span><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\">14<br></span><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\">15<br></span><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\">16<br></span></code></pre></td><br><td style=\"vertical-align:top;padding:0;margin:0;border:0;;width:100%\"><br><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"><code class=\"language-c\" data-lang=\"c\"><span style=\"display:flex;\"><span><span style=\"color:#75715e\">#ifndef CUSTOM_INSTANCING<br></span></span></span><span style=\"display:flex;\"><span><span style=\"color:#75715e\">#define CUSTOM_INSTANCING<br></span></span></span><span style=\"display:flex;\"><span><span style=\"color:#75715e\"></span><span style=\"color:#75715e\">// This allows multiple Custom Function nodes to use the same file<br></span></span></span><span style=\"display:flex;\"><span><span style=\"color:#75715e\">// without trying to include the code multiple times (causing redefinition errors)<br></span></span></span><span style=\"display:flex;\"><span><span style=\"color:#75715e\"></span><br></span></span><span style=\"display:flex;\"><span><span style=\"color:#75715e\">// Instancing Buffer<br></span></span></span><span style=\"display:flex;\"><span><span style=\"color:#75715e\"></span>UNITY_INSTANCING_BUFFER_START(Props)<br></span></span><span style=\"display:flex;\"><span>  UNITY_DEFINE_INSTANCED_PROP(float4, _Color)<br></span></span><span style=\"display:flex;\"><span>UNITY_INSTANCING_BUFFER_END(Props)<br></span></span><span style=\"display:flex;\"><span><br></span></span><span style=\"display:flex;\"><span><span style=\"color:#75715e\">// Custom Function "GetInstancedColor", Outputs : Vector4<br></span></span></span><span style=\"display:flex;\"><span><span style=\"color:#75715e\"></span><span style=\"color:#66d9ef\">void</span> GetInstancedColor_float(out float4 Out){<br></span></span><span style=\"display:flex;\"><span>    Out <span style=\"color:#f92672\">=</span> UNITY_ACCESS_INSTANCED_PROP(Props, _Color);<br></span></span><span style=\"display:flex;\"><span>}<br></span></span><span style=\"display:flex;\"><span><br></span></span><span style=\"display:flex;\"><span><span style=\"color:#75715e\">#endif</span></span></span></code></pre></td></tr></table><br></div><br></div><br>"
		}
	},
	{
		"@type": "Question",
		"name": "Using DrawMeshInstancedIndirect with Shader Graph",
		"acceptedAnswer": { 
			"@type": "Answer", 
			"text": "<p>For supporting <code>DrawMeshInstancedIndirect</code>, (possibly also <code>DrawProcedural</code>), add a <strong>Boolean Keyword</strong> to the <strong>Blackboard</strong>, with reference set to <code>PROCEDURAL_INSTANCING_ON</code>. Should also be Global and using Multi-Compile.</p><br><div class=\"img-center\"><br><a href=\"sg-drawmeshinstancedindirect-1.png\" target=\"_blank\" rel=\"noopener noreferrer\"><br><img loading=\"lazy\" width=\"493\" height=\"189\" alt=\"(Image)\" src=\"sg-drawmeshinstancedindirect-1.png\" /><br></a><br><p class=\"img-text\"></p><br></div><br><p>Use two <b class=\"node\">Custom Function</b> nodes. Both with a Vector3 input named “In” and a Vector3 output named “Out”.</p><br><ul><br><li>The first uses <strong>File</strong> mode with the Function Name “Instancing”, to attach the include file (see Shader Graph gist below as an example).</li><br><li>The second must use <strong>String</strong> mode with the following :</li><br></ul><br><div class=\"highlight\"><div style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"><br><table style=\"border-spacing:0;padding:0;margin:0;border:0;\"><tr><td style=\"vertical-align:top;padding:0;margin:0;border:0;\"><br><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"><code><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\">1<br></span><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\">2<br></span></code></pre></td><br><td style=\"vertical-align:top;padding:0;margin:0;border:0;;width:100%\"><br><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"><code class=\"language-c\" data-lang=\"c\"><span style=\"display:flex;\"><span>Out <span style=\"color:#f92672\">=</span> In;<br></span></span><span style=\"display:flex;\"><span><span style=\"color:#75715e\">#pragma instancing_options procedural:vertInstancingSetup</span></span></span></code></pre></td></tr></table><br></div><br></div><br><p>(<code>vertInstancingSetup</code> being a function in the include file)</p><br><p>Both functions here don’t alter the input passed in, but it is required to be able to connect the node to the <strong>Master Stack</strong>. We should connect it somewhere in the Vertex stage - likely easiest using the <strong>Position</strong> port with the <b class=\"node\">Position</b> node set to Object space (or swap this out for a displaced vertex position if you require that)</p><br><div class=\"img-center\"><br><a href=\"sg-drawmeshinstancedindirect-2.png\" target=\"_blank\" rel=\"noopener noreferrer\"><br><img loading=\"lazy\" width=\"750\" height=\"135\" alt=\"(Image)\" src=\"sg-drawmeshinstancedindirect-2.png\" /><br></a><br><p class=\"img-text\"></p><br></div><br><p>See instanced grass example here :</p><br><ul><br><li>Twitter Thread : <a href=\"https://twitter.com/Cyanilux/status/1396848736022802435\">https://twitter.com/Cyanilux/status/1396848736022802435</a></li><br><li>Shader Graph Include : <a href=\"https://gist.github.com/Cyanilux/4046e7bf3725b8f64761bf6cf54a16eb\">https://gist.github.com/Cyanilux/4046e7bf3725b8f64761bf6cf54a16eb</a></li><br><li>C# Script : <a href=\"https://gist.github.com/Cyanilux/e7afdc5c65094bfd0827467f8e4c3c54\">https://gist.github.com/Cyanilux/e7afdc5c65094bfd0827467f8e4c3c54</a></li><br></ul><br>"
		}
	},
	{
		"@type": "Question",
		"name": "Scene Color node info",
		"acceptedAnswer": { 
			"@type": "Answer", 
			"text": "<p>The <b class=\"node\">Scene Color</b> node samples a texture containing opaque geometry in the scene, allowing you to obtain the colour of opaque objects behind a transparent shader.</p><br><p>This is useful to produce distortion effects. The default UVs input is the <b class=\"node\">Screen Position</b> node, so you can <b class=\"node\">Add</b> or <b class=\"node\">Subtract</b> to that to distort the view, for example with a noise texture. Can find examples in the following posts :</p><br><ul><br><li><a href=\"/tutorials/water-shader-breakdown/\">Water Shader Breakdown</a> (also attempts to remove distortion of objects infront of the water)</li><br><li><a href=\"/tutorials/forcefield-shader-breakdown/\">Forcefield Shader Breakdown</a></li><br><li><a href=\"/tutorials/crystal-shader-breakdown/\">Crystal Shader Breakdown</a></li><br><li><a href=\"/tutorials/rain-effects-breakdown/#raindrop-complex\">Rain Effects Breakdown : Raindrops on Surfaces (Complex)</a></li><br></ul><br><p>Note that the node will only function correctly when using a graph with <strong>Surface Mode : Transparent</strong> (or manually set RenderQueue to 2501+). See below for pipeline-specific differences.</p><br><p><strong>URP</strong> :</p><br><ul><br><li>Enable <strong>Opaque Texture</strong> option under the <strong>URP Asset</strong>. (May have multiple of those assets for each quality setting)</li><br><li>Also make sure dropdown on <strong>Camera</strong> isn’t set to force the Opaque Texture off.</li><br></ul><br><p><strong>Built-in RP</strong> (Unity 2021.2+) :</p><br><ul><br><li>Add <a href=\"https://gist.github.com/Cyanilux/181893cd061e97eb12d5bfdec9fecaab\">this SceneColorSetup script</a> to your <strong>Main Camera</strong> (and optionally other cameras that need the <code>_CameraOpaqueTexture</code>)</li><br></ul><br><p><strong>HDRP</strong> :</p><br><ul><br><li><b class=\"node\">HD Scene Color</b> node may be more suitable for this pipeline. Provides exposure setting and different LOD levels.</li><br></ul><br>"
		}
	},
	{
		"@type": "Question",
		"name": "Layering Textures/Colors using Alpha/Mask",
		"acceptedAnswer": { 
			"@type": "Answer", 
			"text": "<p>If you want to layer a texture containing an alpha channel onto another texture/colour, you can do so using a <b class=\"node\">Lerp</b>, where the A output from the <b class=\"node\">Sample Texture 2D</b> is connected to the T input. The A input would be the colour of the Base/Background while B input would be the colour of what you want to Layer on top.</p><br><div class=\"img-center\"><br><a href=\"sg-layer.png\" target=\"_blank\" rel=\"noopener noreferrer\"><br><img loading=\"lazy\" width=\"750\" height=\"353\" alt=\"(Image)\" src=\"sg-layer.png\" /><br></a><br><p class=\"img-text\"></p><br></div><br><p>If you don’t have a texture with an alpha channel, you could also use a procedural shape (or a channel from another texture) as the T input. This should be a float value, commonly referred to as a <em>mask</em>.</p><br><div class=\"img-center\"><br><a href=\"sg-layer2.png\" target=\"_blank\" rel=\"noopener noreferrer\"><br><img loading=\"lazy\" width=\"750\" height=\"276\" alt=\"(Image)\" src=\"sg-layer2.png\" /><br></a><br><p class=\"img-text\"></p><br></div><br><p>In this case the noise texture is used to interpolate between two colours (blue, green). Then the result is masked using an <b class=\"node\">Ellipse</b> to layer it on the background (same “Base Color” group as used in previous example)</p><br>"
		}
	},
	{
		"@type": "Question",
		"name": "Change frequency of Sine Time",
		"acceptedAnswer": { 
			"@type": "Answer", 
			"text": "<p>It is not possible to change the frequency/wavelength or adjust the phase of the <strong>Sine Time</strong> output from the <b class=\"node\">Time</b> node. You can only remap values, such as using a <b class=\"node\">Multiply</b> to adjust the amplitude of the wave.</p><br><p>If you need to control the frequency, use the <strong>Time</strong> output instead, <b class=\"node\">Multiply</b> by your frequency. To adjust phase use <b class=\"node\">Add</b> or <b class=\"node\">Subtract</b>. You would then put into a <b class=\"node\">Sine</b> node. Can also <b class=\"node\">Multiply</b> again after this to adjust amplitude, same as before.</p><br><div class=\"img-center\"><br><a href=\"sg-sine-time.png\" target=\"_blank\" rel=\"noopener noreferrer\"><br><img loading=\"lazy\" width=\"750\" height=\"151\" alt=\"(Image)\" src=\"sg-sine-time.png\" /><br></a><br><p class=\"img-text\"></p><br></div><br>"
		}
	},
	{
		"@type": "Question",
		"name": "Billboarding (rotating mesh to face camera)",
		"acceptedAnswer": { 
			"@type": "Answer", 
			"text": "<p>While it’s possible to rotate meshes in C# to produce billboarding (e.g. with <code>transform.LookAt</code>), it’s usually cheaper to handle effects like this in the shader - especially if many objects require billboarding.</p><br><p>Shader Graph makes it a little trickier to handle as it does space conversions behind the scenes. The <strong>Position</strong> port in the <strong>Master Stack</strong> is intended to be in <strong>Object</strong> space, rather than the clip space output a written vertex shader would usually have.</p><br><p>First up, we need a matrix to handle the effect. Can use one of the following.</p><br><ul><br><li><b class=\"node\">Transformation Matrix</b> node set to “Inverse View”</li><br><li><b class=\"node\">Custom Function</b> node with <strong>Matrix4</strong> output, <code>Out = unity_CameraToWorld;</code>. This acts the same as the InverseView matrix, but uses the camera even in shadowcasting passes - so shadows will look correct. Should also use set <strong>Cast Shadows</strong> to “Two Sided” option on the <strong>Mesh Renderer</strong>.</li><br></ul><br><p>If you don’t want shadows (e.g. for billboard fire / light flares / etc), can use either of these, and turn off <strong>Cast Shadows</strong> in the <strong>Graph Settings</strong> (or via the Mesh Renderer)</p><br><p>To make billboard only rotate around the Y axis :</p><br><ul><br><li>Use one of the above (depending if shadows are required) into a <b class=\"node\">Matrix Split</b> (Column mode), and put M0 and M2 into a <b class=\"node\">Matrix Construction</b> node (Column mode). M1 should be set to (0, 1, 0, 0). M3 isn’t too important but should set it to (0, 0, 0, 1).</li><br></ul><br><div class=\"img-center\"><br><a href=\"sg-billboard-matrix.png\" target=\"_blank\" rel=\"noopener noreferrer\"><br><img loading=\"lazy\" width=\"750\" height=\"285\" alt=\"(Image)\" src=\"sg-billboard-matrix.png\" /><br></a><br><p class=\"img-text\"></p><br></div><br><p>One of the above matrices is then used in the following setup :</p><br><div class=\"img-center\"><br><a href=\"sg-billboard.png\" target=\"_blank\" rel=\"noopener noreferrer\"><br><img loading=\"lazy\" width=\"750\" height=\"180\" alt=\"(Image)\" src=\"sg-billboard.png\" /><br></a><br><p class=\"img-text\"></p><br></div><br>"
		}
	},
	{
		"@type": "Question",
		"name": "Worldspace Planar Mapping",
		"acceptedAnswer": { 
			"@type": "Answer", 
			"text": "<p>Textures are typically applied to the mesh using UV coordinates stored in the vertex data. But we can also use other coordinates.</p><br><p>In a technique usually referred to as “Worldspace Planar Mapping” (sometimes also called “Worldspace Projected UV”), we use the <b class=\"node\">Position</b> node set to World space. This is a Vector3 output but nodes that take a UV port use a Vector2 though, so we first need to <b class=\"node\">Swizzle</b> (or <b class=\"node\">Split</b> and recombine into a <b class=\"node\">Vector2</b> node), where we can also reorder the components. For example, we can use RB (aka XZ) axis.</p><br><ul><br><li>Note that in HDRP, you would use Absolute World space instead, as that pipeline uses <a href=\"https://docs.unity3d.com/Packages/com.unity.render-pipelines.high-definition@12.0/manual/Camera-Relative-Rendering.html\">Camera Relative Rendering</a>. Using the regular World space would make the texture move with the Camera.</li><br></ul><br><div class=\"img-center\"><br><a href=\"sg-planar-mapping.png\" target=\"_blank\" rel=\"noopener noreferrer\"><br><img loading=\"lazy\" width=\"421\" height=\"249\" alt=\"(Image)\" src=\"sg-planar-mapping.png\" /><br></a><br><p class=\"img-text\"></p><br></div><br><p>This can then be put into a <b class=\"node\">Sample Texture 2D</b>, or any other nodes that have a UV port - such as procedural noise (<b class=\"node\">Simple Noise</b> and <b class=\"node\">Gradient Noise</b>).</p><br><p>Because we are in World space this acts like projecting the texture from above/below (as the G/Y axis is the one that we didn’t use). The texture will be stretched for any faces that are vertical, but this method is useful for flat surfaces. The texture also does not move, rotate or scale with the object, and so seamlessly continues over neighbouring objects.</p><br><div class=\"img-center\"><br><a href=\"sg-planar-mapping-2.png\" target=\"_blank\" rel=\"noopener noreferrer\"><br><img loading=\"lazy\" width=\"467\" height=\"351\" alt=\"(Image)\" src=\"sg-planar-mapping-2.png\" /><br></a><br><p class=\"img-text\"></p><br></div><br><p>We could also project from other axis by using the RG/XY or GB/YZ ports (and swizzle these further for 90 deg rotations).</p><br><p>Sampling from all three axis, then blending based on the <b class=\"node\">Normal Vector</b> is known as <strong>Triplanar Mapping</strong>. There is a <b class=\"node\">Triplanar</b> node which handles this for you - with only one texture input for all three axis though. For supporting different textures per axis, you’d need to handle it yourself by recreating it in nodes or using a <b class=\"node\">Custom Function</b>. I have a page on my <a href=\"https://cyangamedev.wordpress.com/2020/01/28/worldspace-uvs-triplanar-mapping/\">old site</a> explaining this further.</p><br>"
		}
	},
	{
		"@type": "Question",
		"name": "Sampling Textures in <b class=\"node\">Custom Function</b> node",
		"acceptedAnswer": { 
			"@type": "Answer", 
			"text": "<p>Shader Graph already provides some texture sampling nodes (e.g. <b class=\"node\">Sample Texture 2D</b>) for use in the graph. But it can be useful to sample inside a <b class=\"node\">Custom Function</b>, e.g. inside a loop, or to access sampling macros that don’t have built-in nodes.</p><br><h4 id=\"sg-custom-function-textures-macros\">Macros</h4><br><p>In shader code online you might typically see <code>sampler2D</code> and <code>tex2D()</code> functions being used. This is the older DX9 syntax, but with Shader Graph we mostly use the newer DX11+ syntax which has <a href=\"https://docs.unity3d.com/Manual/SL-SamplerStates.html\">separate objects for the texture and sampler</a>. This isn’t supported in all platforms though (GLES2), so Unity provides a bunch of <strong>macros</strong> which can generate different code. These macros are defined in files found under <a href=\"https://github.com/Unity-Technologies/Graphics/tree/master/Packages/com.unity.render-pipelines.core/ShaderLibrary/API\">render-pipelines.core/ShaderLibrary/API</a>.</p><br><p>Some important macros for sampling textures are listed below :</p><br><ul><br><li><br><p>Sample : Can be used in Fragment stage only</p><br><ul><br><li><code>SAMPLE_TEXTURE2D(textureName, samplerName, coord2)</code></li><br><li><code>SAMPLE_TEXTURECUBE(textureName, samplerName, coord3)</code></li><br><li><code>SAMPLE_TEXTURE3D(textureName, samplerName, coord3)</code></li><br><li><code>SAMPLE_TEXTURE2D_ARRAY(textureName, samplerName, coord2, index)</code></li><br><li><code>SAMPLE_TEXTURECUBE_ARRAY(textureName, samplerName, coord3, index)</code></li><br><li>These macros would end up using <a href=\"https://learn.microsoft.com/en-us/windows/win32/direct3dhlsl/dx-graphics-hlsl-to-sample\">tex.Sample(…)</a> (on DX11+ type platforms)</li><br></ul><br></li><br><li><br><p>Sample Level (of Detail) : Provides lod input to specify the mip map level sampled. Can be used in both Vertex & Fragment stages</p><br><ul><br><li><code>SAMPLE_TEXTURE2D_LOD(textureName, samplerName, coord2, lod)</code></li><br><li><code>SAMPLE_TEXTURECUBE_LOD(textureName, samplerName, coord3, lod)</code></li><br><li><code>SAMPLE_TEXTURE3D_LOD(textureName, samplerName, coord3, lod)</code></li><br><li><code>SAMPLE_TEXTURE2D_ARRAY_LOD(textureName, samplerName, coord2, index, lod)</code></li><br><li><code>SAMPLE_TEXTURECUBE_ARRAY_LOD(textureName, samplerName, coord3, index, lod)</code></li><br><li>These macros would end up using <a href=\"https://learn.microsoft.com/en-us/windows/win32/direct3dhlsl/dx-graphics-hlsl-to-samplelevel\">tex.SampleLevel(…)</a> (on DX11+ type platforms)</li><br></ul><br></li><br><li><br><p>Sample Bias : Provides a bias to adjust the mip map level. Can be used in Fragment stage only.</p><br><ul><br><li><code>SAMPLE_TEXTURE2D_BIAS(textureName, samplerName, coord2, bias)</code></li><br><li><code>SAMPLE_TEXTURECUBE_BIAS(textureName, samplerName, coord3, bias)</code></li><br><li><code>SAMPLE_TEXTURE2D_ARRAY_BIAS(textureName, samplerName, coord2, index, bias)</code></li><br><li><code>SAMPLE_TEXTURECUBE_ARRAY_BIAS(textureName, samplerName, coord3, index, bias)</code></li><br><li>Doesn’t seem to be BIAS macros for Texture3D. May be able to use <a href=\"https://learn.microsoft.com/en-us/windows/win32/direct3dhlsl/dx-graphics-hlsl-to-samplebias\">tex.SampleBias(…)</a> function still (or <a href=\"https://learn.microsoft.com/en-us/windows/win32/direct3dhlsl/dx-graphics-hlsl-tex3dbias\">tex3Dbias</a> for GLES2)</li><br></ul><br></li><br><li><br><p>Sample Gradient : Provides inputs for partial derivatives. Can be used in both Vertex & Fragment stages. (Unless you use <code>ddx()</code>/<code>ddy()</code> functions to calculate those derivates as those are Fragment only). These are useful when the UV coords used for sampling aren’t continous, see <a href=\"#sg-pixellated-seams\">Pixellation along seams question above</a>.</p><br><ul><br><li><code>SAMPLE_TEXTURE2D_GRAD(textureName, samplerName, coord2, dpdx, dpdy)</code></li><br><li><code>SAMPLE_TEXTURE2D_ARRAY_GRAD(textureName, samplerName, coord2, index, dpdx, dpdy)</code></li><br><li>Doesn’t seem there is GRAD macros for other texture types. May be able to use <a href=\"https://learn.microsoft.com/en-us/windows/win32/direct3dhlsl/dx-graphics-hlsl-to-samplegrad\">tex.SampleGrad(…)</a> function still (or <a href=\"https://learn.microsoft.com/en-us/windows/win32/direct3dhlsl/dx-graphics-hlsl-texcubegrad\">texCUBEgrad</a>/<a href=\"https://learn.microsoft.com/en-us/windows/win32/direct3dhlsl/dx-graphics-hlsl-tex3dgrad\">tex3Dgrad</a> for GLES2)</li><br></ul><br></li><br></ul><br><h4 id=\"sg-custom-function-textures-types\">Shader Graph Texture Types</h4><br><p>In Shader Graph v10.3+ (Unity 2020.2.3f1+), structs were added which wrap textures and their associated samplers together, allowing them to both be passed into a <b class=\"node\">Custom Function</b> node in a single parameter. These types are defined in <a href=\"https://github.com/Unity-Technologies/Graphics/blob/master/Packages/com.unity.render-pipelines.core/ShaderLibrary/Texture.hlsl\">render-pipelines.core/ShaderLibrary/Texture.hlsl</a></p><br><ul><br><li>UnityTexture2D (“Texture 2D” in SG dropdown)</li><br><li>UnityTexture2DArray (“Texture 2D Array” in SG dropdown)</li><br><li>UnityTexture3D (“Texture 3D” in SG dropdown)</li><br><li>UnityTextureCube (“Cubemap” in SG dropdown)</li><br><li>UnitySamplerState (“Sampler State” in SG dropdown)</li><br></ul><br><p>The sampler state associated with the texture can be accessed using <code>.samplerstate</code> on the UnityTextureX object. UnityTexture2D also has access to the Texel Size (via <code>.texelSize</code>).</p><br><h4 id=\"sg-custom-function-textures-example\">Custom Function Example (v10.3+)</h4><br><p>If you aren’t familiar with the <b class=\"node\">Custom Function</b> node syntax see <a href=\"/tutorials/intro-to-shader-graph/#custom-functions\">Intro to Shader Graph - Custom Functions</a> and <a href=\"https://docs.unity3d.com/Packages/com.unity.shadergraph@13.1/manual/Custom-Function-Node.html\">Custom Function docs page</a>.</p><br><p>Here is an example sampling a 3D Texture, using LOD version so it could be used in the vertex stage. This code would be put in a <code>.hlsl</code> file for use with <b class=\"node\">Custom Function</b> <strong>File</strong> mode. It would also work with <strong>String</strong> mode but then you would only want the <strong>body</strong> of the function (inside <code>{}</code>) and you need to match the names for inputs/outputs.</p><br><div class=\"highlight\"><div style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"><br><table style=\"border-spacing:0;padding:0;margin:0;border:0;\"><tr><td style=\"vertical-align:top;padding:0;margin:0;border:0;\"><br><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"><code><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\">1<br></span><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\">2<br></span><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\">3<br></span></code></pre></td><br><td style=\"vertical-align:top;padding:0;margin:0;border:0;;width:100%\"><br><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"><code class=\"language-c\" data-lang=\"c\"><span style=\"display:flex;\"><span><span style=\"color:#66d9ef\">void</span> <span style=\"color:#a6e22e\">Example_float</span>(UnityTexture3D Tex, float3 UV, out float4 Out){<br></span></span><span style=\"display:flex;\"><span>    Out <span style=\"color:#f92672\">=</span> SAMPLE_TEXTURE3D_LOD(Tex, Tex.samplerstate, UV, <span style=\"color:#ae81ff\">0</span>);<br></span></span><span style=\"display:flex;\"><span>}</span></span></code></pre></td></tr></table><br></div><br></div><br><p>Inputs :</p><br><ul><br><li>“Texture 3D”, named “Tex”</li><br><li>“Vector2”, named “UV”</li><br></ul><br><p>Outputs :</p><br><ul><br><li>“Vector4”, named “Out”</li><br></ul><br><h4 id=\"sg-custom-function-textures-example-2\">Custom Function Example (Pre-v10.3)</h4><br><p>Earlier versions don’t have these <code>UnityTextureX/UnitySamplerState</code> types so instead need to use the HLSL texture objects, such as <code>Texture3D</code> and <code>SamplerState</code>. For example :</p><br><div class=\"highlight\"><div style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"><br><table style=\"border-spacing:0;padding:0;margin:0;border:0;\"><tr><td style=\"vertical-align:top;padding:0;margin:0;border:0;\"><br><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"><code><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\">1<br></span><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\">2<br></span><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\">3<br></span></code></pre></td><br><td style=\"vertical-align:top;padding:0;margin:0;border:0;;width:100%\"><br><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"><code class=\"language-c\" data-lang=\"c\"><span style=\"display:flex;\"><span><span style=\"color:#66d9ef\">void</span> <span style=\"color:#a6e22e\">Example_float</span>(Texture3D Tex, SamplerState SS, float3 UV, out float4 Out){<br></span></span><span style=\"display:flex;\"><span>    Out <span style=\"color:#f92672\">=</span> SAMPLE_TEXTURE3D_LOD(Tex, SS, UV, <span style=\"color:#ae81ff\">0</span>);<br></span></span><span style=\"display:flex;\"><span>}</span></span></code></pre></td></tr></table><br></div><br></div><br><p>Inputs :</p><br><ul><br><li>“Texture 3D”, named “Tex”</li><br><li>“SamplerState”, named “SS”</li><br><li>“Vector2”, named “UV”</li><br></ul><br><p>Outputs :</p><br><ul><br><li>“Vector4”, named “Out”</li><br></ul><br><p>This could also be used in newer versions, by using the “Bare Texture 3D” and “Bare Sampler State” options on the input/output types. (Though this will likely error in GLES2 platforms, hence why the newer structs were introduced)</p><br>"
		}
	},
	{
		"@type": "Question",
		"name": "Using Float/Vector Arrays in Shader Graph",
		"acceptedAnswer": { 
			"@type": "Answer", 
			"text": "<p>Unity supports fixed-size Float and Vector(4) arrays in shaders. We can define them in Shader Graph by using a <b class=\"node\">Custom Function</b> node. In this case, we <em>must</em> use the File mode as the array has to be defined outside the function scope - and this is not possible using String mode.</p><br><p>Here is some example code, defining an array named <code>_ExampleArray</code>, containing 10 floats. Note that the <code>[10]</code> is put after the name, not after <code>float</code>. We can then index the array inside the function, in this case using a loop to add the contents together.</p><br><div class=\"highlight\"><div style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"><br><table style=\"border-spacing:0;padding:0;margin:0;border:0;\"><tr><td style=\"vertical-align:top;padding:0;margin:0;border:0;\"><br><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"><code><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\">1<br></span><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\">2<br></span><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\">3<br></span><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\">4<br></span><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\">5<br></span><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\">6<br></span><span style=\"white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\">7<br></span></code></pre></td><br><td style=\"vertical-align:top;padding:0;margin:0;border:0;;width:100%\"><br><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"><code class=\"language-c\" data-lang=\"c\"><span style=\"display:flex;\"><span><span style=\"color:#66d9ef\">float</span> _ExampleArray[<span style=\"color:#ae81ff\">10</span>];<br></span></span><span style=\"display:flex;\"><span> <br></span></span><span style=\"display:flex;\"><span><span style=\"color:#66d9ef\">void</span> <span style=\"color:#a6e22e\">ExampleFunction_float</span>(out <span style=\"color:#66d9ef\">float</span> Sum){<br></span></span><span style=\"display:flex;\"><span>   <span style=\"color:#66d9ef\">for</span> (<span style=\"color:#66d9ef\">int</span> i<span style=\"color:#f92672\">=</span><span style=\"color:#ae81ff\">0</span>;i<span style=\"color:#f92672\"><</span><span style=\"color:#ae81ff\">10</span>;i<span style=\"color:#f92672\">++</span>){<br></span></span><span style=\"display:flex;\"><span>      Sum <span style=\"color:#f92672\">+=</span> _ExampleArray[i];<br></span></span><span style=\"display:flex;\"><span>   }<br></span></span><span style=\"display:flex;\"><span>}</span></span></code></pre></td></tr></table><br></div><br></div><br><p>The array would then be set from a C# script, using :</p><br><div class=\"highlight\"><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"><code class=\"language-cs\" data-lang=\"cs\"><span style=\"display:flex;\"><span>Shader.SetGlobalFloatArray(<span style=\"color:#e6db74\">"_ExampleArray"</span>, floatArray);</span></span></code></pre></div><br><p>For a Vector4 array, you would use <code>float4</code> instead of <code>float</code>, and :</p><br><div class=\"highlight\"><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"><code class=\"language-cs\" data-lang=\"cs\"><span style=\"display:flex;\"><span>Shader.SetGlobalVectorArray(<span style=\"color:#e6db74\">"_ExampleArray"</span>, vectorArray);</span></span></code></pre></div><br><p>When using these C# functions, make sure that <code>floatArray</code> (or <code>vectorArray</code>) has the same length that is specified in the shader! Can pad with zeros if required.</p><br><p>I also have a <a href=\"/tutorials/forcefield-shader-breakdown/\">forcefield shader breakdown</a> which uses an array, if you want a real example.</p><br>"
		}
	},
	{
		"@type": "Question",
		"name": "LOD Crossfade using dithering",
		"acceptedAnswer": { 
			"@type": "Answer", 
			"text": "<p>The following graph can be used to support <strong>Fade Mode</strong> : “Cross Fade” on the <strong>LOD Group</strong> component.</p><br><p>This requires using a built-in variable, <code>unity_LODFade</code>. Shader Graph doesn’t provide access to it but we can use a <b class=\"node\">Custom Function</b> node (<strong>String</strong> mode). Add a single <strong>Float</strong> output named “Out” and set <strong>Body</strong> to <code>Out = unity_LODFade.x;</code>. The function’s name isn’t that important but needs to be set to something.</p><br><p>For use with the <b class=\"node\">Dither</b> node, we first need to <b class=\"node\">Absolute</b> to bring any negative values into the positive range. However to make sure it fades in the correct direction, we also need to take the <b class=\"node\">Sign</b> of <code>unity_LODFade.x</code>, and <b class=\"node\">Multiply</b> by the dither result.</p><br><div class=\"img-center\"><br><a href=\"sg-lodfade.png\" target=\"_blank\" rel=\"noopener noreferrer\"><br><img loading=\"lazy\" width=\"750\" height=\"157\" alt=\"(Image)\" src=\"sg-lodfade.png\" /><br></a><br><p class=\"img-text\"></p><br></div><br><p>As shown, can then optionally use a <strong>Boolean Keyword</strong> (set this up in the <strong>Blackboard</strong> window. While highlighted change it’s settings under the <strong>Node Settings</strong> tab of <strong>Graph Inspector</strong> window).</p><br><ul><br><li><strong>Name</strong> : Is Fading</li><br><li><strong>Reference</strong> : <code>LOD_FADE_CROSSFADE</code></li><br><li><strong>Definition</strong> : Multi-Compile</li><br><li><strong>Scope</strong> : Global</li><br><li><strong>Exposed</strong> : No / Unticked</li><br></ul><br><p>Drag the keyword into the graph, then put the result of our <b class=\"node\">Multiply</b> into the <strong>On</strong> port, and set the <strong>Off</strong> port to <strong>1</strong>.</p><br><p>Using this keyword may be optional, but it means we can avoid having to do the dither calculations when not in the crossfading range. However this would affect batching, so you may want to try it with and without and profile both.</p><br><p>The above graph results in this when moving the camera :</p><br><div class=\"img-center\"><br><a href=\"lod-crossfade.gif\" target=\"_blank\" rel=\"noopener noreferrer\"><br><img loading=\"lazy\" width=\"367\" height=\"298\" alt=\"(Image)\" src=\"lod-crossfade.gif\" /><br></a><br><p class=\"img-text\"></p><br></div><br><p>With LOD Group setup looking something like this :</p><br><div class=\"img-center\"><br><a href=\"lod-group.png\" target=\"_blank\" rel=\"noopener noreferrer\"><br><img loading=\"lazy\" width=\"473\" height=\"400\" alt=\"(Image)\" src=\"lod-group.png\" /><br></a><br><p class=\"img-text\">(Usually would have less tris in your higher/further away LODs, but the meshes here is just for example)</p><br></div><br><p>For fading based on time, enable <strong>Animate Cross-fading</strong>. Can control the duration (globally) by setting <code>LODGroup.crossFadeAnimationDuration</code> from a C# script.</p><br><p>For fading based on distance, disable <strong>Animate Cross-fading</strong> and edit the “Fade Transition Width” values.</p><br><p>See <a href=\"https://docs.unity3d.com/Manual/class-LODGroup.html\">Unity Docs : LOD Group</a> for more info.</p><br>"
		}
	},
	{
		"@type": "Question",
		"name": "Per-Object Stabilised Screen Position",
		"acceptedAnswer": { 
			"@type": "Answer", 
			"text": "<p>For some effects it can be useful to project a texture/noise/etc from screen space (using the <b class=\"node\">Screen Position</b> node into UV ports). When the object or camera moves the texture stays in place relative to the screen, so changes on the model. That isn’t always the desired effect - it could be useful if the texture stayed relative to the object itself.</p><br><p>One easy way to achieve something like this is to use View Space instead, and offset it by the object’s origin in the same space. I do this in my <a href=\"/tutorials/dissolve-shader-breakdown/#view-position-uvs\">Dissolve Shader Breakdown</a> :</p><br><div class=\"img-center\"><br><a href=\"/tutorials/dissolve-shader-breakdown/Graph5.png\" target=\"_blank\" rel=\"noopener noreferrer\"><br><img loading=\"lazy\"   alt=\"(Image)\" src=\"/tutorials/dissolve-shader-breakdown/Graph5.png\" /><br></a><br><p class=\"img-text\"></p><br></div><br><p>This can create some warping when objects are close to the sides of the camera view, but still tends to work pretty well.</p><br><p>The same thing can be done in screen space (which doesn’t have this warping issue), but the graph is more complicated. It also includes optional groups to deal with screen aspect ratio (so texture/noise isn’t stretched) and make UVs scale down when viewing at a distance :</p><br><div class=\"img-center\"><br><a href=\"sg-object-screenspace-uv.png\" target=\"_blank\" rel=\"noopener noreferrer\"><br><img loading=\"lazy\" width=\"750\" height=\"158\" alt=\"(Image)\" src=\"sg-object-screenspace-uv.png\" /><br></a><br><p class=\"img-text\">(Click image to view fullscreen)</p><br></div><br><p>In newer versions of Shader Graph (v14 / Unity 2022.2+) the <b class=\"node\">Transform</b> node now has a <strong>Screen</strong> option, therefore we can simplify the “Stabilised Screen Position” group in the above graph :</p><br><div class=\"img-center\"><br><a href=\"sg-object-screenspace-uv-2.png\" target=\"_blank\" rel=\"noopener noreferrer\"><br><img loading=\"lazy\" width=\"682\" height=\"484\" alt=\"(Image)\" src=\"sg-object-screenspace-uv-2.png\" /><br></a><br><p class=\"img-text\"></p><br></div><br>"
		}
	},
	{
		"@type": "Question",
		"name": "Distorting Textures in Multiple Directions / Flowmaps",
		"acceptedAnswer": { 
			"@type": "Answer", 
			"text": "<p>There may be cases where you want to displace/distort a texture in multiple directions. But just using <code>Direction * Time</code> to offset the UV coordinates will mean the difference in values grows larger between where the directions change - tilling and stretching the texture more and more in that gap.</p><br><p>There may be multiple methods to solve this - sampling a texture multiple times with displacements in each cardinal direction and blending between them comes to mind, but that isn’t ideal. The below technique provides a better solution that only uses 2 samples so should also be fairly performant.</p><br><p>The idea is to have the time repeat, by using the <b class=\"node\">Fraction</b> node to only take the decimal part of the value. The displacement will jump back to 0 when time reaches 1, but to avoid seeing this <em>we fade the texture out</em> while fading another version in that uses a different <em>phase</em> (time offset by 0.5).</p><br><p>The fading is controlled by two “triangle waves” using the same repeating time values.</p><br><ul><br><li>(Shader Graph technically has a <b class=\"node\">Triangle Wave</b> node built in for calculating that, but it returns a <strong>-1 to 1</strong> range while we need <strong>0 to 1</strong>. Could use a <b class=\"node\">Remap</b> or <b class=\"node\">Inverse Lerp</b> but I’ve instead calculated the wave myself below, with <b class=\"node\">Multiply</b> by <strong>2</strong>, <b class=\"node\">One Minus</b>, <b class=\"node\">Absolute</b>, <b class=\"node\">One Minus</b>)</li><br></ul><br><p>Here’s an example graph showing the implementation :</p><br><div class=\"img-center\"><br><a href=\"sg-flowmap.png\" target=\"_blank\" rel=\"noopener noreferrer\"><br><img loading=\"lazy\" width=\"750\" height=\"357\" alt=\"(Image)\" src=\"sg-flowmap.png\" /><br></a><br><p class=\"img-text\">(Click image to view fullscreen)</p><br></div><br><p>The section highlighted in orange is the same for both the top and bottom (but with A input swapped for B) so putting this into a SubGraph may help keep the graph more organised.</p><br><p>In the top left, two options are shown for obtaining the displacement directions. Can either use a “Flowmap” - essentially the same as a Normal Map but typically only with RG channels. Should likely still be imported and treated the same as a Normal Map, or at least disable sRGB so colour space differences don’t mess with values. Will also need to remap from the 0 to 1 range of the texture to the <strong>-1 to 1</strong> range of direction vectors. I’ve used the “Normal” mode on the <b class=\"node\">Sample Texture 2D</b> to handle this for me.</p><br><p>The other option is storing directions in the mesh data, such as <b class=\"node\">Vertex Color</b>. You may also want a <b class=\"node\">Normalize</b> node after the remapping here. You can then paint the mesh in modelling software like Blender, or in Unity using <strong>Polybrush</strong> (found in Package Manager), or find a way to set the directions from C#.</p><br><p>In both cases, any values will work but (0.5, 0.5) would be no displacement. (0, 0.5) would be towards the left, (1, 0.5) for right, (0.5, 0) for down, (0.5, 1) for up, etc.</p><br><p>For more details, <a href=\"https://catlikecoding.com/unity/tutorials/flow/texture-distortion/\">this “Texture Distortion” CatlikeCoding tutorial</a> should help explain the technique.</p><br>"
		}
	},
	{
		"@type": "Question",
		"name": "Multi-pass shaders",
		"acceptedAnswer": { 
			"@type": "Answer", 
			"text": "<p>Shader code can contain multiple passes that define LightMode tags. See <a href=\"https://docs.unity3d.com/Manual/SL-PassTags.html#lightmode-tag\">here for related docs page</a> which also links to lists of LightMode values used by Built-in & URP.</p><br><p>In the <strong>Built-in Render Pipeline</strong>, you can also have multiple passes <strong>without a LightMode tag</strong> (or <code>"LightMode"="Always"</code>) which are rendered without lighting/shadows. Unity will render each one as a separate draw call, though the exact render order also depends on the queue :</p><br><ul><br><li>In the <strong>Opaque</strong> queue (Geometry + AlphaTest), all objects render at once using the passes sequentially.<br><ul><br><li>i.e. All objects render Pass 1, then all objects Pass 2, etc.</li><br><li>This works with Static Batching (separate batch per pass that is) - though appears to break Dynamic Batching.</li><br></ul><br></li><br><li>In the <strong>Transparent</strong> queue, each object renders separately (furthest from camera first) going through the passes sequentially.<br><ul><br><li>i.e. First object renders Pass 1, Pass 2, etc. Second object renders Pass 1, Pass 2, etc.</li><br><li>This is likely to avoid blending issues, but also means draw calls will not batch.</li><br></ul><br></li><br></ul><br><p>In the <strong>Universal Render Pipeline</strong>, it is <em>possible</em> to have one Pass with <code>"LightMode"="UniversalForward"</code>, as well as one pass without (or <code>"LightMode"="SRPDefaultUnlit"</code>) and both will render… However this breaks SRP Batcher compatibility for objects using the shader, so is not recommended if the shader will be applied to many objects.</p><br><p>Better options for URP are :</p><br><ul><br><li>Use a <strong>custom LightMode</strong> tag, and tell it to render via a <strong>Custom Renderer Feature</strong> or <strong>RenderObjects</strong> feature (put same custom tag value under Shader Tags list)</li><br><li>Or <strong>split passes into two separate shaders & materials</strong>, then either :<br><ul><br><li>Use a <strong>RenderObjects</strong> feature to re-render objects with an <strong>Override Material</strong>, filtered to a particular Layer. This works well when dealing with <em>many objects</em>. (If for some reason you can’t use Layers for filtering, there is also a “Rendering Layer Mask” on Renderer component, but would need to write a custom feature to filter using that, as RenderObjects doesn’t include an option for it)</li><br><li>Apply <strong>more Materials</strong> to the MeshRenderer. If you go over the submesh count, it’ll render each submesh again. (While this works, I have seen some Unity devs mentioning to not rely on this behaviour. It’s possible this isn’t really intentional so could change in the future)</li><br><li><strong>Duplicate the object</strong> with the Renderer and change it’s Material(s). Parent under the original object to keep them in sync.</li><br></ul><br></li><br></ul><br><p>Note that in 2022.2+ we also have a <strong>Override Shader</strong> option on the RenderObjects feature (and in <code>DrawingSettings</code> used with <code>ScriptableRenderContext.DrawRenderers</code> in a custom feature). This will keep using the <em>same property values from the original shader</em>, closer matching <a href=\"https://docs.unity3d.com/Manual/SL-ShaderReplacement.html\">Replacement Shaders</a> from BiRP. However, I believe objects rendered with overriden shaders currently do not SRP Batch, so if there is many objects involved it could be expensive. Should try to only use this where required.</p><br>"
		}
	},
	{
		"@type": "Question",
		"name": "Using properties with ShaderLab operations (ZWrite / ZTest / Cull / ColorMask / Blend / Stencil)",
		"acceptedAnswer": { 
			"@type": "Answer", 
			"text": "<p>Rather than hardcoding ShaderLab operations, it is possible to specify a <strong>Property</strong> so they can be changed on the material or at runtime (e.g. through <code>material.SetFloat</code>)</p><br><div class=\"highlight\"><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"><code class=\"language-c\" data-lang=\"c\"><span style=\"display:flex;\"><span><span style=\"color:#75715e\">// (in Properties)<br></span></span></span><span style=\"display:flex;\"><span><span style=\"color:#75715e\"></span>[Enum(Off, <span style=\"color:#ae81ff\">0</span>, On, <span style=\"color:#ae81ff\">1</span>)] _ZWrite(<span style=\"color:#e6db74\">"Z Write"</span>, Float) <span style=\"color:#f92672\">=</span> <span style=\"color:#ae81ff\">1</span><br></span></span><span style=\"display:flex;\"><span>[Enum(UnityEngine.Rendering.CompareFunction)] _ZTest(<span style=\"color:#e6db74\">"ZTest"</span>, Float) <span style=\"color:#f92672\">=</span> <span style=\"color:#ae81ff\">4</span> <span style=\"color:#75715e\">// "LessEqual"<br></span></span></span><span style=\"display:flex;\"><span><span style=\"color:#75715e\"></span>[Enum(UnityEngine.Rendering.CullMode)] _Cull (<span style=\"color:#e6db74\">"Cull"</span>, Float) <span style=\"color:#f92672\">=</span> <span style=\"color:#ae81ff\">2</span> <span style=\"color:#75715e\">// "Back"<br></span></span></span><span style=\"display:flex;\"><span><span style=\"color:#75715e\"></span>[Enum(UnityEngine.Rendering.ColorWriteMask)] _ColorMask (<span style=\"color:#e6db74\">"ColorMask"</span>, Float) <span style=\"color:#f92672\">=</span> <span style=\"color:#ae81ff\">15</span> <span style=\"color:#75715e\">// "RGBA"<br></span></span></span><span style=\"display:flex;\"><span><span style=\"color:#75715e\"></span><br></span></span><span style=\"display:flex;\"><span>[Enum(UnityEngine.Rendering.BlendMode)] _BlendSrc (<span style=\"color:#e6db74\">"Blend Src Factor"</span>, Float) <span style=\"color:#f92672\">=</span> <span style=\"color:#ae81ff\">1</span> <span style=\"color:#75715e\">// "One"<br></span></span></span><span style=\"display:flex;\"><span><span style=\"color:#75715e\"></span>[Enum(UnityEngine.Rendering.BlendMode)] _BlendDst (<span style=\"color:#e6db74\">"Blend Dst Factor"</span>, Float) <span style=\"color:#f92672\">=</span> <span style=\"color:#ae81ff\">0</span> <span style=\"color:#75715e\">// "Zero"<br></span></span></span><span style=\"display:flex;\"><span><span style=\"color:#75715e\"></span>[Enum(UnityEngine.Rendering.BlendMode)] _BlendSrcA (<span style=\"color:#e6db74\">"Blend Src Factor (Alpha)"</span>, Float) <span style=\"color:#f92672\">=</span> <span style=\"color:#ae81ff\">1</span> <span style=\"color:#75715e\">// "One"<br></span></span></span><span style=\"display:flex;\"><span><span style=\"color:#75715e\"></span>[Enum(UnityEngine.Rendering.BlendMode)] _BlendDstA (<span style=\"color:#e6db74\">"Blend Dst Factor (Alpha)"</span>, Float) <span style=\"color:#f92672\">=</span> <span style=\"color:#ae81ff\">0</span> <span style=\"color:#75715e\">// "Zero"<br></span></span></span><span style=\"display:flex;\"><span><span style=\"color:#75715e\"></span>[Enum(UnityEngine.Rendering.BlendOp)] _BlendOp (<span style=\"color:#e6db74\">"Blend Op"</span>, Float) <span style=\"color:#f92672\">=</span> <span style=\"color:#ae81ff\">0</span> <span style=\"color:#75715e\">// "Add"<br></span></span></span><span style=\"display:flex;\"><span><span style=\"color:#75715e\"></span><br></span></span><span style=\"display:flex;\"><span>[Enum(UnityEngine.Rendering.CompareFunction)] _StencilComp (<span style=\"color:#e6db74\">"Stencil Comparison"</span>, Float) <span style=\"color:#f92672\">=</span> <span style=\"color:#ae81ff\">0</span> <span style=\"color:#75715e\">// "Disabled"<br></span></span></span><span style=\"display:flex;\"><span><span style=\"color:#75715e\"></span>[IntRange] _Stencil (<span style=\"color:#e6db74\">"Stencil ID"</span>, Range (<span style=\"color:#ae81ff\">0</span>, <span style=\"color:#ae81ff\">255</span>)) <span style=\"color:#f92672\">=</span> <span style=\"color:#ae81ff\">0</span><br></span></span><span style=\"display:flex;\"><span>[Enum(UnityEngine.Rendering.StencilOp)] _StencilOp (<span style=\"color:#e6db74\">"Stencil Op (Pass)"</span>, Float) <span style=\"color:#f92672\">=</span> <span style=\"color:#ae81ff\">2</span> <span style=\"color:#75715e\">// "Replace"<br></span></span></span><span style=\"display:flex;\"><span><span style=\"color:#75715e\"></span>[Enum(UnityEngine.Rendering.StencilOp)] _StencilOpFail (<span style=\"color:#e6db74\">"Stencil Op (Fail)"</span>, Float) <span style=\"color:#f92672\">=</span> <span style=\"color:#ae81ff\">0</span> <span style=\"color:#75715e\">// "Keep"<br></span></span></span><span style=\"display:flex;\"><span><span style=\"color:#75715e\"></span>[Enum(UnityEngine.Rendering.StencilOp)] _StencilOpZFail (<span style=\"color:#e6db74\">"Stencil Op (ZFail)"</span>, Float) <span style=\"color:#f92672\">=</span> <span style=\"color:#ae81ff\">0</span> <span style=\"color:#75715e\">// "Keep"<br></span></span></span><span style=\"display:flex;\"><span><span style=\"color:#75715e\"></span>_StencilWriteMask (<span style=\"color:#e6db74\">"Stencil Write Mask"</span>, Float) <span style=\"color:#f92672\">=</span> <span style=\"color:#ae81ff\">255</span><br></span></span><span style=\"display:flex;\"><span>_StencilReadMask (<span style=\"color:#e6db74\">"Stencil Read Mask"</span>, Float) <span style=\"color:#f92672\">=</span> <span style=\"color:#ae81ff\">255</span><br></span></span><span style=\"display:flex;\"><span><br></span></span><span style=\"display:flex;\"><span>...<br></span></span><span style=\"display:flex;\"><span><br></span></span><span style=\"display:flex;\"><span><span style=\"color:#75715e\">// (in SubShader/Pass)<br></span></span></span><span style=\"display:flex;\"><span><span style=\"color:#75715e\"></span>ZWrite [_ZWrite]<br></span></span><span style=\"display:flex;\"><span>ZTest [_ZTest]<br></span></span><span style=\"display:flex;\"><span>Cull [_Cull]<br></span></span><span style=\"display:flex;\"><span>ColorMask [_ColorMask]<br></span></span><span style=\"display:flex;\"><span><br></span></span><span style=\"display:flex;\"><span><span style=\"color:#75715e\">//Blend [_BlendSrc] [_BlendDst] // Uses Blend mode for both RGB and Alpha channels<br></span></span></span><span style=\"display:flex;\"><span><span style=\"color:#75715e\"></span>Blend [_BlendSrc] [_BlendDst], [_BlendSrcA] [_BlendDstA] <span style=\"color:#75715e\">// Use different Blend mode for Alpha<br></span></span></span><span style=\"display:flex;\"><span><span style=\"color:#75715e\"></span>BlendOp [_BlendOp]<br></span></span><span style=\"display:flex;\"><span><br></span></span><span style=\"display:flex;\"><span>Stencil {<br></span></span><span style=\"display:flex;\"><span>    Ref [_Stencil]<br></span></span><span style=\"display:flex;\"><span>    Comp [_StencilComp]<br></span></span><span style=\"display:flex;\"><span>    Pass [_StencilOp]<br></span></span><span style=\"display:flex;\"><span>    Fail [_StencilOpFail]<br></span></span><span style=\"display:flex;\"><span>    ZFail [_StencilOpZFail]<br></span></span><span style=\"display:flex;\"><span>    ReadMask [_StencilReadMask]<br></span></span><span style=\"display:flex;\"><span>    WriteMask [_StencilWriteMask]<br></span></span><span style=\"display:flex;\"><span>}</span></span></code></pre></div><br>"
		}
	},
	{
		"@type": "Question",
		"name": "What is Tangent Space?",
		"acceptedAnswer": { 
			"@type": "Answer", 
			"text": "<p>Tangent space uses vectors from the mesh data to stay relative to the surface of the mesh. It can be difficult to visualise for an entire model as unlike other spaces, it can be different per-pixel.</p><br><div class=\"img-center\"><br><a href=\"tangent-space.png\" target=\"_blank\" rel=\"noopener noreferrer\"><br><img loading=\"lazy\" width=\"285\" height=\"279\" alt=\"(Image)\" src=\"tangent-space.png\" /><br></a><br><p class=\"img-text\">A way to visualise the tangent space for a given point (centered at the gizmo)</p><br></div><br><p>The <strong>Normal</strong> vector you should be familiar with, points out from each vertex - It’s the Z axis of tangent space (shown in blue, since XYZ=RGB). The X and Y axis use the <strong>Tangent</strong> vector and a <strong>Bitangent</strong> vector (also called <strong>Binormal</strong>) - which is typically calculated using a Cross Product with the other two vectors.</p><br><p>These tangent and bitangent vectors are also aligned to the direction of the UV coordinates stored in the mesh. (The tangent follows the X axis of the UV coordinates, and the bitangent follows the Y axis)</p><br><p>The space is needed so tangent space normal maps (that use UV coordinates for sampling) can be converted back to world space to produce correct lighting/shading. The tangent space View Direction is also used to produce Parallax effects.</p><br><p>Of note, if you are using techniques like <strong>Triplanar Mapping</strong>, then the “Tangent space” you’d need would be different than the Tangent space calculated from mesh data. <a href=\"https://bgolus.medium.com/normal-mapping-for-a-triplanar-shader-10bf39dca05a\">This article by Ben Golus</a> explains this in detail. In Shader Graph, the <b class=\"node\">Triplanar</b> node already takes this into account when using it’s Normal mode (I believe using the “Whiteout Blend” example)</p><br>"
		}
	},
	{
		"@type": "Question",
		"name": "How do I get color of Particle System, Trail Renderer & Sprite Renderer",
		"acceptedAnswer": { 
			"@type": "Answer", 
			"text": "<p>Colors here are passed into vertex colors - data stored in each vertex of the mesh. To obtain this :</p><br><ul><br><li>In HLSL, use the <code>: COLOR</code> semantic in the vertex input struct.</li><br><li>In Shader Graph, use the <b class=\"node\">Vertex Color</b> node.</li><br></ul><br><p>Also note that Sprite Graphs will already automatically tint the output using this. There <a href=\"https://github.com/Unity-Technologies/Graphics/commit/3ca7a6bdefed68a482a2429f75b508f309b8c1a6\">will be an option to disable this</a>. Might be in 2023.3 (currently a pre-release as of writing), but otherwise will have to wait for later versions.</p><br><p>For Sprite Renderer, might vary slightly. If instanced, in Built-in RP sprites use a <code>_RendererColor</code> property in the instancing buffer. In newer versions of URP (2023.1+) that has been replaced with <code>unity_SpriteColor</code>, may need to try a Custom Function to access/output that.</p><br>"
		}
	},
	{
		"@type": "Question",
		"name": "How to obtain Local Sprite UVs (0-1 across each sprite) for sprite sheets / sprite atlas",
		"acceptedAnswer": { 
			"@type": "Answer", 
			"text": "See <a href=\"/tutorials/sprite-local-uv/\">Local UVs for Sprites in Sprite Sheet/Atlas</a> post."
		}
	},
	{
		"@type": "Question",
		"name": "How do you get the origin of a Mesh in the shader?",
		"acceptedAnswer": { 
			"@type": "Answer", 
			"text": "<p>The origin of a mesh is (0,0,0) in object space. To calculate this in world space we could use a matrix multiplciation, like <code>float3 originWS = mul(UNITY_MATRIX_M, float4(0,0,0,1)).xyz</code>, however a cheaper method is to extract the translation data from the matrix :</p><br><ul><br><li><code>UNITY_MATRIX_M._m03_m13_m23</code></li><br><li>(or <code>unity_ObjectToWorld._m03_m13_m23</code>)</li><br></ul><br><p>This is equivalent to the <strong>Position</strong> output of the <b class=\"node\">Object</b> node in Shader Graph.</p><br>"
		}
	},
	{
		"@type": "Question",
		"name": "Why does the Object space (& <b class=\"node\">Object</b> node) not work correctly for Sprites?",
		"acceptedAnswer": { 
			"@type": "Answer", 
			"text": "<p>Note : Unity 2023.1+ now uses SRP Batching for sprites (in play mode at least) which somewhat fixes this.</p><br><p>For prior versions (and if SRP batching is disabled) :</p><br><p>To save on drawcalls (and performance), Sprites on the screen that use the same material, are batched so they can be drawn together. It shows as “Draw Dynamic” in the Frame Debugger window. When this batching occurs, meshes for each sprite are transformed into World space and combined into a single object. The model matrix (<code>UNITY_MATRIX_M</code>) is cleared to an identity matrix (scale of 1, no rotation/translation)</p><br><p>The model matrix is usually responsible for transforming vertex data stored in the mesh into World space, but an identity matrix is used so the values aren’t altered. “Object space” now doesn’t really exist on the shader side, as the vertex positions are <em>already stored in World space</em>.</p><br><p>Anything else that relies on the model matrix also won’t work correctly, such as calculating the origin and scale of the object (outputs on the <b class=\"node\">Object</b> node)</p><br><p>There isn’t really a good way around this afaik, but I don’t work in 2D that often. You could break batching by using different material instances, but that may not be good for performance. Typically you would try to rely on UV coordinates rather than vertex positions.</p><br><p>You could consider using MeshRenderers instead as they can support the SRP Batcher - which doesn’t combine meshes, but instead batches setup between the draw calls.</p><br>"
		}
	},
	{
		"@type": "Question",
		"name": "Error : <code>maximum ps_5_0 sampler register index (16) exceeded</code>",
		"acceptedAnswer": { 
			"@type": "Answer", 
			"text": "<p>This error means the shader is using more than 16 samplers. While shaders can support more textures (DX11 supports 128), it has a much lower limit to the number of samplers. To get around this, we can <strong>re-use samplers from other textures</strong> or use <strong>inline sampler states</strong>.</p><br><ul><br><li>Note this requires using the DX11-style syntax where samplers are separated from textures (e.g. <code>Texture2D</code> and <code>SamplerState</code>, rather than <code>sampler2D</code>).</li><br><li>Can find more information on the <a href=\"https://docs.unity3d.com/Manual/SL-SamplerStates.html\">SL-SamplerStates docs</a> page.</li><br></ul><br><p>In Shader Graph, can use <b class=\"node\">Sampler State</b> node to achieve this, which would be connected to the sampler port on the <b class=\"node\">Sample Texture 2D</b> node.</p><br>"
		}
	},
	{
		"@type": "Question",
		"name": "HLSL fmod vs GLSL mod",
		"acceptedAnswer": { 
			"@type": "Answer", 
			"text": "<p>Be aware that the GLSL <code>mod</code> function is not an exact equivalent to <code>fmod</code> function in HLSL, the result will be different when dealing with negative values.</p><br><ul><br><li>HLSL fmod is equivalent to <code>x - y * trunc(x/y)</code></li><br><li>GLSL mod is equivalent to <code>x - y * floor(x/y))</code></li><br></ul><br><p>If you are converting a shader, you may want to implement your own mod function using that code instead.</p><br>"
		}
	},
	{
		"@type": "Question",
		"name": "CG vs HLSL",
		"acceptedAnswer": { 
			"@type": "Answer", 
			"text": "<p>While many shaders in the Built-in RP use <code>CGPROGRAM</code> and <code>ENDCG</code> in their shader code, they are still actually written (and compiled) using <strong>HLSL</strong>. Unity used to use Nvidia’s <strong>CG</strong> language, but it was deprecated and is no longer used.</p><br><p>When using the <code>CGPROGRAM</code> tag, Unity automatically includes some files from the Built-in RP shader includes (such as <code>HLSLSupport.cginc</code> and <code>UnityShaderVariables.cginc</code>). This can cause conflicts with other shader libraries - so shaders written for the Post Processing package, URP, and HDRP, should all use <code>HLSLPROGRAM</code> and <code>ENDHLSL</code> instead.</p><br><p>Even if it is all HLSL, it’s important to note that the code written for each pipeline can still vary quite a lot as they use separate include files, which can contain different functions and macros. Can view the ShaderLibrary code via :</p><br><ul><br><li>For Built-in RP, can view via <a href=\"https://github.com/TwoTailsGames/Unity-Built-in-Shaders\">this unofficial Github repo</a>, or <a href=\"https://unity3d.com/get-unity/download/archive\">download it from Unity’s site</a> (Select “Built-in Shaders” option from a dropdown for the version you are using)</li><br><li><a href=\"https://github.com/Unity-Technologies/Graphics/tree/master/Packages/com.unity.render-pipelines.core/ShaderLibrary\">SRP (Scriptable Render Pipeline) core</a> - Accessible to URP, HDRP and custom SRPs.</li><br><li><a href=\"https://github.com/Unity-Technologies/Graphics/tree/master/Packages/com.unity.render-pipelines.universal/ShaderLibrary\">URP</a> - Also see my <a href=\"/tutorials/urp-shader-code/\">Writing Shader Code for URP</a> post.</li><br><li><a href=\"https://github.com/Unity-Technologies/Graphics/tree/master/Packages/com.unity.render-pipelines.high-definition/Runtime\">HDRP</a></li><br></ul><br>"
		}
	}
  ]
}
</script>

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="FAQ"/>
<meta name="twitter:description" content="List of frequent (or interesting) questions I&#39;ve answered"/>

<meta property="og:title" content="FAQ" />
<meta property="og:description" content="List of frequent (or interesting) questions I&#39;ve answered" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.cyanilux.com/faq/" />

	
<meta property="article:published_time" content="2024-03-13T00:00:00+00:00" />
<meta property="article:modified_time" content="2024-03-13T00:00:00+00:00" />
<title>FAQ | Cyanilux</title>
<meta name="description" content="List of frequent (or interesting) questions I&#39;ve answered. | Unity Shader Tutorials, @Cyanilux"/>
<link rel="canonical" href="https://www.cyanilux.com/faq/" />
<script>
	var webStorageSupported = (typeof(Storage) !== undefined);
	
	function getCookie(cname) {
		var name = cname + "=";
		var decodedCookie = decodeURIComponent(document.cookie);
		var ca = decodedCookie.split(';');
		for(var i = 0; i <ca.length; i++) {
			var c = ca[i];
			while (c.charAt(0) == ' ') {
				c = c.substring(1);
			}
			if (c.indexOf(name) == 0) {
				return c.substring(name.length, c.length);
			}
		}
		return "";
	}
	
	var cookie;
	if (webStorageSupported){
		cookie = localStorage.getItem("cookiesAccepted");
	}else{
		cookie = getCookie("cookiesAccepted");
	}
	
	var showBanner = false;
	var cookiesAccepted = false;
	if (cookie == "true"){
		cookiesAccepted = true;
		showBanner = false;
	}else if (cookie === null || cookie == ""){
		showBanner = true;
	}
</script>



<script>
	if (cookiesAccepted){
		
		document.write("<script async src=\"https://www.googletagmanager.com/gtag/js?id=G-11MK1LK6C3\"><\/script>" +
		"<script>\n"+
		"window.dataLayer = window.dataLayer || [];\n" +
		"function gtag(){dataLayer.push(arguments);}\n" +
		"gtag('js', new Date());\n" +
		"gtag('config', 'G-11MK1LK6C3', { 'anonymize_ip': true });\n" + 
		"<\/script>");
	}
</script>


</head>
    <body>
        
<div class="header">
	<div class="logo-header-div"> 
	<a class="link-plain" href="https://www.cyanilux.com">
		<img class="logo" alt="Logo" width="128" height="128" src="https://www.cyanilux.com/logo-small.png"/>
	</a>
	<div class="logo-text-div">
		<h1 class="title-no-margin">
			<a class="logo-text" href="https://www.cyanilux.com">Cyanilux</a>
		</h1>
		<b class="logo-subtext">Game Dev Blog &amp; Tutorials</b>
	</div>
	</div>
	
	<div class="nav-links-div">
	<nav id="nav-links" class="nav-links">
		<ul>
			
			<li><a class="nav-link" href="https://twitter.com/Cyanilux">
			<img width="35" height="35" alt="Twitter" src="https://www.cyanilux.com/logo-twitter.png" ></img>
			</a>
			</li>
			
			<li><a class="nav-link" href="https://mastodon.gamedev.place/@Cyanilux">
			<img width="35" height="35" alt="Mastodon" src="https://www.cyanilux.com/logo-mastodon.png" ></img>
			</a>
			</li>
			
			<li><a class="nav-link" href="http://discord.gg/2V93q9w">
			<img width="35" height="35" alt="Discord" src="https://www.cyanilux.com/logo-discord.png" ></img>
			</a>
			</li>
			
			<li><a class="nav-link" href="https://github.com/Cyanilux">
			<img width="35" height="35" alt="Github" src="https://www.cyanilux.com/logo-github.png" ></img>
			</a>
			</li>
			
			<li><a class="nav-link" href="https://ko-fi.com/cyanilux">
			<img width="35" height="35" alt="Ko-Fi" src="https://www.cyanilux.com/logo-kofi.png" ></img>
			</a>
			</li>
			
		</ul>
	</nav>
	</div>
	
	<nav id="nav" class="nav">
	<ul>
		
		<li><b><a class="nav-link" href="https://www.cyanilux.com/contents/">
		Contents
		</a></b>
		</li>
		
		<li><b><a class="nav-link" href="https://www.cyanilux.com/recent/">
		Recent Posts
		</a></b>
		</li>
		
		<li><b><a class="nav-link" href="https://www.cyanilux.com/resources/">
		Resources
		</a></b>
		</li>
		
		<li><b><a class="nav-link" href="https://www.cyanilux.com/faq/">
		FAQ
		</a></b>
		</li>
		
	</ul>
	</nav>
</div>
        <div class="content">
        

<h1>FAQ</h1>
<div class="post-metadata">









<div style="width:5px"></div>
<time datetime="2024-03-13"> (updated 13 Mar 2024)</time>

</div>
<p>Over time I&rsquo;ve answered quite a few questions in the Shaders (and URP) channels on the <a href="https://discord.com/invite/unity">Official Unity Discord</a> (as well as my own <a href="http://discord.gg/2V93q9w">discord</a>). But one problem with using discords over regular forums, is those answers are no longer searchable through Google - so I&rsquo;ve made this page!</p>
<ul>
<li><em>(Also so I can link here when the questions get asked again, rather than having to repeat myself)</em></li>
<li>Will update when I see other frequent (or just interesting) questions come along!</li>
<li>Use the browser Find function (Ctrl+F) to search for keywords (in titles).
<ul>
<li>If you want to search in answers too, <a href="?expand-all-foldouts">Click Here</a> to expand all foldouts first.</li>
</ul>
</li>
<li>Click buttons below to foldout answers! This also changes the URL so you can link to them! :)</li>
</ul>
<p>Sections :</p>
<ul>
<li><a href="#general">General Unity</a></li>
<li><a href="#shader-graph">Shader Graph (Issues / Workarounds)</a></li>
<li><a href="#sg-snippets">Shader Graph (Examples / Snippets)</a></li>
<li><a href="#shaders">Shaders</a> (HLSL/ShaderLab and info common to both code/graphs)</li>
</ul>
<h3 id="general">General Unity</h3>
<button id="scene-magenta" type="button" class="foldout_button" onclick="
    this.classList.toggle('active');
    var content = this.nextElementSibling;
    if (content.style.display === 'block') {
      content.style.display = 'none';
      this.innerHTML = '<b>⯈ Scene Materials are Magenta\/Pink</b>';
    } else {
      content.style.display = 'block';
      this.innerHTML = '<b>⯆ Scene Materials are Magenta\/Pink</b>';

      if (history.pushState) {
        var newurl = window.location.protocol + '//' + window.location.host + window.location.pathname;
        newurl = newurl + '#scene-magenta';
        window.history.pushState({path:newurl}, '', newurl);
      }

    }
"><b>⯈ Scene Materials are Magenta/Pink</b></button>
<div class="foldout">
<p>You&rsquo;ll commonly see your materials turn magenta if you&rsquo;ve tried switching to a different render pipeline. This occurs because each pipeline uses different shaders.</p>
<p>You can automatically convert any materials using Unity&rsquo;s shaders (e.g. Standard) :</p>
<ul>
<li>URP (2021.2+) : <a href="https://docs.unity3d.com/Packages/com.unity.render-pipelines.universal@12.1/manual/features/rp-converter.html">RP Converter Window</a></li>
<li>URP (older versions) : <a href="https://docs.unity3d.com/Packages/com.unity.render-pipelines.universal@11.0/manual/upgrading-your-shaders.html">Upgrading Materials</a></li>
<li>HDRP : <a href="https://docs.unity3d.com/Packages/com.unity.render-pipelines.high-definition@13.1/manual/Render-Pipeline-Wizard.html">Render Pipeline Wizard</a></li>
</ul>
<p>Any custom shaders (that you&rsquo;ve written or from downloaded assets) <em>cannot be converted automatically</em>. You would need to rewrite them or a find a replacement asset.</p>
<p>If you aren&rsquo;t upgrading, materials can also turn magenta when there is an error in the shader syntax (Should be able to see these in the Console, or in the Inspector when the shader asset is selected).</p>
<p>If a magenta material is using a Shader Graph, be sure the <a href="https://www.cyanilux.com/faq/#sg-magenta">target is assigned correctly</a>, and save the graph using the <strong>Save Asset</strong> button in the top left of the shader graph window.</p>
<p>In a build, magenta materials could also mean the shader uses a <a href="https://docs.unity3d.com/Manual/SL-ShaderCompileTargets.html">compile target</a> which is higher than what is supported by the platform.</p>

</div>

<button id="scene-always-refresh" type="button" class="foldout_button" onclick="
    this.classList.toggle('active');
    var content = this.nextElementSibling;
    if (content.style.display === 'block') {
      content.style.display = 'none';
      this.innerHTML = '<b>⯈ Material\/Shaders are animated during Play Mode but not in Editor \/ Scene View</b>';
    } else {
      content.style.display = 'block';
      this.innerHTML = '<b>⯆ Material\/Shaders are animated during Play Mode but not in Editor \/ Scene View</b>';

      if (history.pushState) {
        var newurl = window.location.protocol + '//' + window.location.host + window.location.pathname;
        newurl = newurl + '#scene-always-refresh';
        window.history.pushState({path:newurl}, '', newurl);
      }

    }
"><b>⯈ Material/Shaders are animated during Play Mode but not in Editor / Scene View</b></button>
<div class="foldout">
<div class="img-right">
<a href="scene-always-refresh.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="182" height="143" alt="(Image)" src="scene-always-refresh.png" />
</a>
<p class="img-text"></p>
</div>
<p>By default the Scene View does not constantly re-render it&rsquo;s camera to help with editor performance.</p>
<p>If requried though, there&rsquo;s a dropdown in the top right where you can enable &ldquo;Always Refresh&rdquo; (or &ldquo;Animated Materials&rdquo; in older versions)</p>

</div>

<button id="transparent-sorting" type="button" class="foldout_button" onclick="
    this.classList.toggle('active');
    var content = this.nextElementSibling;
    if (content.style.display === 'block') {
      content.style.display = 'none';
      this.innerHTML = '<b>⯈ Issues with sorting Transparent faces\/objects.</b>';
    } else {
      content.style.display = 'block';
      this.innerHTML = '<b>⯆ Issues with sorting Transparent faces\/objects.</b>';

      if (history.pushState) {
        var newurl = window.location.protocol + '//' + window.location.host + window.location.pathname;
        newurl = newurl + '#transparent-sorting';
        window.history.pushState({path:newurl}, '', newurl);
      }

    }
"><b>⯈ Issues with sorting Transparent faces/objects.</b></button>
<div class="foldout">
<p>Correctly sorting transparent geometry can be difficult. It&rsquo;s basically an unsolved problem in realtime computer graphics. There usually isn&rsquo;t a single answer that can solve every case.</p>
<p>Opaque objects don&rsquo;t have this problem as they write to the <strong>Depth Buffer</strong> (ZWrite), which allows <strong>Depth Testing</strong> (ZTest) to occur to sort on a per-fragment/pixel basis. Unity also will render opaque objects closer to the camera first, so we don&rsquo;t need to waste time rendering pixels behind others.</p>
<p>But with the Transparent queue, shaders typically don&rsquo;t write to the depth buffer and we have to render objects further away first, in order to achieve the correct Alpha Blending. Even if depth write was enabled, it still wouldn&rsquo;t sort correctly when blending is involved.</p>
<p>Quick tips :</p>
<ul>
<li>Always split <strong>Opaque</strong> and <strong>Transparent</strong> parts of a model into separate meshes (or at least separate sub-meshes) and apply separate materials.</li>
<li>If your object doesn&rsquo;t need <em>partial transparency</em>, consider using <strong>Opaque</strong> with <strong>Alpha Clipping</strong> instead.
<ul>
<li>In HLSL, use <code>clip(alpha - threshold)</code> or <code>if (alpha &lt; threshold) discard;</code></li>
<li>In Shader Graph, can find this in <strong>Graph Settings</strong></li>
<li>This could also be paired with <strong>Dithering</strong> to fake some transparency. For example, see <a href="https://danielilett.com/2020-04-19-tut5-5-urp-dither-transparency/">this Shader Graph tutorial by Daniel Ilett</a></li>
</ul>
</li>
<li>In some cases, can swap to a different blend mode. Additive (<code>Blend One One</code>) and Multiplicative (i.e. <code>Blend Zero SrcColor</code>) blending modes in particular would produce the same results regardless of the order those objects are rendered in!</li>
</ul>
<p>Solutions to fixing common transparent sorting issues are listed below.</p>
<h4 id="render-queue">Render Queue</h4>
<p>Transparent objects will sort based on their mesh origin. If you know that a particular transparent material should <strong>always appear behind / on top</strong> of others, you can use the <strong>Render Queue</strong> or <strong>Sorting Priority</strong> on the material to force the render order.</p>
<div class="img-center">
<a href="sorting-priority.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="384" height="59" alt="(Image)" src="sorting-priority.png" />
</a>
<p class="img-text"></p>
</div>
<h4 id="pre-sorting-mesh-triangle-order">Pre-sorting Mesh Triangle Order</h4>
<p>When rendering a mesh, the faces are rendered in order of their <strong>indices/triangles</strong> array. In cases where you don&rsquo;t have intersecting geometry, it may be possible to <strong>pre-sort the triangles</strong> to force the draw order. This can be more performant than using the above method, but requires some setup in the modelling program.</p>
<div class="img-center">
<a href="transparent-sorting.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="537" height="248" alt="(Image)" src="transparent-sorting.png" />
</a>
<p class="img-text">A mesh consisting of layered spheres.<br>
Left : The inner spheres are incorrectly rendering on top.<br>
Right : Sorting corrected by combining layers in specific order in Blender.</p>
</div>
<p>It may vary in each 3D modelling program, but as you combine multiple meshes, the assumption is that the triangles are appended.</p>
<p>Example in Blender :</p>
<ol>
<li>Separate each &ldquo;layer&rdquo; of triangles into separate objects.</li>
<li>Select two layers - <strong>outer most layer first</strong>. I find it easiest to do this in the <strong>Outliner</strong> while holding <strong>Ctrl</strong></li>
<li>Combine/Join with <strong>Ctrl+J</strong> (while hovering over the 3D Viewport)</li>
<li>Repeat steps 2 &amp; 3 until each layer is collapsed down into a single mesh</li>
</ol>
<div class="img-center">
<a href="transparent-sorting-blender.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="750" height="132" alt="(Image)" src="transparent-sorting-blender.png" />
</a>
<p class="img-text">Blender Outliner, showing each layer being combined after repeating these steps.</p>
</div>
<ul>
<li>Note that using some Modifiers could change the triangle ordering.</li>
<li>You would want to keep using <code>Cull Back</code> with this method. If you need back faces you&rsquo;d need to duplicate the geometry will flipped faces/normals, and sort these triangles appropriately.</li>
<li>May also need to untick the &ldquo;Optimise Mesh : Polygon Order&rdquo; on the model import in Unity. As this may reorganise the triangle order.</li>
</ul>
<h4 id="transparent-depth-prepass">Transparent Depth Prepass</h4>
<p>When you don&rsquo;t want to see overlapping faces of the model through itself, we can use a prepass to write to the depth buffer only. When we then render our object normally it can ZTest against this.</p>
<div class="img-center">
<a href="transparent-depth-prepass.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="365" height="276" alt="(Image)" src="transparent-depth-prepass.png" />
</a>
<p class="img-text">Left : Normal Render<br>
Right : Render with Prepass<br>
(Character from <a href="https://www.kenney.nl/assets/animated-characters-2">Kenney Animated Characters 2</a>)</p>
</div>
<p>For Built-in RP, can add a pass before your main one :</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>Pass {
</span></span><span style="display:flex;"><span>    ZWrite On       <span style="color:#75715e">// Write to the Depth Buffer
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    ColorMask <span style="color:#ae81ff">0</span>     <span style="color:#75715e">// Don&#39;t write to the Color Buffer
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}</span></span></code></pre></td></tr></table>
</div>
</div>
<p>(Can find another example here : <a href="https://forum.unity.com/threads/transparent-depth-shader-good-for-ghosts.149511/">https://forum.unity.com/threads/transparent-depth-shader-good-for-ghosts.149511/</a>)</p>
<p>In other pipelines we can&rsquo;t use multi-pass shaders, but you can instead use a separate shader/material with -1 on the Sorting Priority (or Render Queue). Can use the following code in a <code>.shader</code> file (Create → Unlit Shader)</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>Shader <span style="color:#e6db74">&#34;Custom/DepthPrepass&#34;</span> {
</span></span><span style="display:flex;"><span>    Properties { }
</span></span><span style="display:flex;"><span>    SubShader {
</span></span><span style="display:flex;"><span>        Tags { <span style="color:#e6db74">&#34;Queue&#34;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Transparent-1&#34;</span> }
</span></span><span style="display:flex;"><span>        Pass {
</span></span><span style="display:flex;"><span>            ZWrite On
</span></span><span style="display:flex;"><span>            ColorMask <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li>Can then attach it as a <strong>second material on the Mesh Renderer</strong>.</li>
<li>If the mesh already has multiple sub-meshes / materials, may be better to separate that part of the mesh and use another GameObject &amp; MeshRenderer too.</li>
<li>For URP, if you have <em>many</em> objects that need this prepass, then rather than using multiple materials / GameObjects, you can use the <strong>Render Objects</strong> feature. This allows us to re-render a particular <strong>Layer</strong> with an <strong>Override Material</strong> (using our DepthPrepass shader)</li>
</ul>
<div class="img-center">
<a href="transparent-depth-prepass-renderobjects.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="308" height="235" alt="(Image)" src="transparent-depth-prepass-renderobjects.png" />
</a>
<p class="img-text"></p>
</div>
<ul>
<li>But note that using this removes the ability to see any other transparent objects through the mesh. (Unless they are moved to the Before Rendering Transparents event too)</li>
</ul>
<h4 id="oit">OIT</h4>
<p>There are also methods to achieve <a href="https://en.wikipedia.org/wiki/Order-independent_transparency">Order Independent Transparency</a> - But I&rsquo;m not at all familiar with these. I think they&rsquo;re quite expensive (either in terms of performance or memory), and Unity does not include any support for them so you&rsquo;d need to implement this stuff yourself (or find an asset/package that handles it for you. This would require custom shaders too though, so not easy to implement)</p>

</div>

<button id="urp-depth-priming" type="button" class="foldout_button" onclick="
    this.classList.toggle('active');
    var content = this.nextElementSibling;
    if (content.style.display === 'block') {
      content.style.display = 'none';
      this.innerHTML = '<b>⯈ Material with custom shader is invisible in URP</b>';
    } else {
      content.style.display = 'block';
      this.innerHTML = '<b>⯆ Material with custom shader is invisible in URP</b>';

      if (history.pushState) {
        var newurl = window.location.protocol + '//' + window.location.host + window.location.pathname;
        newurl = newurl + '#urp-depth-priming';
        window.history.pushState({path:newurl}, '', newurl);
      }

    }
"><b>⯈ Material with custom shader is invisible in URP</b></button>
<div class="foldout">
<p>2021.2+ versions of the URP have a <a href="https://docs.unity3d.com/Packages/com.unity.render-pipelines.universal@14.0/manual/urp-universal-renderer.html#rendering:~:text=.-,Depth%C2%A0Priming,-Mode">Depth Priming</a> option on the <strong>Universal Renderer Asset</strong> while using the Forward path. In the URP template this is set to Auto (enabled if URP is already doing a Depth Prepass rather than a CopyDepth pass. Can check Frame Debugger to see what is used)</p>
<div class="img-center">
<a href="urp-depth-priming.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="514" height="336" alt="(Image)" src="urp-depth-priming.png" />
</a>
<p class="img-text"></p>
</div>
<p>Depth Priming allows rendering opaque objects with a Depth Prepass, to populate the depth buffer without the fragment shading cost - potentially reducing the cost of overdraw in the opaque stage.</p>
<p>It requires shaders to have a pass with the <strong>DepthOnly</strong> LightMode tag in the shader (and <strong>DepthNormals</strong> if using a renderer feature that requires the Camera Normals Texture - such as SSAO or Decals). If a shader doesn&rsquo;t have these passes, the forward pass is still rendered (but with ZWrite Off) and the skybox later draws over it, hence it appears invisible.</p>
<p>For example of how to set these passes up, see the templates here : <a href="https://github.com/Cyanilux/URP_ShaderCodeTemplates/">https://github.com/Cyanilux/URP_ShaderCodeTemplates/</a></p>
<p>You could instead set Depth Priming to Disabled, which will make the object visible. However without the DepthOnly/DepthNormals passes, objects still may not appear in the Camera Depth Texture (<b class="node">Scene Depth</b> node) or Camera Normals Texture.</p>
<p>An alternative is using Shader Graph, which will generate the passes required by URP.</p>

</div>

<button id="onrenderimage" type="button" class="foldout_button" onclick="
    this.classList.toggle('active');
    var content = this.nextElementSibling;
    if (content.style.display === 'block') {
      content.style.display = 'none';
      this.innerHTML = '<b>⯈ OnRenderImage in URP</b>';
    } else {
      content.style.display = 'block';
      this.innerHTML = '<b>⯆ OnRenderImage in URP</b>';

      if (history.pushState) {
        var newurl = window.location.protocol + '//' + window.location.host + window.location.pathname;
        newurl = newurl + '#onrenderimage';
        window.history.pushState({path:newurl}, '', newurl);
      }

    }
"><b>⯈ OnRenderImage in URP</b></button>
<div class="foldout">
<p>OnRenderImage does not work in URP.</p>
<p>If you are using it to apply image effects with <code>Graphics.Blit</code>, In 2022.2+ should use the <strong>Fullscreen Pass Renderer Feature</strong> and <strong>Fullscreen Graph</strong> - or custom shader including <a href="https://github.com/Unity-Technologies/Graphics/blob/master/Packages/com.unity.render-pipelines.core/Runtime/Utilities/Blit.hlsl">Blit.hlsl</a>. Use the Vert function as the vertex shader and call FragBlit in your fragment shader.</p>
<p>For prior versions, can use my <a href="https://github.com/Cyanilux/URP_BlitRenderFeature">Blit Renderer Feature</a>.</p>
<p>For effects that require more than just a Blit, may need to write your own <a href="https://www.cyanilux.com/tutorials/custom-renderer-features/">Custom Renderer Feature</a> - my post on them may help (aimed at 2022+).</p>

</div>

<button id="edit-material" type="button" class="foldout_button" onclick="
    this.classList.toggle('active');
    var content = this.nextElementSibling;
    if (content.style.display === 'block') {
      content.style.display = 'none';
      this.innerHTML = '<b>⯈ Material greyed out \/ Cannot edit properties</b>';
    } else {
      content.style.display = 'block';
      this.innerHTML = '<b>⯆ Material greyed out \/ Cannot edit properties</b>';

      if (history.pushState) {
        var newurl = window.location.protocol + '//' + window.location.host + window.location.pathname;
        newurl = newurl + '#edit-material';
        window.history.pushState({path:newurl}, '', newurl);
      }

    }
"><b>⯈ Material greyed out / Cannot edit properties</b></button>
<div class="foldout">
<p>If you want to edit materials from <strong>imported models</strong> in Unity, you need to <strong>extract</strong> those materials before they can be edited. Click on the model file in the Project window under your assets, then the <a href="https://docs.unity3d.com/Manual/FBXImporter-Materials.html">Materials tab</a> in the Inspector. Should be a button to extract there.</p>
<p>Alternatively / For models with no materials / or for Unity default objects (Cube, Sphere, Capsule, etc) :</p>
<ul>
<li>Unity will automatically assign a default material which cannot be edited. You need to create your own material instead. In the Project window under your assets, right-click and select <strong>Create → Material</strong>. Choose an appropiate shader from the dropdown and adjust properties. Then drag the material onto the object, or assign it under the Renderer component (e.g. MeshRenderer, SpriteRenderer, UI Image, etc.)</li>
</ul>

</div>

<button id="edit-sg-material" type="button" class="foldout_button" onclick="
    this.classList.toggle('active');
    var content = this.nextElementSibling;
    if (content.style.display === 'block') {
      content.style.display = 'none';
      this.innerHTML = '<b>⯈ Shader Graph Material greyed out \/ Cannot edit properties</b>';
    } else {
      content.style.display = 'block';
      this.innerHTML = '<b>⯆ Shader Graph Material greyed out \/ Cannot edit properties</b>';

      if (history.pushState) {
        var newurl = window.location.protocol + '//' + window.location.host + window.location.pathname;
        newurl = newurl + '#edit-sg-material';
        window.history.pushState({path:newurl}, '', newurl);
      }

    }
"><b>⯈ Shader Graph Material greyed out / Cannot edit properties</b></button>
<div class="foldout">
<p>As of Unity 2022, Shader Graph automatically generates a <strong>Material</strong> under each graph asset. These materials cannot be edited from Unity&rsquo;s Inspector, but uses the default values assigned to properties within Shader Graph. To adjust them, select the property in the <strong>Blackboard</strong> and edit the <strong>Default</strong> field in the <strong>Graph Inspector</strong> window inside Shader Graph.</p>
<p>If you want a Material with values different than the defaults, you need to create a new Material asset using the shader. In the Project window under your assets, right-click the Shader Graph Asset then select <strong>Create → Material</strong>.</p>

</div>

<h3 id="shader-graph">Shader Graph (Issues / Workarounds)</h3>
<button id="sg-magenta" type="button" class="foldout_button" onclick="
    this.classList.toggle('active');
    var content = this.nextElementSibling;
    if (content.style.display === 'block') {
      content.style.display = 'none';
      this.innerHTML = '<b>⯈ Main Preview is Magenta\/Pink</b>';
    } else {
      content.style.display = 'block';
      this.innerHTML = '<b>⯆ Main Preview is Magenta\/Pink</b>';

      if (history.pushState) {
        var newurl = window.location.protocol + '//' + window.location.host + window.location.pathname;
        newurl = newurl + '#sg-magenta';
        window.history.pushState({path:newurl}, '', newurl);
      }

    }
"><b>⯈ Main Preview is Magenta/Pink</b></button>
<div class="foldout">
<div class="img-right">
<a href="sg-magenta.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="230" height="230" alt="(Image)" src="sg-magenta.png" />
</a>
<p class="img-text"></p>
</div>
<p>The <strong>Main Preview</strong> showing as Magenta/Pink usually means that the graph <strong>Target</strong> is not supported in the current <strong>Render Pipeline</strong>. This can be found under the <strong>Graph Settings</strong> tab of the <strong>Graph Inspector</strong> window - which you can toggle with a button in the top right of the graph.</p>
<p>If you have created a &ldquo;Blank Shader Graph&rdquo; you would also need to add a target to that list before you can use the graph on a material.</p>
<p>In 2021.2+ it is possible to add the Built-in RP as a target. Older verisons do not have support for Built-in and must use URP or HDRP. Once the URP or HDRP package is installed, there is more that is required to properly configure Unity to use those pipelines, such as assigning a pipeline asset under <strong>Project Settings</strong>.</p>
<p>See the documentation for steps (can select version in top left of these pages) :</p>
<ul>
<li>URP : <a href="https://docs.unity3d.com/Packages/com.unity.render-pipelines.universal@15.0/manual/InstallURPIntoAProject.html">Install URP into a Project</a></li>
<li>HDRP : <a href="https://docs.unity3d.com/Packages/com.unity.render-pipelines.high-definition@15.0/manual/Upgrading-To-HDRP.html">Upgrading to HDRP</a></li>
</ul>
<p>If you have already done this, check the <strong>Target</strong> (under the <strong>Graph Settings</strong> tab of the <strong>Graph Inspector</strong> window). Make sure this matches the the pipeline you have installed &amp; configured. Then save the graph using the <strong>Save Asset</strong> button in the top left.</p>
<p>May be able to find more information in my <a href="https://www.cyanilux.com/tutorials/intro-to-shader-graph/">Intro to Shader Graph</a> post.</p>
<p>Note that you may also see other previews showing as Magenta/Pink when obtaining undefined values (NAN), such as when dividing by zero, or using negative values in the Power node (as the hlsl pow function only supports positive ranges).</p>

</div>

<button id="sg-redirect" type="button" class="foldout_button" onclick="
    this.classList.toggle('active');
    var content = this.nextElementSibling;
    if (content.style.display === 'block') {
      content.style.display = 'none';
      this.innerHTML = '<b>⯈ How do I get the small redirect node?</b>';
    } else {
      content.style.display = 'block';
      this.innerHTML = '<b>⯆ How do I get the small redirect node?</b>';

      if (history.pushState) {
        var newurl = window.location.protocol + '//' + window.location.host + window.location.pathname;
        newurl = newurl + '#sg-redirect';
        window.history.pushState({path:newurl}, '', newurl);
      }

    }
"><b>⯈ How do I get the small redirect node?</b></button>
<div class="foldout">
<p>In v10+ (Unity 2020.2+), you can obtain a redirect node by <strong>double left-clicking a connection wire</strong>. Or right-click and select &ldquo;Add Redirect&rdquo;.</p>
<p><a href="https://www.cyanilux.com/tutorials/intro-to-shader-graph/#redirect">Intro to Shader Graph post - Redirect</a></p>

</div>

<button id="sg-stretched-texture-preview" type="button" class="foldout_button" onclick="
    this.classList.toggle('active');
    var content = this.nextElementSibling;
    if (content.style.display === 'block') {
      content.style.display = 'none';
      this.innerHTML = '<b>⯈ Preview on \u003cb class=\u0022node\u0022\u003eSample Texture 2D\u003c\/b\u003e looks stretched out when using a texture with alpha</b>';
    } else {
      content.style.display = 'block';
      this.innerHTML = '<b>⯆ Preview on \u003cb class=\u0022node\u0022\u003eSample Texture 2D\u003c\/b\u003e looks stretched out when using a texture with alpha</b>';

      if (history.pushState) {
        var newurl = window.location.protocol + '//' + window.location.host + window.location.pathname;
        newurl = newurl + '#sg-stretched-texture-preview';
        window.history.pushState({path:newurl}, '', newurl);
      }

    }
"><b>⯈ Preview on <b class="node">Sample Texture 2D</b> looks stretched out when using a texture with alpha</b></button>
<div class="foldout">
<p>This is intentional. Previews inside nodes <strong>do not show alpha/transparency</strong>, only the RGB data. It&rsquo;s common for colours to &ldquo;stretch out&rdquo; in fully transparent areas to avoid artifacts. If it was instead black in these areas, the colour might darken along the transparent edge. (That may look even worse when dealing with mipmaps, though you typically wouldn&rsquo;t have those with sprites in particular)</p>
<p>Only the Main Preview will show transparency.</p>
<div class="img-center">
<a href="sg-stretched-texture.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="464" height="306" alt="(Image)" src="sg-stretched-texture.png" />
</a>
<p class="img-text">(Robot Character from <a href="https://www.kenney.nl/assets/toon-characters-1">Kenney Toon Characters 1</a>)</p>
</div>
<p>Even with these stretched-out previews, the final result should look correct provided the alpha channel (A output from <b class="node">Sample Texture 2D</b>) is connected to the <strong>Alpha</strong> port in the <strong>Master Stack</strong>.</p>
<ul>
<li>If you don&rsquo;t see that port (or it is greyed out), your graph is currently set to be <strong>Opaque</strong>. Can change this to <strong>Transparent</strong> in the <strong>Graph Settings</strong> (tab of <strong>Graph Inspector</strong> window, toggled with button in top right of graph). Sprite graphs are always transparent by default.</li>
<li>If you still don&rsquo;t see the Alpha port, try adding the block manually (see <a href="https://www.cyanilux.com/tutorials/intro-to-shader-graph/#master-stack">Intro to Shader Graph post - Master Stack</a>)</li>
</ul>
<p>If for some reason you do need the texture masked correctly to the alpha, can <b class="node">Multiply</b> the RGBA and A outputs. Or if you need to control the background color, put the A output into the T input on a <b class="node">Lerp</b> with A as the background and B as the RGBA output.</p>

</div>

<button id="sg-fragment-only" type="button" class="foldout_button" onclick="
    this.classList.toggle('active');
    var content = this.nextElementSibling;
    if (content.style.display === 'block') {
      content.style.display = 'none';
      this.innerHTML = '<b>⯈ Can\u0026rsquo;t connect node to Vertex stage ports (Position, Normal, Tangent) in Master Stack</b>';
    } else {
      content.style.display = 'block';
      this.innerHTML = '<b>⯆ Can\u0026rsquo;t connect node to Vertex stage ports (Position, Normal, Tangent) in Master Stack</b>';

      if (history.pushState) {
        var newurl = window.location.protocol + '//' + window.location.host + window.location.pathname;
        newurl = newurl + '#sg-fragment-only';
        window.history.pushState({path:newurl}, '', newurl);
      }

    }
"><b>⯈ Can&rsquo;t connect node to Vertex stage ports (Position, Normal, Tangent) in Master Stack</b></button>
<div class="foldout">
<p>Some nodes can only be connected to the Fragment stage.</p>
<ul>
<li>The <b class="node">Is Front Face</b> node uses the <code>SV_IsFrontFace</code> semantic which is only available as an input to the fragment shader. This should make sense, as the vertex shader runs on vertices - which do not have any information about how they connect or the faces yet.</li>
<li>Partial screen space derivative functions (<b class="node">DDX</b>,  <b class="node">DDY</b>, <b class="node">DDXY</b>) are also only supported by the fragment shader, as they compare values for neighbouring fragments/pixels.</li>
</ul>
<p>Shader Graph does not make this problem very clear, but it is most commonly encountered when dealing with the <b class="node">Sample Texture 2D</b> node, which uses these derivatives behind the scenes to calculate the mipmap level when sampling. You would instead need to use the <b class="node">Sample Texture 2D LOD</b> version.</p>
<p>There are other nodes that rely on the derivates, such as <b class="node">Normal From Height</b> and the various procedural shapes (e.g. <b class="node">Ellipse</b>, <b class="node">Rectangle</b>, <b class="node">Polygon</b>, <b class="node">Rounded Rectangle</b>, <b class="node">Rounded Polygon</b>).</p>
<p>There are also nodes that use <code>SAMPLE_TEXTURE2D(tex, sampler, uv)</code> in their code (e.g. <b class="node">Triplanar</b>), but these could likely be rewritten manually via a <b class="node">Custom Function</b> node to use the <code>SAMPLE_TEXTURE2D_LOD(tex, sampler, uv, lod)</code> macro instead, in order to support the vertex shader. (Can view generated code for a specific node by right-clicking it and selecting <strong>Show Generated Code</strong> or <strong>Open Documentation</strong>)</p>
<p>For more information / nodes affected, see <a href="https://www.cyanilux.com/tutorials/intro-to-shader-graph/#fragment-only-nodes">Intro to Shader Graph post - Fragment-Only Nodes</a></p>

</div>

<button id="sg-vertex-displacement-normals" type="button" class="foldout_button" onclick="
    this.classList.toggle('active');
    var content = this.nextElementSibling;
    if (content.style.display === 'block') {
      content.style.display = 'none';
      this.innerHTML = '<b>⯈ Vertex Displacement doesn\u0026rsquo;t affect shading \/ How to update normal vectors</b>';
    } else {
      content.style.display = 'block';
      this.innerHTML = '<b>⯆ Vertex Displacement doesn\u0026rsquo;t affect shading \/ How to update normal vectors</b>';

      if (history.pushState) {
        var newurl = window.location.protocol + '//' + window.location.host + window.location.pathname;
        newurl = newurl + '#sg-vertex-displacement-normals';
        window.history.pushState({path:newurl}, '', newurl);
      }

    }
"><b>⯈ Vertex Displacement doesn&rsquo;t affect shading / How to update normal vectors</b></button>
<div class="foldout">
<p>Editing Vertex Positions does not automatically change the Normal Vectors, which are required to affect shading.</p>
<p>I have a few methods on how to calculate new normals listed here : <a href="https://www.cyanilux.com/tutorials/vertex-displacement/#recalculating-normals">Vertex Displacement post - Recalculating Normals</a></p>

</div>

<button id="sg-two-sided-shading" type="button" class="foldout_button" onclick="
    this.classList.toggle('active');
    var content = this.nextElementSibling;
    if (content.style.display === 'block') {
      content.style.display = 'none';
      this.innerHTML = '<b>⯈ Back faces are darker when using Lit Graph \u0026amp; Two-Sided \/ Render Face : Both</b>';
    } else {
      content.style.display = 'block';
      this.innerHTML = '<b>⯆ Back faces are darker when using Lit Graph \u0026amp; Two-Sided \/ Render Face : Both</b>';

      if (history.pushState) {
        var newurl = window.location.protocol + '//' + window.location.host + window.location.pathname;
        newurl = newurl + '#sg-two-sided-shading';
        window.history.pushState({path:newurl}, '', newurl);
      }

    }
"><b>⯈ Back faces are darker when using Lit Graph &amp; Two-Sided / Render Face : Both</b></button>
<div class="foldout">
<p>This occurs because the <strong>Normal</strong> vectors stored in the mesh are intended for the front faces only. We can flip them for back faces by making use of the <b class="node">Is Front Face</b> and <b class="node">Branch</b> nodes.</p>
<p>If using a Normal Map, we would use the result of our <b class="node">Sample Texture 2D</b> in the <strong>True</strong> input, and <b class="node">Multiply</b> it by (1, 1, -1) for the <strong>False</strong> input. This would then go into the <strong>Normal (Tangent Space)</strong> port on the Fragment stage of the <strong>Master Stack</strong>.</p>
<div class="img-center">
<a href="sg-two-sided-normal-tangent.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="750" height="191" alt="(Image)" src="sg-two-sided-normal-tangent.png" />
</a>
<p class="img-text"></p>
</div>
<p>If not using a Normal Map, we could use the <b class="node">Normal Vector</b> node in <strong>Tangent</strong> space - or just a <b class="node">Vector3</b> set to (0, 0, 1) as those will be equal&hellip;</p>
<p>But it should actually be cheaper to change the <strong>Fragment Normal Space</strong> to &ldquo;World&rdquo; in the <strong>Graph Settings</strong> (tab of <strong>Graph Inspector</strong>, toggled with button in the top right of graph), as this avoids the need for the Tangent → World transformation. We can then use the <b class="node">Normal Vector</b> node in <strong>World</strong> space for the <strong>True</strong> input and put through a <b class="node">Negate</b> node for the <strong>False</strong> input.</p>
<div class="img-center">
<a href="sg-two-sided-normal-world.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="750" height="205" alt="(Image)" src="sg-two-sided-normal-world.png" />
</a>
<p class="img-text"></p>
</div>

</div>

<button id="sg-pixellated-seams" type="button" class="foldout_button" onclick="
    this.classList.toggle('active');
    var content = this.nextElementSibling;
    if (content.style.display === 'block') {
      content.style.display = 'none';
      this.innerHTML = '<b>⯈ Pixellation along seams in UV when using \u003cb class=\u0022node\u0022\u003eFraction\u003c\/b\u003e with \u003cb class=\u0022node\u0022\u003eSample Texture 2D\u003c\/b\u003e</b>';
    } else {
      content.style.display = 'block';
      this.innerHTML = '<b>⯆ Pixellation along seams in UV when using \u003cb class=\u0022node\u0022\u003eFraction\u003c\/b\u003e with \u003cb class=\u0022node\u0022\u003eSample Texture 2D\u003c\/b\u003e</b>';

      if (history.pushState) {
        var newurl = window.location.protocol + '//' + window.location.host + window.location.pathname;
        newurl = newurl + '#sg-pixellated-seams';
        window.history.pushState({path:newurl}, '', newurl);
      }

    }
"><b>⯈ Pixellation along seams in UV when using <b class="node">Fraction</b> with <b class="node">Sample Texture 2D</b></b></button>
<div class="foldout">
<p>In some cases you might want to use the <b class="node">Fraction</b> node (aka <code>frac()</code> in HLSL) on the UVs (e.g. for repeating sections of a larger texture). But when using this with the <b class="node">Sample Texture 2D</b> you may notice some strange pixellation artifacts along the seam produced by the jump in the UV coordinates.</p>
<p>This isn&rsquo;t limited to the <b class="node">Fraction</b> node, but I find that this is the most common place where it is noticeable. It occurs for anything that causes a jump in the UVs. Another fairly common example is the seam in the Y component when using the <b class="node">Polar Coordinates</b> node.</p>
<div class="img-center">
<a href="sg-pixellated-seams.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="501" height="219" alt="(Image)" src="sg-pixellated-seams.png" />
</a>
<p class="img-text"></p>
</div>
<p>This pixellation occurs because the <b class="node">Sample Texture 2D</b> calculates the <strong>mipmap level</strong> for sampling by using the partial screenspace derivatives (<b class="node">DDX</b>, <b class="node">DDY</b>), which compare values between neighbouring pixels. The fragment shader can do this as it runs in 2x2 pixel blocks.</p>
<p>Usually this mipmapping is a good thing, as it reduces artifacts when viewing the texture at a distance. But when comparing values for pixels along this seam, the jump is interpreted as needing to sample a higher LOD/mipmap level for those pixels. At mipmap resolutions this small, it basically results in the colour being an average of the entire texture.</p>
<p>This pixellation can be fixed in a few ways :</p>
<ul>
<li>A simple fix is to disable mip maps for that texture (in it&rsquo;s import settings), or by using the <b class="node">Sample Texture 2D LOD</b> node to only use LOD/mipmap level 0 (the full resolution texture). But this could cause the artifacts as I mentioned above.</li>
<li>A better way to fix this is by using a <b class="node">Custom Function</b> node with <code>Out = SAMPLE_TEXTURE2D_GRAD(Texture, Texture.samplerstate, frac(UV), ddx(UV), ddy(UV));</code> with inputs &ldquo;Texture&rdquo; (Texture2D), &ldquo;UV&rdquo; (Vector2) and outputs &ldquo;Out&rdquo; (Vector4). You can then remove the <b class="node">Fraction</b> node from your graph as it is handled in the code instead (but only on the 2nd parameter, not the derivates!)</li>
<li>If you aren&rsquo;t using <b class="node">Fraction</b> but a different method that causes seams, you could use a similar function, but provide a separate UV input for the derivates e.g. <code>Out = SAMPLE_TEXTURE2D_GRAD(Texture, Texture.samplerstate, UV, ddx(DerivativeUV), ddy(DerivativeUV));</code>. Can then set the DerivativeUV to the <b class="node">UV</b> node.</li>
</ul>
<p>In Unity 2022.2+ can also now handle this all in graph by using the &ldquo;Gradient&rdquo; <strong>Mip Sampling Mode</strong> under the <strong>Node Settings</strong> on the <b class="node">Sample Texture 2D</b> node itself, to expose derivative inputs. Use the <b class="node">DDX</b> and <b class="node">DDY</b> nodes on some continous UV coordinates when connecting to these ports.</p>
<div class="img-center">
<a href="sg-gradient-sample.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="600" height="355" alt="(Image)" src="sg-gradient-sample.png" />
</a>
<p class="img-text"></p>
</div>

</div>

<button id="sg-unlit-shadows" type="button" class="foldout_button" onclick="
    this.classList.toggle('active');
    var content = this.nextElementSibling;
    if (content.style.display === 'block') {
      content.style.display = 'none';
      this.innerHTML = '<b>⯈ Sampling Shadows in a Unlit Graph (URP)</b>';
    } else {
      content.style.display = 'block';
      this.innerHTML = '<b>⯆ Sampling Shadows in a Unlit Graph (URP)</b>';

      if (history.pushState) {
        var newurl = window.location.protocol + '//' + window.location.host + window.location.pathname;
        newurl = newurl + '#sg-unlit-shadows';
        window.history.pushState({path:newurl}, '', newurl);
      }

    }
"><b>⯈ Sampling Shadows in a Unlit Graph (URP)</b></button>
<div class="foldout">
<p>In order to get shadows working in an Unlit Graph you need to add some important keywords which allow the ShaderLibrary to calculate shadow info.</p>
<p>I&rsquo;ve shared a <a href="https://github.com/Cyanilux/URP_ShaderGraphCustomLighting/">Custom Lighting for Shader Graph</a> package on github, which can handle this for you. For supporting shadows, use the <strong>Main Light Shadows</strong> and <strong>Additional Lights</strong> subgraphs. Both of these will work in Unlit Graphs.</p>
<h4 id="main-light-shadows">Main Light Shadows</h4>
<p>If you&rsquo;d instead prefer to handle it yourself, Create these <strong>Boolean Keywords</strong> in the Shader Graph <strong>Blackboard</strong> :</p>
<ul>
<li><code>_MAIN_LIGHT_SHADOWS</code> - Required to calculate shadows</li>
<li><code>_MAIN_LIGHT_SHADOWS_CASCADE</code> - Required to obtain correct shadows when using cascades &gt; 1</li>
<li><code>_SHADOWS_SOFT</code> - Adds support for the Soft Shadows option</li>
</ul>
<p>Make sure you set the Reference field, and not just the name. Also set them to Multi Compile and Global, and untick Exposed.</p>
<p>Can then sample shadows by calculating the <code>shadowCoord</code> :</p>
<ul>
<li><code>float4 shadowCoord = TransformWorldToShadowCoord(positionWS);</code></li>
</ul>
<p>Then use one of the following :</p>
<ul>
<li><code>Light light = GetMainLight(shadowCoord);</code> and <code>light.shadowAttenuation</code> to obtain the shadows.
<ul>
<li>also equivalent to : <code>float shadowAtten = MainLightRealtimeShadow(shadowCoord);</code></li>
</ul>
</li>
<li>(v11+ / 2021.1+) <code>Light light = GetMainLight(shadowCoord, positionWS, shadowMask)</code>, which additionally allows supporting the &ldquo;ShadowMask&rdquo; baked GI mode. You would typically pass <code>SAMPLE_SHADOWMASK(lightmapUV)</code> into the <code>shadowMask</code> parameter.
<ul>
<li>also equivalent to : <code>float shadowAtten = MainLightShadow(shadowCoord, positionWS, shadowMask, _MainLightOcclusionProbes);</code></li>
</ul>
</li>
</ul>
<h4 id="additional-light-shadows">Additional Light Shadows</h4>
<p>For additional lights, you need the following keywords:</p>
<ul>
<li><code>_ADDITIONAL_LIGHT_SHADOWS</code> - Required to calculate shadows</li>
<li><code>_ADDITIONAL_LIGHTS</code> - Required to prevent the other keyword being stripped from builds</li>
</ul>
<p>In your light loop, you&rsquo;d then use :</p>
<ul>
<li>(v8 to v10) <code>Light light = GetAdditionalLight(i, positionWS);</code>, again with <code>light.shadowAttenuation</code> to obtain shadows.</li>
<li>(v11+ / 2021.1+) <code>Light light = GetAdditionalLight(i, positionWS, shadowMask);</code>. The shadowMask parameter here can either be set to the same <code>SAMPLE_SHADOWMASK(lightmapUV)</code> variable, or can use <code>half4(1,1,1,1)</code> if you don&rsquo;t require supporting it. You still need to specify the parameter for the function to calculate shadows.</li>
</ul>
<p>For better examples see <a href="https://github.com/Cyanilux/URP_ShaderGraphCustomLighting/blob/main/CustomLighting.hlsl">CustomLighting.hlsl</a> in my Custom Lighting package. Also see the Lighting.hlsl, RealtimeLights.hlsl (v12+) and Shadows.hlsl files in the URP ShaderLibrary. Can find these under the Packages in the Project window, or via <a href="https://github.com/Unity-Technologies/Graphics/tree/master/Packages/com.unity.render-pipelines.universal/ShaderLibrary">Unity/Graphics github</a>.</p>

</div>

<button id="sg-lit-fog" type="button" class="foldout_button" onclick="
    this.classList.toggle('active');
    var content = this.nextElementSibling;
    if (content.style.display === 'block') {
      content.style.display = 'none';
      this.innerHTML = '<b>⯈ Disable Fog in a Lit Graph</b>';
    } else {
      content.style.display = 'block';
      this.innerHTML = '<b>⯆ Disable Fog in a Lit Graph</b>';

      if (history.pushState) {
        var newurl = window.location.protocol + '//' + window.location.host + window.location.pathname;
        newurl = newurl + '#sg-lit-fog';
        window.history.pushState({path:newurl}, '', newurl);
      }

    }
"><b>⯈ Disable Fog in a Lit Graph</b></button>
<div class="foldout">
<p>You can disable fog entirely via Unity&rsquo;s Lighting window (under Environement tab). If you still want fog enabled, but a certain object to not include fog, you can disable fog in a Lit Graph by using a <b class="node">Custom Function</b> node.</p>
<p>I&rsquo;d recommend using String mode, with a Vector4 Input named &ldquo;In&rdquo; and a Vector4 Output named &ldquo;Out&rdquo;. The function name can be anything (e.g. DisableFog), while the body should use :</p>
<p>For URP Target :</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>Out <span style="color:#f92672">=</span> In;
</span></span><span style="display:flex;"><span><span style="color:#75715e">#define MixFog(x,y) x</span></span></span></code></pre></td></tr></table>
</div>
</div>
<p>The function itself doesn&rsquo;t do anything, except pass the input straight through. But by using the <code>#define</code> we override the later <code>MixFog</code> function call (in <a href="https://github.com/Unity-Technologies/Graphics/blob/master/Packages/com.unity.render-pipelines.universal/Editor/ShaderGraph/Includes/PBRForwardPass.hlsl">URP/PBRForwardPass.hlsl</a>), so rather than applying fog it just outputs the unmodified colour.</p>
<p>For Built-in Target :</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>Out <span style="color:#f92672">=</span> In;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Untested, but I think this should work
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#undef UNITY_APPLY_FOG
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define UNITY_APPLY_FOG(x,y) y</span></span></span></code></pre></td></tr></table>
</div>
</div>
<p>For the Built-in version, they are already using the <code>UNITY_APPLY_FOG</code> macro (in <a href="https://github.com/Unity-Technologies/Graphics/blob/master/Packages/com.unity.shadergraph/Editor/Generation/Targets/BuiltIn/Editor/ShaderGraph/Includes/PBRForwardPass.hlsl">SG/Built-in/PBRForwardPass.hlsl</a>), so we undefine and then redefine it to output the colour (second parameter).</p>
<p>This is <em>kinda</em> hacky (abusing what macros are supposed to be used for), but hey it works!~</p>

</div>

<button id="sg-ui" type="button" class="foldout_button" onclick="
    this.classList.toggle('active');
    var content = this.nextElementSibling;
    if (content.style.display === 'block') {
      content.style.display = 'none';
      this.innerHTML = '<b>⯈ Using Shader Graphs for UI</b>';
    } else {
      content.style.display = 'block';
      this.innerHTML = '<b>⯆ Using Shader Graphs for UI</b>';

      if (history.pushState) {
        var newurl = window.location.protocol + '//' + window.location.host + window.location.pathname;
        newurl = newurl + '#sg-ui';
        window.history.pushState({path:newurl}, '', newurl);
      }

    }
"><b>⯈ Using Shader Graphs for UI</b></button>
<div class="foldout">
<p>As of 2023.2, Shader Graph has a &ldquo;Canvas&rdquo; material type to create shaders compatible with UI components. See <a href="https://portal.productboard.com/8ufdwj59ehtmsvxenjumxo82/c/50-ui-integration-with-shader-graph">Roadmap</a></p>
<p>For previous versions :</p>
<p>Shader Graph does not have proper support for UI, however it is possible to still use it with some workarounds &amp; drawbacks. This is written with URP in mind, but it may work the similar in other pipelines.</p>
<ul>
<li>Use the Unlit Graph, or Sprite Unlit Graph. UI should not use Lit or other graph types.</li>
<li>For Image component, use a Texture2D property with <code>_MainTex</code> name/reference to obtain the texture.</li>
<li>Avoid using <code>Screenspace-Overlay</code> mode on the Canvas</li>
<li>Graphs won&rsquo;t work with UI Masking (e.g. Scroll Rect/View component) and causes warnings about not having correct Stencil properties.</li>
</ul>
<p>More detailed info/setup below</p>
<h4 id="canvas">Canvas</h4>
<p>The Canvas can&rsquo;t use <code>Screenspace-Overlay</code> mode with Shader Graphs, as that renders all shader passes generated by the graph (such as Shadowcaster / DepthOnly / DepthNormals / etc). Unless you edit the generated code (explained more in the section below), we must instead use <code>Screenspace-Camera</code> mode (and set camera field). Worldspace UI also works.</p>
<div class="img-center">
<a href="sg-overlayui.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="750" height="249" alt="(Image)" src="sg-overlayui.png" />
</a>
<p class="img-text">UI Image rendering incorrectly on a <code>Screenspace-Overlay</code> Canvas. As you can see from the Frame Debugger, it&rsquo;s rendering 5 times with each pass (such as the selected DepthNormalsOnly pass)</p>
</div>
<div class="img-center">
<a href="sg-cameraui.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="750" height="249" alt="(Image)" src="sg-cameraui.png" />
</a>
<p class="img-text">UI Image rendering correctly on a <code>Screenspace-Camera</code> Canvas</p>
</div>
<p>If you don&rsquo;t want Post Processing to affect the UI, can create an <strong>Overlay Camera</strong> with the Culling Mask set to UI and Post Processing off :</p>
<div class="img-center">
<a href="sg-overlaycamera.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="443" height="257" alt="(Image)" src="sg-overlaycamera.png" />
</a>
<p class="img-text"></p>
</div>
<p>Then set the <code>Screenspace-Camera</code> <strong>Canvas</strong> to use that new camera and add it to the <strong>Stack</strong> on the <strong>Main Camera</strong>.</p>
<h4 id="masking">Masking</h4>
<p>Graphs will cause the UI to not work with masking, such as the Scroll Rect/View and Mask components. This requires Stencil operations, which shader graph does not support/expose.</p>
<p>The RenderObjects feature can override Stencil operations, however we cannot use it here for a few reasons :</p>
<ul>
<li>It seems the Layer that UI GameObjects are on is ignored, only the layer of the Canvas is important. So it doesn&rsquo;t actually filter correctly, without nesting a Canvas in the Scrollview Viewport.</li>
<li>Even if we do that, using a feature also moves rendering the object out of the regular Transparent queue. The mask already renders and is cleared before the feature executes.</li>
</ul>
<p>If you don&rsquo;t need masking, but want to surpress warnings like &ldquo;Material UI doesn&rsquo;t have _Stencil property&rdquo; you can create Float properties in the Blackboard with those names (<code>_Stencil, _StencilComp, _StencilOp, _StencilWriteMask, _StencilReadMask, _ColorMask</code>), however it is not possible to make them actually do anything from the graph.</p>
<p>If you require masking to work, you will need to <strong>copy the shader code generated by the graph</strong> and edit it. This would involve clicking the &ldquo;View Generated Shader&rdquo; button in the inspector when viewing the Shader Graph asset. Save the shader that appears in your assets, and use that on Materials instead of the graph.</p>
<div class="img-center">
<a href="sg-generate-code.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="443" height="162" alt="(Image)" src="sg-generate-code.png" />
</a>
<p class="img-text"></p>
</div>
<p>To actually support the masking, add the following Properties and edit the SubShader :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>Shader <span style="color:#e6db74">&#34;Shader Graphs/UITest&#34;</span> {
</span></span><span style="display:flex;"><span>    Properties {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// ... (properties generated by graph)
</span></span></span><span style="display:flex; background-color:#3c3d38"><span><span style="color:#75715e"></span>        _StencilComp (<span style="color:#e6db74">&#34;Stencil Comparison&#34;</span>, Float) <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>        _Stencil (<span style="color:#e6db74">&#34;Stencil ID&#34;</span>, Float) <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>        _StencilOp (<span style="color:#e6db74">&#34;Stencil Operation&#34;</span>, Float) <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>        _StencilWriteMask (<span style="color:#e6db74">&#34;Stencil Write Mask&#34;</span>, Float) <span style="color:#f92672">=</span> <span style="color:#ae81ff">255</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>        _StencilReadMask (<span style="color:#e6db74">&#34;Stencil Read Mask&#34;</span>, Float) <span style="color:#f92672">=</span> <span style="color:#ae81ff">255</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>        _ColorMask (<span style="color:#e6db74">&#34;Color Mask&#34;</span>, Float) <span style="color:#f92672">=</span> <span style="color:#ae81ff">15</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    SubShader {
</span></span><span style="display:flex; background-color:#3c3d38"><span>        Stencil {
</span></span><span style="display:flex; background-color:#3c3d38"><span>            Ref [_Stencil]
</span></span><span style="display:flex; background-color:#3c3d38"><span>            Comp [_StencilComp]
</span></span><span style="display:flex; background-color:#3c3d38"><span>            Pass [_StencilOp]
</span></span><span style="display:flex; background-color:#3c3d38"><span>            ReadMask [_StencilReadMask]
</span></span><span style="display:flex; background-color:#3c3d38"><span>            WriteMask [_StencilWriteMask]
</span></span><span style="display:flex; background-color:#3c3d38"><span>        }
</span></span><span style="display:flex; background-color:#3c3d38"><span>        ColorMask [_ColorMask]
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// ... rest of shader (Tags, Pass, etc)
</span></span></span></code></pre></div>
<p>Note the generated shader code may have <em>multiple SubShaders</em>, you would want to add this Stencil block (and ColorMask) to both.</p>
<p>With the material using this shader, the Image is now masked correctly :</p>
<div class="img-center">
<a href="sg-maskedui.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="425" height="174" alt="(Image)" src="sg-maskedui.png" />
</a>
<p class="img-text"></p>
</div>
<p>You could also delete all passes except the UniversalForward, and use <code>ZTest [unity_GUIZTestMode]</code> (replacing the ZTest line in the Pass) to support rendering into a ScreenSpace-Overlay UI. All these changes are based on the <a href="https://github.com/TwoTailsGames/Unity-Built-in-Shaders/blob/master/DefaultResourcesExtra/UI/UI-Default.shader">Built-in RP / UI-Default.shader</a>.</p>
<p>Note that the shader is now completely separate from the graph. If you want to make changes to the graph, you&rsquo;ll need to regenerate the code and make these changes again. Provided you don&rsquo;t need to make changes often, it isn&rsquo;t that bad.</p>

</div>

<button id="sg-terrain" type="button" class="foldout_button" onclick="
    this.classList.toggle('active');
    var content = this.nextElementSibling;
    if (content.style.display === 'block') {
      content.style.display = 'none';
      this.innerHTML = '<b>⯈ Using Shader Graphs for Terrain</b>';
    } else {
      content.style.display = 'block';
      this.innerHTML = '<b>⯆ Using Shader Graphs for Terrain</b>';

      if (history.pushState) {
        var newurl = window.location.protocol + '//' + window.location.host + window.location.pathname;
        newurl = newurl + '#sg-terrain';
        window.history.pushState({path:newurl}, '', newurl);
      }

    }
"><b>⯈ Using Shader Graphs for Terrain</b></button>
<div class="foldout">
<p>Shader Graph does not have proper support for Terrain, but it is still possible with some drawbacks. (Note this is for regular Draw mode, not Instanced Draw)</p>
<p>A Material can be assigned in the last tab on the Terrain component (cog symbol). When using a material with a graph shader, it will always display a warning that it &ldquo;might be unsuitable&rdquo;, but this can be ignored. It&rsquo;s not possible to remove this warning afaik (without generating shader code from the graph), as we can&rsquo;t add the TerrainCompatible tag from within the graph editor.</p>
<div class="img-center">
<a href="sg-terrain-1.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="341" height="300" alt="(Image)" src="sg-terrain-1.png" />
</a>
<p class="img-text"></p>
</div>
<p>If you want to support painting of Terrain Layers, it is only possible to support 4 layers from a graph. You just need to use specific names/references. At it&rsquo;s simplest, you&rsquo;d want :</p>
<ul>
<li><code>_Control</code> (Texture2D) : Terrain splatmap. By default is red everywhere, but as you paint other layers it swaps to green/blue/alpha. Each channel represents the layer painted.</li>
<li><code>_Splat0</code>, <code>_Splat1</code>, <code>_Splat2</code>, <code>_Splat3</code> (Texture2D) : Albedo/Diffuse textures for each layer. For 2021.2+ make sure &ldquo;Use Tiling And Offset&rdquo; is enabled on these texture properties! For versions older, create Vector4 <code>_ST</code> properties and use a subgraph as shown in <a href="https://twitter.com/Cyanilux/status/1259584907329908737">this tweet</a>.
<ul>
<li>With the URP/TerrainLit shader, the alpha channel of these textures is also used as a Smoothness source. It&rsquo;s up to you if you&rsquo;d include that in your calculations.</li>
</ul>
</li>
</ul>
<div class="img-center">
<a href="sg-terrain-2.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="750" height="415" alt="(Image)" src="sg-terrain-2.png" />
</a>
<p class="img-text">(Click image to view fullscreen)</p>
</div>
<p>Layers also provide additional data which the shader could support, such as :</p>
<ul>
<li><code>_Smoothness0</code>, <code>_Smoothness1</code>, <code>_Smoothness2</code>, <code>_Smoothness3</code> (Float) : Smoothness floats for each layer. Is typically multiplied with the alpha from the Albedo/Diffuse.</li>
<li><code>_Metallic0</code>, <code>_Metallic1</code>, <code>_Metallic2</code>, <code>_Metallic3</code> (Float) : Metallic floats for each layer</li>
<li><code>_Normal0</code>, <code>_Normal1</code>, <code>_Normal2</code>, <code>_Normal3</code> (Texture2D) : Normal/Bump textures for each layer</li>
<li><code>_Mask0</code>, <code>_Mask1</code>, <code>_Mask2</code>, <code>_Mask3</code> (Texture2D) : &ldquo;Mask&rdquo; textures for each layer
<ul>
<li>It&rsquo;s up to the shader how this is used, but with URP/TerrainLit :
<ul>
<li>R = Metallic</li>
<li>G = Occlusion</li>
<li>B = Height (for height-based blending)</li>
<li>A = Smoothness (overrides the albedo alpha &amp; <code>_SmoothnessN</code> values)</li>
</ul>
</li>
</ul>
</li>
<li>For a full list of properties, see <a href="https://github.com/Unity-Technologies/Graphics/blob/master/Packages/com.unity.render-pipelines.universal/Shaders/Terrain/TerrainLitInput.hlsl">TerrainLitInput.hlsl</a>. Also see <a href="https://github.com/Unity-Technologies/Graphics/blob/master/Packages/com.unity.render-pipelines.universal/Shaders/Terrain/TerrainLitPasses.hlsl">TerrainLitPasses.hlsl</a> to see how they are used.</li>
</ul>
<p>You&rsquo;d handle these using the same sort of setup and connect to the appropiate ports on the Master Stack (if using a Lit Graph this would involve Smoothness, Metallic, <strong>Normal Vector (Tangent)</strong> &amp; Ambient Occlusion).</p>
<p>If using Unlit Graph instead (with a Custom Lighting model, e.g. Toon Shaded), you&rsquo;d <b class="node">Transform</b> the calculated normal from Tangent to World space so it can be used in lighting calculations.</p>

</div>

<button id="sg-gpu-instancing" type="button" class="foldout_button" onclick="
    this.classList.toggle('active');
    var content = this.nextElementSibling;
    if (content.style.display === 'block') {
      content.style.display = 'none';
      this.innerHTML = '<b>⯈ Using GPU Instancing (DrawMeshInstanced) with Shader Graph</b>';
    } else {
      content.style.display = 'block';
      this.innerHTML = '<b>⯆ Using GPU Instancing (DrawMeshInstanced) with Shader Graph</b>';

      if (history.pushState) {
        var newurl = window.location.protocol + '//' + window.location.host + window.location.pathname;
        newurl = newurl + '#sg-gpu-instancing';
        window.history.pushState({path:newurl}, '', newurl);
      }

    }
"><b>⯈ Using GPU Instancing (DrawMeshInstanced) with Shader Graph</b></button>
<div class="foldout">
<p>GPU Instancing is typically not required when using MeshRenderer and SkinnedMeshRenderers in URP, as these already use the SRP Batcher to optimise setup between draw calls. When using the SRP Batcher you should avoid using Material Property Blocks though and stick to multiple Materials (or instaniate materials, e.g. using <code>renderer.material</code>)</p>
<p>But if you wish to render lots (<em>many thousands</em>) of the same mesh, you could consider using GPU Instancing via <code>Graphics.DrawMeshInstanced</code>, to remove some of the overhead of GameObjects. Or even better, <code>DrawMeshInstancedIndirect</code> (see answer below instead).</p>
<p>To support <code>DrawMeshInstanced</code>, Materials should already have a &ldquo;Enable GPU Instancing&rdquo; tickbox which can be ticked.</p>
<p>However using any properties in the Shader Graph Blackboard will still break instancing. Instead, I&rsquo;ve found that you can use a <b class="node">Custom Function</b> to define the instancing buffer &amp; properties. This is using macros similar to how you would set up instancing in a code-written shader.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">#ifndef CUSTOM_INSTANCING
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define CUSTOM_INSTANCING
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">// This allows multiple Custom Function nodes to use the same file
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// without trying to include the code multiple times (causing redefinition errors)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Instancing Buffer
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>UNITY_INSTANCING_BUFFER_START(Props)
</span></span><span style="display:flex;"><span>  UNITY_DEFINE_INSTANCED_PROP(float4, _Color)
</span></span><span style="display:flex;"><span>UNITY_INSTANCING_BUFFER_END(Props)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Custom Function &#34;GetInstancedColor&#34;, Outputs : Vector4
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">void</span> GetInstancedColor_float(out float4 Out){
</span></span><span style="display:flex;"><span>    Out <span style="color:#f92672">=</span> UNITY_ACCESS_INSTANCED_PROP(Props, _Color);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#endif</span></span></span></code></pre></td></tr></table>
</div>
</div>

</div>

<button id="sg-drawmeshinstancedindirect" type="button" class="foldout_button" onclick="
    this.classList.toggle('active');
    var content = this.nextElementSibling;
    if (content.style.display === 'block') {
      content.style.display = 'none';
      this.innerHTML = '<b>⯈ Using DrawMeshInstancedIndirect with Shader Graph</b>';
    } else {
      content.style.display = 'block';
      this.innerHTML = '<b>⯆ Using DrawMeshInstancedIndirect with Shader Graph</b>';

      if (history.pushState) {
        var newurl = window.location.protocol + '//' + window.location.host + window.location.pathname;
        newurl = newurl + '#sg-drawmeshinstancedindirect';
        window.history.pushState({path:newurl}, '', newurl);
      }

    }
"><b>⯈ Using DrawMeshInstancedIndirect with Shader Graph</b></button>
<div class="foldout">
<p>For supporting <code>DrawMeshInstancedIndirect</code>, (possibly also <code>DrawProcedural</code>), add a <strong>Boolean Keyword</strong> to the <strong>Blackboard</strong>, with reference set to <code>PROCEDURAL_INSTANCING_ON</code>. Should also be Global and using Multi-Compile.</p>
<div class="img-center">
<a href="sg-drawmeshinstancedindirect-1.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="493" height="189" alt="(Image)" src="sg-drawmeshinstancedindirect-1.png" />
</a>
<p class="img-text"></p>
</div>
<p>Use two <b class="node">Custom Function</b> nodes. Both with a Vector3 input named &ldquo;In&rdquo; and a Vector3 output named &ldquo;Out&rdquo;.</p>
<ul>
<li>The first uses <strong>File</strong> mode with the Function Name &ldquo;Instancing&rdquo;, to attach the include file (see Shader Graph gist below as an example).</li>
<li>The second must use <strong>String</strong> mode with the following :</li>
</ul>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>Out <span style="color:#f92672">=</span> In;
</span></span><span style="display:flex;"><span><span style="color:#75715e">#pragma instancing_options procedural:vertInstancingSetup</span></span></span></code></pre></td></tr></table>
</div>
</div>
<p>(<code>vertInstancingSetup</code> being a function in the include file)</p>
<p>Both functions here don&rsquo;t alter the input passed in, but it is required to be able to connect the node to the <strong>Master Stack</strong>. We should connect it somewhere in the Vertex stage - likely easiest using the <strong>Position</strong> port with the <b class="node">Position</b> node set to Object space (or swap this out for a displaced vertex position if you require that)</p>
<div class="img-center">
<a href="sg-drawmeshinstancedindirect-2.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="750" height="135" alt="(Image)" src="sg-drawmeshinstancedindirect-2.png" />
</a>
<p class="img-text"></p>
</div>
<p>See instanced grass example here :</p>
<ul>
<li>Twitter Thread : <a href="https://twitter.com/Cyanilux/status/1396848736022802435">https://twitter.com/Cyanilux/status/1396848736022802435</a></li>
<li>Shader Graph Include : <a href="https://gist.github.com/Cyanilux/4046e7bf3725b8f64761bf6cf54a16eb">https://gist.github.com/Cyanilux/4046e7bf3725b8f64761bf6cf54a16eb</a></li>
<li>C# Script : <a href="https://gist.github.com/Cyanilux/e7afdc5c65094bfd0827467f8e4c3c54">https://gist.github.com/Cyanilux/e7afdc5c65094bfd0827467f8e4c3c54</a></li>
</ul>

</div>

<button id="sg-scene-color" type="button" class="foldout_button" onclick="
    this.classList.toggle('active');
    var content = this.nextElementSibling;
    if (content.style.display === 'block') {
      content.style.display = 'none';
      this.innerHTML = '<b>⯈ Scene Color node info</b>';
    } else {
      content.style.display = 'block';
      this.innerHTML = '<b>⯆ Scene Color node info</b>';

      if (history.pushState) {
        var newurl = window.location.protocol + '//' + window.location.host + window.location.pathname;
        newurl = newurl + '#sg-scene-color';
        window.history.pushState({path:newurl}, '', newurl);
      }

    }
"><b>⯈ Scene Color node info</b></button>
<div class="foldout">
<p>The <b class="node">Scene Color</b> node samples a texture containing opaque geometry in the scene, allowing you to obtain the colour of opaque objects behind a transparent shader.</p>
<p>This is useful to produce distortion effects. The default UVs input is the <b class="node">Screen Position</b> node, so you can <b class="node">Add</b> or <b class="node">Subtract</b> to that to distort the view, for example with a noise texture. Can find examples in the following posts :</p>
<ul>
<li><a href="https://www.cyanilux.com/tutorials/water-shader-breakdown/">Water Shader Breakdown</a> (also attempts to remove distortion of objects infront of the water)</li>
<li><a href="https://www.cyanilux.com/tutorials/forcefield-shader-breakdown/">Forcefield Shader Breakdown</a></li>
<li><a href="https://www.cyanilux.com/tutorials/crystal-shader-breakdown/">Crystal Shader Breakdown</a></li>
<li><a href="https://www.cyanilux.com/tutorials/rain-effects-breakdown/#raindrop-complex">Rain Effects Breakdown : Raindrops on Surfaces (Complex)</a></li>
</ul>
<p>Note that the node will only function correctly when using a graph with <strong>Surface Mode : Transparent</strong> (or manually set RenderQueue to 2501+). See below for pipeline-specific differences.</p>
<p><strong>URP</strong> :</p>
<ul>
<li>Enable <strong>Opaque Texture</strong> option under the <strong>URP Asset</strong>. (May have multiple of those assets for each quality setting)</li>
<li>Also make sure dropdown on <strong>Camera</strong> isn&rsquo;t set to force the Opaque Texture off.</li>
</ul>
<p><strong>Built-in RP</strong> (Unity 2021.2+) :</p>
<ul>
<li>Add <a href="https://gist.github.com/Cyanilux/181893cd061e97eb12d5bfdec9fecaab">this SceneColorSetup script</a> to your <strong>Main Camera</strong> (and optionally other cameras that need the <code>_CameraOpaqueTexture</code>)</li>
</ul>
<p><strong>HDRP</strong> :</p>
<ul>
<li><b class="node">HD Scene Color</b> node may be more suitable for this pipeline. Provides exposure setting and different LOD levels.</li>
</ul>

</div>

<h3 id="sg-snippets">Shader Graph (Examples / Snippets)</h3>
<button id="sg-layering-textures" type="button" class="foldout_button" onclick="
    this.classList.toggle('active');
    var content = this.nextElementSibling;
    if (content.style.display === 'block') {
      content.style.display = 'none';
      this.innerHTML = '<b>⯈ Layering Textures\/Colors using Alpha\/Mask</b>';
    } else {
      content.style.display = 'block';
      this.innerHTML = '<b>⯆ Layering Textures\/Colors using Alpha\/Mask</b>';

      if (history.pushState) {
        var newurl = window.location.protocol + '//' + window.location.host + window.location.pathname;
        newurl = newurl + '#sg-layering-textures';
        window.history.pushState({path:newurl}, '', newurl);
      }

    }
"><b>⯈ Layering Textures/Colors using Alpha/Mask</b></button>
<div class="foldout">
<p>If you want to layer a texture containing an alpha channel onto another texture/colour, you can do so using a <b class="node">Lerp</b>, where the A output from the <b class="node">Sample Texture 2D</b> is connected to the T input. The A input would be the colour of the Base/Background while B input would be the colour of what you want to Layer on top.</p>
<div class="img-center">
<a href="sg-layer.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="750" height="353" alt="(Image)" src="sg-layer.png" />
</a>
<p class="img-text"></p>
</div>
<p>If you don&rsquo;t have a texture with an alpha channel, you could also use a procedural shape (or a channel from another texture) as the T input. This should be a float value, commonly referred to as a <em>mask</em>.</p>
<div class="img-center">
<a href="sg-layer2.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="750" height="276" alt="(Image)" src="sg-layer2.png" />
</a>
<p class="img-text"></p>
</div>
<p>In this case the noise texture is used to interpolate between two colours (blue, green). Then the result is masked using an <b class="node">Ellipse</b> to layer it on the background (same &ldquo;Base Color&rdquo; group as used in previous example)</p>

</div>

<button id="sg-sine-time" type="button" class="foldout_button" onclick="
    this.classList.toggle('active');
    var content = this.nextElementSibling;
    if (content.style.display === 'block') {
      content.style.display = 'none';
      this.innerHTML = '<b>⯈ Change frequency of Sine Time</b>';
    } else {
      content.style.display = 'block';
      this.innerHTML = '<b>⯆ Change frequency of Sine Time</b>';

      if (history.pushState) {
        var newurl = window.location.protocol + '//' + window.location.host + window.location.pathname;
        newurl = newurl + '#sg-sine-time';
        window.history.pushState({path:newurl}, '', newurl);
      }

    }
"><b>⯈ Change frequency of Sine Time</b></button>
<div class="foldout">
<p>It is not possible to change the frequency/wavelength or adjust the phase of the <strong>Sine Time</strong> output from the <b class="node">Time</b> node. You can only remap values, such as using a <b class="node">Multiply</b> to adjust the amplitude of the wave.</p>
<p>If you need to control the frequency, use the <strong>Time</strong> output instead, <b class="node">Multiply</b> by your frequency. To adjust phase use <b class="node">Add</b> or <b class="node">Subtract</b>. You would then put into a <b class="node">Sine</b> node. Can also <b class="node">Multiply</b> again after this to adjust amplitude, same as before.</p>
<div class="img-center">
<a href="sg-sine-time.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="750" height="151" alt="(Image)" src="sg-sine-time.png" />
</a>
<p class="img-text"></p>
</div>

</div>

<button id="sg-billboard" type="button" class="foldout_button" onclick="
    this.classList.toggle('active');
    var content = this.nextElementSibling;
    if (content.style.display === 'block') {
      content.style.display = 'none';
      this.innerHTML = '<b>⯈ Billboarding (rotating mesh to face camera)</b>';
    } else {
      content.style.display = 'block';
      this.innerHTML = '<b>⯆ Billboarding (rotating mesh to face camera)</b>';

      if (history.pushState) {
        var newurl = window.location.protocol + '//' + window.location.host + window.location.pathname;
        newurl = newurl + '#sg-billboard';
        window.history.pushState({path:newurl}, '', newurl);
      }

    }
"><b>⯈ Billboarding (rotating mesh to face camera)</b></button>
<div class="foldout">
<p>While it&rsquo;s possible to rotate meshes in C# to produce billboarding (e.g. with <code>transform.LookAt</code>), it&rsquo;s usually cheaper to handle effects like this in the shader - especially if many objects require billboarding.</p>
<p>Shader Graph makes it a little trickier to handle as it does space conversions behind the scenes. The <strong>Position</strong> port in the <strong>Master Stack</strong> is intended to be in <strong>Object</strong> space, rather than the clip space output a written vertex shader would usually have.</p>
<p>First up, we need a matrix to handle the effect. Can use one of the following.</p>
<ul>
<li><b class="node">Transformation Matrix</b> node set to &ldquo;Inverse View&rdquo;</li>
<li><b class="node">Custom Function</b> node with <strong>Matrix4</strong> output, <code>Out = unity_CameraToWorld;</code>. This acts the same as the InverseView matrix, but uses the camera even in shadowcasting passes - so shadows will look correct. Should also use set <strong>Cast Shadows</strong> to &ldquo;Two Sided&rdquo; option on the <strong>Mesh Renderer</strong>.</li>
</ul>
<p>If you don&rsquo;t want shadows (e.g. for billboard fire / light flares / etc), can use either of these, and turn off <strong>Cast Shadows</strong> in the <strong>Graph Settings</strong> (or via the Mesh Renderer)</p>
<p>To make billboard only rotate around the Y axis :</p>
<ul>
<li>Use one of the above (depending if shadows are required) into a <b class="node">Matrix Split</b> (Column mode), and put M0 and M2 into a <b class="node">Matrix Construction</b> node (Column mode). M1 should be set to (0, 1, 0, 0). M3 isn&rsquo;t too important but should set it to (0, 0, 0, 1).</li>
</ul>
<div class="img-center">
<a href="sg-billboard-matrix.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="750" height="285" alt="(Image)" src="sg-billboard-matrix.png" />
</a>
<p class="img-text"></p>
</div>
<p>One of the above matrices is then used in the following setup :</p>
<div class="img-center">
<a href="sg-billboard.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="750" height="180" alt="(Image)" src="sg-billboard.png" />
</a>
<p class="img-text"></p>
</div>

</div>

<button id="sg-planar-mapping" type="button" class="foldout_button" onclick="
    this.classList.toggle('active');
    var content = this.nextElementSibling;
    if (content.style.display === 'block') {
      content.style.display = 'none';
      this.innerHTML = '<b>⯈ Worldspace Planar Mapping</b>';
    } else {
      content.style.display = 'block';
      this.innerHTML = '<b>⯆ Worldspace Planar Mapping</b>';

      if (history.pushState) {
        var newurl = window.location.protocol + '//' + window.location.host + window.location.pathname;
        newurl = newurl + '#sg-planar-mapping';
        window.history.pushState({path:newurl}, '', newurl);
      }

    }
"><b>⯈ Worldspace Planar Mapping</b></button>
<div class="foldout">
<p>Textures are typically applied to the mesh using UV coordinates stored in the vertex data. But we can also use other coordinates.</p>
<p>In a technique usually referred to as &ldquo;Worldspace Planar Mapping&rdquo; (sometimes also called &ldquo;Worldspace Projected UV&rdquo;), we use the <b class="node">Position</b> node set to World space. This is a Vector3 output but nodes that take a UV port use a Vector2 though, so we first need to <b class="node">Swizzle</b> (or <b class="node">Split</b> and recombine into a <b class="node">Vector2</b> node), where we can also reorder the components. For example, we can use RB (aka XZ) axis.</p>
<ul>
<li>Note that in HDRP, you would use Absolute World space instead, as that pipeline uses <a href="https://docs.unity3d.com/Packages/com.unity.render-pipelines.high-definition@12.0/manual/Camera-Relative-Rendering.html">Camera Relative Rendering</a>. Using the regular World space would make the texture move with the Camera.</li>
</ul>
<div class="img-center">
<a href="sg-planar-mapping.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="421" height="249" alt="(Image)" src="sg-planar-mapping.png" />
</a>
<p class="img-text"></p>
</div>
<p>This can then be put into a <b class="node">Sample Texture 2D</b>, or any other nodes that have a UV port - such as procedural noise (<b class="node">Simple Noise</b> and <b class="node">Gradient Noise</b>).</p>
<p>Because we are in World space this acts like projecting the texture from above/below (as the G/Y axis is the one that we didn&rsquo;t use). The texture will be stretched for any faces that are vertical, but this method is useful for flat surfaces. The texture also does not move, rotate or scale with the object, and so seamlessly continues over neighbouring objects.</p>
<div class="img-center">
<a href="sg-planar-mapping-2.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="467" height="351" alt="(Image)" src="sg-planar-mapping-2.png" />
</a>
<p class="img-text"></p>
</div>
<p>We could also project from other axis by using the RG/XY or GB/YZ ports (and swizzle these further for 90 deg rotations).</p>
<p>Sampling from all three axis, then blending based on the <b class="node">Normal Vector</b> is known as <strong>Triplanar Mapping</strong>. There is a <b class="node">Triplanar</b> node which handles this for you - with only one texture input for all three axis though. For supporting different textures per axis, you&rsquo;d need to handle it yourself by recreating it in nodes or using a <b class="node">Custom Function</b>. I have a page on my <a href="https://cyangamedev.wordpress.com/2020/01/28/worldspace-uvs-triplanar-mapping/">old site</a> explaining this further.</p>

</div>

<button id="sg-custom-function-textures" type="button" class="foldout_button" onclick="
    this.classList.toggle('active');
    var content = this.nextElementSibling;
    if (content.style.display === 'block') {
      content.style.display = 'none';
      this.innerHTML = '<b>⯈ Sampling Textures in \u003cb class=\u0022node\u0022\u003eCustom Function\u003c\/b\u003e node</b>';
    } else {
      content.style.display = 'block';
      this.innerHTML = '<b>⯆ Sampling Textures in \u003cb class=\u0022node\u0022\u003eCustom Function\u003c\/b\u003e node</b>';

      if (history.pushState) {
        var newurl = window.location.protocol + '//' + window.location.host + window.location.pathname;
        newurl = newurl + '#sg-custom-function-textures';
        window.history.pushState({path:newurl}, '', newurl);
      }

    }
"><b>⯈ Sampling Textures in <b class="node">Custom Function</b> node</b></button>
<div class="foldout">
<p>Shader Graph already provides some texture sampling nodes (e.g. <b class="node">Sample Texture 2D</b>) for use in the graph. But it can be useful to sample inside a <b class="node">Custom Function</b>, e.g. inside a loop, or to access sampling macros that don&rsquo;t have built-in nodes.</p>
<h4 id="sg-custom-function-textures-macros">Macros</h4>
<p>In shader code online you might typically see <code>sampler2D</code> and <code>tex2D()</code> functions being used. This is the older DX9 syntax, but with Shader Graph we mostly use the newer DX11+ syntax which has <a href="https://docs.unity3d.com/Manual/SL-SamplerStates.html">separate objects for the texture and sampler</a>. This isn&rsquo;t supported in all platforms though (GLES2), so Unity provides a bunch of <strong>macros</strong> which can generate different code. These macros are defined in files found under <a href="https://github.com/Unity-Technologies/Graphics/tree/master/Packages/com.unity.render-pipelines.core/ShaderLibrary/API">render-pipelines.core/ShaderLibrary/API</a>.</p>
<p>Some important macros for sampling textures are listed below :</p>
<ul>
<li>
<p>Sample : Can be used in Fragment stage only</p>
<ul>
<li><code>SAMPLE_TEXTURE2D(textureName, samplerName, coord2)</code></li>
<li><code>SAMPLE_TEXTURECUBE(textureName, samplerName, coord3)</code></li>
<li><code>SAMPLE_TEXTURE3D(textureName, samplerName, coord3)</code></li>
<li><code>SAMPLE_TEXTURE2D_ARRAY(textureName, samplerName, coord2, index)</code></li>
<li><code>SAMPLE_TEXTURECUBE_ARRAY(textureName, samplerName, coord3, index)</code></li>
<li>These macros would end up using <a href="https://learn.microsoft.com/en-us/windows/win32/direct3dhlsl/dx-graphics-hlsl-to-sample">tex.Sample(&hellip;)</a> (on DX11+ type platforms)</li>
</ul>
</li>
<li>
<p>Sample Level (of Detail) : Provides lod input to specify the mip map level sampled. Can be used in both Vertex &amp; Fragment stages</p>
<ul>
<li><code>SAMPLE_TEXTURE2D_LOD(textureName, samplerName, coord2, lod)</code></li>
<li><code>SAMPLE_TEXTURECUBE_LOD(textureName, samplerName, coord3, lod)</code></li>
<li><code>SAMPLE_TEXTURE3D_LOD(textureName, samplerName, coord3, lod)</code></li>
<li><code>SAMPLE_TEXTURE2D_ARRAY_LOD(textureName, samplerName, coord2, index, lod)</code></li>
<li><code>SAMPLE_TEXTURECUBE_ARRAY_LOD(textureName, samplerName, coord3, index, lod)</code></li>
<li>These macros would end up using <a href="https://learn.microsoft.com/en-us/windows/win32/direct3dhlsl/dx-graphics-hlsl-to-samplelevel">tex.SampleLevel(&hellip;)</a> (on DX11+ type platforms)</li>
</ul>
</li>
<li>
<p>Sample Bias : Provides a bias to adjust the mip map level. Can be used in Fragment stage only.</p>
<ul>
<li><code>SAMPLE_TEXTURE2D_BIAS(textureName, samplerName, coord2, bias)</code></li>
<li><code>SAMPLE_TEXTURECUBE_BIAS(textureName, samplerName, coord3, bias)</code></li>
<li><code>SAMPLE_TEXTURE2D_ARRAY_BIAS(textureName, samplerName, coord2, index, bias)</code></li>
<li><code>SAMPLE_TEXTURECUBE_ARRAY_BIAS(textureName, samplerName, coord3, index, bias)</code></li>
<li>Doesn&rsquo;t seem to be BIAS macros for Texture3D. May be able to use <a href="https://learn.microsoft.com/en-us/windows/win32/direct3dhlsl/dx-graphics-hlsl-to-samplebias">tex.SampleBias(&hellip;)</a> function still (or <a href="https://learn.microsoft.com/en-us/windows/win32/direct3dhlsl/dx-graphics-hlsl-tex3dbias">tex3Dbias</a> for GLES2)</li>
</ul>
</li>
<li>
<p>Sample Gradient : Provides inputs for partial derivatives. Can be used in both Vertex &amp; Fragment stages. (Unless you use <code>ddx()</code>/<code>ddy()</code> functions to calculate those derivates as those are Fragment only). These are useful when the UV coords used for sampling aren&rsquo;t continous, see <a href="#sg-pixellated-seams">Pixellation along seams question above</a>.</p>
<ul>
<li><code>SAMPLE_TEXTURE2D_GRAD(textureName, samplerName, coord2, dpdx, dpdy)</code></li>
<li><code>SAMPLE_TEXTURE2D_ARRAY_GRAD(textureName, samplerName, coord2, index, dpdx, dpdy)</code></li>
<li>Doesn&rsquo;t seem there is GRAD macros for other texture types. May be able to use <a href="https://learn.microsoft.com/en-us/windows/win32/direct3dhlsl/dx-graphics-hlsl-to-samplegrad">tex.SampleGrad(&hellip;)</a> function still (or <a href="https://learn.microsoft.com/en-us/windows/win32/direct3dhlsl/dx-graphics-hlsl-texcubegrad">texCUBEgrad</a>/<a href="https://learn.microsoft.com/en-us/windows/win32/direct3dhlsl/dx-graphics-hlsl-tex3dgrad">tex3Dgrad</a> for GLES2)</li>
</ul>
</li>
</ul>
<h4 id="sg-custom-function-textures-types">Shader Graph Texture Types</h4>
<p>In Shader Graph v10.3+ (Unity 2020.2.3f1+), structs were added which wrap textures and their associated samplers together, allowing them to both be passed into a <b class="node">Custom Function</b> node in a single parameter. These types are defined in <a href="https://github.com/Unity-Technologies/Graphics/blob/master/Packages/com.unity.render-pipelines.core/ShaderLibrary/Texture.hlsl">render-pipelines.core/ShaderLibrary/Texture.hlsl</a></p>
<ul>
<li>UnityTexture2D (&ldquo;Texture 2D&rdquo; in SG dropdown)</li>
<li>UnityTexture2DArray (&ldquo;Texture 2D Array&rdquo; in SG dropdown)</li>
<li>UnityTexture3D (&ldquo;Texture 3D&rdquo; in SG dropdown)</li>
<li>UnityTextureCube (&ldquo;Cubemap&rdquo; in SG dropdown)</li>
<li>UnitySamplerState (&ldquo;Sampler State&rdquo; in SG dropdown)</li>
</ul>
<p>The sampler state associated with the texture can be accessed using <code>.samplerstate</code> on the UnityTextureX object. UnityTexture2D also has access to the Texel Size (via <code>.texelSize</code>).</p>
<h4 id="sg-custom-function-textures-example">Custom Function Example (v10.3+)</h4>
<p>If you aren&rsquo;t familiar with the <b class="node">Custom Function</b> node syntax see <a href="https://www.cyanilux.com/tutorials/intro-to-shader-graph/#custom-functions">Intro to Shader Graph - Custom Functions</a> and <a href="https://docs.unity3d.com/Packages/com.unity.shadergraph@13.1/manual/Custom-Function-Node.html">Custom Function docs page</a>.</p>
<p>Here is an example sampling a 3D Texture, using LOD version so it could be used in the vertex stage. This code would be put in a <code>.hlsl</code> file for use with <b class="node">Custom Function</b> <strong>File</strong> mode. It would also work with <strong>String</strong> mode but then you would only want the <strong>body</strong> of the function (inside <code>{}</code>) and you need to match the names for inputs/outputs.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">Example_float</span>(UnityTexture3D Tex, float3 UV, out float4 Out){
</span></span><span style="display:flex;"><span>    Out <span style="color:#f92672">=</span> SAMPLE_TEXTURE3D_LOD(Tex, Tex.samplerstate, UV, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>}</span></span></code></pre></td></tr></table>
</div>
</div>
<p>Inputs :</p>
<ul>
<li>&ldquo;Texture 3D&rdquo;, named &ldquo;Tex&rdquo;</li>
<li>&ldquo;Vector2&rdquo;, named &ldquo;UV&rdquo;</li>
</ul>
<p>Outputs :</p>
<ul>
<li>&ldquo;Vector4&rdquo;, named &ldquo;Out&rdquo;</li>
</ul>
<h4 id="sg-custom-function-textures-example-2">Custom Function Example (Pre-v10.3)</h4>
<p>Earlier versions don&rsquo;t have these <code>UnityTextureX/UnitySamplerState</code> types so instead need to use the HLSL texture objects, such as <code>Texture3D</code> and <code>SamplerState</code>. For example :</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">Example_float</span>(Texture3D Tex, SamplerState SS, float3 UV, out float4 Out){
</span></span><span style="display:flex;"><span>    Out <span style="color:#f92672">=</span> SAMPLE_TEXTURE3D_LOD(Tex, SS, UV, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>}</span></span></code></pre></td></tr></table>
</div>
</div>
<p>Inputs :</p>
<ul>
<li>&ldquo;Texture 3D&rdquo;, named &ldquo;Tex&rdquo;</li>
<li>&ldquo;SamplerState&rdquo;, named &ldquo;SS&rdquo;</li>
<li>&ldquo;Vector2&rdquo;, named &ldquo;UV&rdquo;</li>
</ul>
<p>Outputs :</p>
<ul>
<li>&ldquo;Vector4&rdquo;, named &ldquo;Out&rdquo;</li>
</ul>
<p>This could also be used in newer versions, by using the &ldquo;Bare Texture 3D&rdquo; and &ldquo;Bare Sampler State&rdquo; options on the input/output types. (Though this will likely error in GLES2 platforms, hence why the newer structs were introduced)</p>

</div>

<button id="sg-arrays" type="button" class="foldout_button" onclick="
    this.classList.toggle('active');
    var content = this.nextElementSibling;
    if (content.style.display === 'block') {
      content.style.display = 'none';
      this.innerHTML = '<b>⯈ Using Float\/Vector Arrays in Shader Graph</b>';
    } else {
      content.style.display = 'block';
      this.innerHTML = '<b>⯆ Using Float\/Vector Arrays in Shader Graph</b>';

      if (history.pushState) {
        var newurl = window.location.protocol + '//' + window.location.host + window.location.pathname;
        newurl = newurl + '#sg-arrays';
        window.history.pushState({path:newurl}, '', newurl);
      }

    }
"><b>⯈ Using Float/Vector Arrays in Shader Graph</b></button>
<div class="foldout">
<p>Unity supports fixed-size Float and Vector(4) arrays in shaders. We can define them in Shader Graph by using a <b class="node">Custom Function</b> node. In this case, we <em>must</em> use the File mode as the array has to be defined outside the function scope - and this is not possible using String mode.</p>
<p>Here is some example code, defining an array named <code>_ExampleArray</code>, containing 10 floats. Note that the <code>[10]</code> is put after the name, not after <code>float</code>. We can then index the array inside the function, in this case using a loop to add the contents together.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">float</span> _ExampleArray[<span style="color:#ae81ff">10</span>];
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">ExampleFunction_float</span>(out <span style="color:#66d9ef">float</span> Sum){
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;i<span style="color:#f92672">&lt;</span><span style="color:#ae81ff">10</span>;i<span style="color:#f92672">++</span>){
</span></span><span style="display:flex;"><span>      Sum <span style="color:#f92672">+=</span> _ExampleArray[i];
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></td></tr></table>
</div>
</div>
<p>The array would then be set from a C# script, using :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span>Shader.SetGlobalFloatArray(<span style="color:#e6db74">&#34;_ExampleArray&#34;</span>, floatArray);</span></span></code></pre></div>
<p>For a Vector4 array, you would use <code>float4</code> instead of <code>float</code>, and :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span>Shader.SetGlobalVectorArray(<span style="color:#e6db74">&#34;_ExampleArray&#34;</span>, vectorArray);</span></span></code></pre></div>
<p>When using these C# functions, make sure that <code>floatArray</code> (or <code>vectorArray</code>) has the same length that is specified in the shader! Can pad with zeros if required.</p>
<p>I also have a <a href="https://www.cyanilux.com/tutorials/forcefield-shader-breakdown/">forcefield shader breakdown</a> which uses an array, if you want a real example.</p>

</div>

<button id="sg-lod-crossfade" type="button" class="foldout_button" onclick="
    this.classList.toggle('active');
    var content = this.nextElementSibling;
    if (content.style.display === 'block') {
      content.style.display = 'none';
      this.innerHTML = '<b>⯈ LOD Crossfade using dithering</b>';
    } else {
      content.style.display = 'block';
      this.innerHTML = '<b>⯆ LOD Crossfade using dithering</b>';

      if (history.pushState) {
        var newurl = window.location.protocol + '//' + window.location.host + window.location.pathname;
        newurl = newurl + '#sg-lod-crossfade';
        window.history.pushState({path:newurl}, '', newurl);
      }

    }
"><b>⯈ LOD Crossfade using dithering</b></button>
<div class="foldout">
<p>The following graph can be used to support <strong>Fade Mode</strong> : &ldquo;Cross Fade&rdquo; on the <strong>LOD Group</strong> component.</p>
<p>This requires using a built-in variable, <code>unity_LODFade</code>. Shader Graph doesn&rsquo;t provide access to it but we can use a <b class="node">Custom Function</b> node (<strong>String</strong> mode). Add a single <strong>Float</strong> output named &ldquo;Out&rdquo; and set <strong>Body</strong> to <code>Out = unity_LODFade.x;</code>. The function&rsquo;s name isn&rsquo;t that important but needs to be set to something.</p>
<p>For use with the <b class="node">Dither</b> node, we first need to <b class="node">Absolute</b> to bring any negative values into the positive range. However to make sure it fades in the correct direction, we also need to take the <b class="node">Sign</b> of <code>unity_LODFade.x</code>, and <b class="node">Multiply</b> by the dither result.</p>
<div class="img-center">
<a href="sg-lodfade.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="750" height="157" alt="(Image)" src="sg-lodfade.png" />
</a>
<p class="img-text"></p>
</div>
<p>As shown, can then optionally use a <strong>Boolean Keyword</strong> (set this up in the <strong>Blackboard</strong> window. While highlighted change it&rsquo;s settings under the <strong>Node Settings</strong> tab of <strong>Graph Inspector</strong> window).</p>
<ul>
<li><strong>Name</strong> : Is Fading</li>
<li><strong>Reference</strong> : <code>LOD_FADE_CROSSFADE</code></li>
<li><strong>Definition</strong> : Multi-Compile</li>
<li><strong>Scope</strong> : Global</li>
<li><strong>Exposed</strong> : No / Unticked</li>
</ul>
<p>Drag the keyword into the graph, then put the result of our <b class="node">Multiply</b> into the <strong>On</strong> port, and set the <strong>Off</strong> port to <strong>1</strong>.</p>
<p>Using this keyword may be optional, but it means we can avoid having to do the dither calculations when not in the crossfading range. However this would affect batching, so you may want to try it with and without and profile both.</p>
<p>The above graph results in this when moving the camera :</p>
<div class="img-center">
<a href="lod-crossfade.gif" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="367" height="298" alt="(Image)" src="lod-crossfade.gif" />
</a>
<p class="img-text"></p>
</div>
<p>With LOD Group setup looking something like this :</p>
<div class="img-center">
<a href="lod-group.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="473" height="400" alt="(Image)" src="lod-group.png" />
</a>
<p class="img-text">(Usually would have less tris in your higher/further away LODs, but the meshes here is just for example)</p>
</div>
<p>For fading based on time, enable <strong>Animate Cross-fading</strong>. Can control the duration (globally) by setting <code>LODGroup.crossFadeAnimationDuration</code> from a C# script.</p>
<p>For fading based on distance, disable <strong>Animate Cross-fading</strong> and edit the &ldquo;Fade Transition Width&rdquo; values.</p>
<p>See <a href="https://docs.unity3d.com/Manual/class-LODGroup.html">Unity Docs : LOD Group</a> for more info.</p>

</div>

<button id="sg-stabilised-screenpos" type="button" class="foldout_button" onclick="
    this.classList.toggle('active');
    var content = this.nextElementSibling;
    if (content.style.display === 'block') {
      content.style.display = 'none';
      this.innerHTML = '<b>⯈ Per-Object Stabilised Screen Position</b>';
    } else {
      content.style.display = 'block';
      this.innerHTML = '<b>⯆ Per-Object Stabilised Screen Position</b>';

      if (history.pushState) {
        var newurl = window.location.protocol + '//' + window.location.host + window.location.pathname;
        newurl = newurl + '#sg-stabilised-screenpos';
        window.history.pushState({path:newurl}, '', newurl);
      }

    }
"><b>⯈ Per-Object Stabilised Screen Position</b></button>
<div class="foldout">
<p>For some effects it can be useful to project a texture/noise/etc from screen space (using the <b class="node">Screen Position</b> node into UV ports). When the object or camera moves the texture stays in place relative to the screen, so changes on the model. That isn&rsquo;t always the desired effect - it could be useful if the texture stayed relative to the object itself.</p>
<p>One easy way to achieve something like this is to use View Space instead, and offset it by the object&rsquo;s origin in the same space. I do this in my <a href="https://www.cyanilux.com/tutorials/dissolve-shader-breakdown/#view-position-uvs">Dissolve Shader Breakdown</a> :</p>
<div class="img-center">
<a href="https://www.cyanilux.com/tutorials/dissolve-shader-breakdown/Graph5.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy"   alt="(Image)" src="https://www.cyanilux.com/tutorials/dissolve-shader-breakdown/Graph5.png" />
</a>
<p class="img-text"></p>
</div>
<p>This can create some warping when objects are close to the sides of the camera view, but still tends to work pretty well.</p>
<p>The same thing can be done in screen space (which doesn&rsquo;t have this warping issue), but the graph is more complicated. It also includes optional groups to deal with screen aspect ratio (so texture/noise isn&rsquo;t stretched) and make UVs scale down when viewing at a distance :</p>
<div class="img-center">
<a href="sg-object-screenspace-uv.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="750" height="158" alt="(Image)" src="sg-object-screenspace-uv.png" />
</a>
<p class="img-text">(Click image to view fullscreen)</p>
</div>
<p>In newer versions of Shader Graph (v14 / Unity 2022.2+) the <b class="node">Transform</b> node now has a <strong>Screen</strong> option, therefore we can simplify the &ldquo;Stabilised Screen Position&rdquo; group in the above graph :</p>
<div class="img-center">
<a href="sg-object-screenspace-uv-2.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="682" height="484" alt="(Image)" src="sg-object-screenspace-uv-2.png" />
</a>
<p class="img-text"></p>
</div>

</div>

<button id="sg-flowmap" type="button" class="foldout_button" onclick="
    this.classList.toggle('active');
    var content = this.nextElementSibling;
    if (content.style.display === 'block') {
      content.style.display = 'none';
      this.innerHTML = '<b>⯈ Distorting Textures in Multiple Directions \/ Flowmaps</b>';
    } else {
      content.style.display = 'block';
      this.innerHTML = '<b>⯆ Distorting Textures in Multiple Directions \/ Flowmaps</b>';

      if (history.pushState) {
        var newurl = window.location.protocol + '//' + window.location.host + window.location.pathname;
        newurl = newurl + '#sg-flowmap';
        window.history.pushState({path:newurl}, '', newurl);
      }

    }
"><b>⯈ Distorting Textures in Multiple Directions / Flowmaps</b></button>
<div class="foldout">
<p>There may be cases where you want to displace/distort a texture in multiple directions. But just using <code>Direction * Time</code> to offset the UV coordinates will mean the difference in values grows larger between where the directions change - tilling and stretching the texture more and more in that gap.</p>
<p>There may be multiple methods to solve this - sampling a texture multiple times with displacements in each cardinal direction and blending between them comes to mind, but that isn&rsquo;t ideal. The below technique provides a better solution that only uses 2 samples so should also be fairly performant.</p>
<p>The idea is to have the time repeat, by using the <b class="node">Fraction</b> node to only take the decimal part of the value. The displacement will jump back to 0 when time reaches 1, but to avoid seeing this <em>we fade the texture out</em> while fading another version in that uses a different <em>phase</em> (time offset by 0.5).</p>
<p>The fading is controlled by two &ldquo;triangle waves&rdquo; using the same repeating time values.</p>
<ul>
<li>(Shader Graph technically has a <b class="node">Triangle Wave</b> node built in for calculating that, but it returns a <strong>-1 to 1</strong> range while we need <strong>0 to 1</strong>. Could use a <b class="node">Remap</b> or <b class="node">Inverse Lerp</b> but I&rsquo;ve instead calculated the wave myself below, with <b class="node">Multiply</b> by <strong>2</strong>, <b class="node">One Minus</b>, <b class="node">Absolute</b>, <b class="node">One Minus</b>)</li>
</ul>
<p>Here&rsquo;s an example graph showing the implementation :</p>
<div class="img-center">
<a href="sg-flowmap.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="750" height="357" alt="(Image)" src="sg-flowmap.png" />
</a>
<p class="img-text">(Click image to view fullscreen)</p>
</div>
<p>The section highlighted in orange is the same for both the top and bottom (but with A input swapped for B) so putting this into a SubGraph may help keep the graph more organised.</p>
<p>In the top left, two options are shown for obtaining the displacement directions. Can either use a &ldquo;Flowmap&rdquo; - essentially the same as a Normal Map but typically only with RG channels. Should likely still be imported and treated the same as a Normal Map, or at least disable sRGB so colour space differences don&rsquo;t mess with values. Will also need to remap from the 0 to 1 range of the texture to the <strong>-1 to 1</strong> range of direction vectors. I&rsquo;ve used the &ldquo;Normal&rdquo; mode on the <b class="node">Sample Texture 2D</b> to handle this for me.</p>
<p>The other option is storing directions in the mesh data, such as <b class="node">Vertex Color</b>. You may also want a <b class="node">Normalize</b> node after the remapping here. You can then paint the mesh in modelling software like Blender, or in Unity using <strong>Polybrush</strong> (found in Package Manager), or find a way to set the directions from C#.</p>
<p>In both cases, any values will work but (0.5, 0.5) would be no displacement. (0, 0.5) would be towards the left, (1, 0.5) for right, (0.5, 0) for down, (0.5, 1) for up, etc.</p>
<p>For more details, <a href="https://catlikecoding.com/unity/tutorials/flow/texture-distortion/">this &ldquo;Texture Distortion&rdquo; CatlikeCoding tutorial</a> should help explain the technique.</p>

</div>

<h3 id="shaders">Shaders</h3>
<button id="multi-pass" type="button" class="foldout_button" onclick="
    this.classList.toggle('active');
    var content = this.nextElementSibling;
    if (content.style.display === 'block') {
      content.style.display = 'none';
      this.innerHTML = '<b>⯈ Multi-pass shaders</b>';
    } else {
      content.style.display = 'block';
      this.innerHTML = '<b>⯆ Multi-pass shaders</b>';

      if (history.pushState) {
        var newurl = window.location.protocol + '//' + window.location.host + window.location.pathname;
        newurl = newurl + '#multi-pass';
        window.history.pushState({path:newurl}, '', newurl);
      }

    }
"><b>⯈ Multi-pass shaders</b></button>
<div class="foldout">
<p>Shader code can contain multiple passes that define LightMode tags. See <a href="https://docs.unity3d.com/Manual/SL-PassTags.html#lightmode-tag">here for related docs page</a> which also links to lists of LightMode values used by Built-in &amp; URP.</p>
<p>In the <strong>Built-in Render Pipeline</strong>, you can also have multiple passes <strong>without a LightMode tag</strong> (or <code>&quot;LightMode&quot;=&quot;Always&quot;</code>) which are rendered without lighting/shadows. Unity will render each one as a separate draw call, though the exact render order also depends on the queue :</p>
<ul>
<li>In the <strong>Opaque</strong> queue (Geometry + AlphaTest), all objects render at once using the passes sequentially.
<ul>
<li>i.e. All objects render Pass 1, then all objects Pass 2, etc.</li>
<li>This works with Static Batching (separate batch per pass that is) - though appears to break Dynamic Batching.</li>
</ul>
</li>
<li>In the <strong>Transparent</strong> queue, each object renders separately (furthest from camera first) going through the passes sequentially.
<ul>
<li>i.e. First object renders Pass 1, Pass 2, etc. Second object renders Pass 1, Pass 2, etc.</li>
<li>This is likely to avoid blending issues, but also means draw calls will not batch.</li>
</ul>
</li>
</ul>
<p>In the <strong>Universal Render Pipeline</strong>, it is <em>possible</em> to have one Pass with <code>&quot;LightMode&quot;=&quot;UniversalForward&quot;</code>, as well as one pass without (or <code>&quot;LightMode&quot;=&quot;SRPDefaultUnlit&quot;</code>) and both will render&hellip; However this breaks SRP Batcher compatibility for objects using the shader, so is not recommended if the shader will be applied to many objects.</p>
<p>Better options for URP are :</p>
<ul>
<li>Use a <strong>custom LightMode</strong> tag, and tell it to render via a <strong>Custom Renderer Feature</strong> or <strong>RenderObjects</strong> feature (put same custom tag value under Shader Tags list)</li>
<li>Or <strong>split passes into two separate shaders &amp; materials</strong>, then either :
<ul>
<li>Use a <strong>RenderObjects</strong> feature to re-render objects with an <strong>Override Material</strong>, filtered to a particular Layer. This works well when dealing with <em>many objects</em>. (If for some reason you can&rsquo;t use Layers for filtering, there is also a &ldquo;Rendering Layer Mask&rdquo; on Renderer component, but would need to write a custom feature to filter using that, as RenderObjects doesn&rsquo;t include an option for it)</li>
<li>Apply <strong>more Materials</strong> to the MeshRenderer. If you go over the submesh count, it&rsquo;ll render each submesh again. (While this works, I have seen some Unity devs mentioning to not rely on this behaviour. It&rsquo;s possible this isn&rsquo;t really intentional so could change in the future)</li>
<li><strong>Duplicate the object</strong> with the Renderer and change it&rsquo;s Material(s). Parent under the original object to keep them in sync.</li>
</ul>
</li>
</ul>
<p>Note that in 2022.2+ we also have a <strong>Override Shader</strong> option on the RenderObjects feature (and in <code>DrawingSettings</code> used with <code>ScriptableRenderContext.DrawRenderers</code> in a custom feature). This will keep using the <em>same property values from the original shader</em>, closer matching <a href="https://docs.unity3d.com/Manual/SL-ShaderReplacement.html">Replacement Shaders</a> from BiRP. However, I believe objects rendered with overriden shaders currently do not SRP Batch, so if there is many objects involved it could be expensive. Should try to only use this where required.</p>

</div>

<button id="shaderlab-operation-properties" type="button" class="foldout_button" onclick="
    this.classList.toggle('active');
    var content = this.nextElementSibling;
    if (content.style.display === 'block') {
      content.style.display = 'none';
      this.innerHTML = '<b>⯈ Using properties with ShaderLab operations (ZWrite \/ ZTest \/ Cull \/ ColorMask \/ Blend \/ Stencil)</b>';
    } else {
      content.style.display = 'block';
      this.innerHTML = '<b>⯆ Using properties with ShaderLab operations (ZWrite \/ ZTest \/ Cull \/ ColorMask \/ Blend \/ Stencil)</b>';

      if (history.pushState) {
        var newurl = window.location.protocol + '//' + window.location.host + window.location.pathname;
        newurl = newurl + '#shaderlab-operation-properties';
        window.history.pushState({path:newurl}, '', newurl);
      }

    }
"><b>⯈ Using properties with ShaderLab operations (ZWrite / ZTest / Cull / ColorMask / Blend / Stencil)</b></button>
<div class="foldout">
<p>Rather than hardcoding ShaderLab operations, it is possible to specify a <strong>Property</strong> so they can be changed on the material or at runtime (e.g. through <code>material.SetFloat</code>)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">// (in Properties)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>[Enum(Off, <span style="color:#ae81ff">0</span>, On, <span style="color:#ae81ff">1</span>)] _ZWrite(<span style="color:#e6db74">&#34;Z Write&#34;</span>, Float) <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>[Enum(UnityEngine.Rendering.CompareFunction)] _ZTest(<span style="color:#e6db74">&#34;ZTest&#34;</span>, Float) <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span> <span style="color:#75715e">// &#34;LessEqual&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>[Enum(UnityEngine.Rendering.CullMode)] _Cull (<span style="color:#e6db74">&#34;Cull&#34;</span>, Float) <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#75715e">// &#34;Back&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>[Enum(UnityEngine.Rendering.ColorWriteMask)] _ColorMask (<span style="color:#e6db74">&#34;ColorMask&#34;</span>, Float) <span style="color:#f92672">=</span> <span style="color:#ae81ff">15</span> <span style="color:#75715e">// &#34;RGBA&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>[Enum(UnityEngine.Rendering.BlendMode)] _BlendSrc (<span style="color:#e6db74">&#34;Blend Src Factor&#34;</span>, Float) <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#75715e">// &#34;One&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>[Enum(UnityEngine.Rendering.BlendMode)] _BlendDst (<span style="color:#e6db74">&#34;Blend Dst Factor&#34;</span>, Float) <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> <span style="color:#75715e">// &#34;Zero&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>[Enum(UnityEngine.Rendering.BlendMode)] _BlendSrcA (<span style="color:#e6db74">&#34;Blend Src Factor (Alpha)&#34;</span>, Float) <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#75715e">// &#34;One&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>[Enum(UnityEngine.Rendering.BlendMode)] _BlendDstA (<span style="color:#e6db74">&#34;Blend Dst Factor (Alpha)&#34;</span>, Float) <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> <span style="color:#75715e">// &#34;Zero&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>[Enum(UnityEngine.Rendering.BlendOp)] _BlendOp (<span style="color:#e6db74">&#34;Blend Op&#34;</span>, Float) <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> <span style="color:#75715e">// &#34;Add&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>[Enum(UnityEngine.Rendering.CompareFunction)] _StencilComp (<span style="color:#e6db74">&#34;Stencil Comparison&#34;</span>, Float) <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> <span style="color:#75715e">// &#34;Disabled&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>[IntRange] _Stencil (<span style="color:#e6db74">&#34;Stencil ID&#34;</span>, Range (<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">255</span>)) <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>[Enum(UnityEngine.Rendering.StencilOp)] _StencilOp (<span style="color:#e6db74">&#34;Stencil Op (Pass)&#34;</span>, Float) <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#75715e">// &#34;Replace&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>[Enum(UnityEngine.Rendering.StencilOp)] _StencilOpFail (<span style="color:#e6db74">&#34;Stencil Op (Fail)&#34;</span>, Float) <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> <span style="color:#75715e">// &#34;Keep&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>[Enum(UnityEngine.Rendering.StencilOp)] _StencilOpZFail (<span style="color:#e6db74">&#34;Stencil Op (ZFail)&#34;</span>, Float) <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> <span style="color:#75715e">// &#34;Keep&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>_StencilWriteMask (<span style="color:#e6db74">&#34;Stencil Write Mask&#34;</span>, Float) <span style="color:#f92672">=</span> <span style="color:#ae81ff">255</span>
</span></span><span style="display:flex;"><span>_StencilReadMask (<span style="color:#e6db74">&#34;Stencil Read Mask&#34;</span>, Float) <span style="color:#f92672">=</span> <span style="color:#ae81ff">255</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// (in SubShader/Pass)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>ZWrite [_ZWrite]
</span></span><span style="display:flex;"><span>ZTest [_ZTest]
</span></span><span style="display:flex;"><span>Cull [_Cull]
</span></span><span style="display:flex;"><span>ColorMask [_ColorMask]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//Blend [_BlendSrc] [_BlendDst] // Uses Blend mode for both RGB and Alpha channels
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>Blend [_BlendSrc] [_BlendDst], [_BlendSrcA] [_BlendDstA] <span style="color:#75715e">// Use different Blend mode for Alpha
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>BlendOp [_BlendOp]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Stencil {
</span></span><span style="display:flex;"><span>    Ref [_Stencil]
</span></span><span style="display:flex;"><span>    Comp [_StencilComp]
</span></span><span style="display:flex;"><span>    Pass [_StencilOp]
</span></span><span style="display:flex;"><span>    Fail [_StencilOpFail]
</span></span><span style="display:flex;"><span>    ZFail [_StencilOpZFail]
</span></span><span style="display:flex;"><span>    ReadMask [_StencilReadMask]
</span></span><span style="display:flex;"><span>    WriteMask [_StencilWriteMask]
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>

</div>

<button id="tangent-space" type="button" class="foldout_button" onclick="
    this.classList.toggle('active');
    var content = this.nextElementSibling;
    if (content.style.display === 'block') {
      content.style.display = 'none';
      this.innerHTML = '<b>⯈ What is Tangent Space?</b>';
    } else {
      content.style.display = 'block';
      this.innerHTML = '<b>⯆ What is Tangent Space?</b>';

      if (history.pushState) {
        var newurl = window.location.protocol + '//' + window.location.host + window.location.pathname;
        newurl = newurl + '#tangent-space';
        window.history.pushState({path:newurl}, '', newurl);
      }

    }
"><b>⯈ What is Tangent Space?</b></button>
<div class="foldout">
<p>Tangent space uses vectors from the mesh data to stay relative to the surface of the mesh. It can be difficult to visualise for an entire model as unlike other spaces, it can be different per-pixel.</p>
<div class="img-center">
<a href="tangent-space.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="285" height="279" alt="(Image)" src="tangent-space.png" />
</a>
<p class="img-text">A way to visualise the tangent space for a given point (centered at the gizmo)</p>
</div>
<p>The <strong>Normal</strong> vector you should be familiar with, points out from each vertex - It&rsquo;s the Z axis of tangent space (shown in blue, since XYZ=RGB). The X and Y axis use the <strong>Tangent</strong> vector and a <strong>Bitangent</strong> vector (also called <strong>Binormal</strong>) - which is typically calculated using a Cross Product with the other two vectors.</p>
<p>These tangent and bitangent vectors are also aligned to the direction of the UV coordinates stored in the mesh. (The tangent follows the X axis of the UV coordinates, and the bitangent follows the Y axis)</p>
<p>The space is needed so tangent space normal maps (that use UV coordinates for sampling) can be converted back to world space to produce correct lighting/shading. The tangent space View Direction is also used to produce Parallax effects.</p>
<p>Of note, if you are using techniques like <strong>Triplanar Mapping</strong>, then the &ldquo;Tangent space&rdquo; you&rsquo;d need would be different than the Tangent space calculated from mesh data. <a href="https://bgolus.medium.com/normal-mapping-for-a-triplanar-shader-10bf39dca05a">This article by Ben Golus</a> explains this in detail. In Shader Graph, the <b class="node">Triplanar</b> node already takes this into account when using it&rsquo;s Normal mode (I believe using the &ldquo;Whiteout Blend&rdquo; example)</p>

</div>

<button id="particle-color" type="button" class="foldout_button" onclick="
    this.classList.toggle('active');
    var content = this.nextElementSibling;
    if (content.style.display === 'block') {
      content.style.display = 'none';
      this.innerHTML = '<b>⯈ How do I get color of Particle System, Trail Renderer \u0026amp; Sprite Renderer</b>';
    } else {
      content.style.display = 'block';
      this.innerHTML = '<b>⯆ How do I get color of Particle System, Trail Renderer \u0026amp; Sprite Renderer</b>';

      if (history.pushState) {
        var newurl = window.location.protocol + '//' + window.location.host + window.location.pathname;
        newurl = newurl + '#particle-color';
        window.history.pushState({path:newurl}, '', newurl);
      }

    }
"><b>⯈ How do I get color of Particle System, Trail Renderer &amp; Sprite Renderer</b></button>
<div class="foldout">
<p>Colors here are passed into vertex colors - data stored in each vertex of the mesh. To obtain this :</p>
<ul>
<li>In HLSL, use the <code>: COLOR</code> semantic in the vertex input struct.</li>
<li>In Shader Graph, use the <b class="node">Vertex Color</b> node.</li>
</ul>
<p>Also note that Sprite Graphs will already automatically tint the output using this. There <a href="https://github.com/Unity-Technologies/Graphics/commit/3ca7a6bdefed68a482a2429f75b508f309b8c1a6">will be an option to disable this</a>. Might be in 2023.3 (currently a pre-release as of writing), but otherwise will have to wait for later versions.</p>
<p>For Sprite Renderer, might vary slightly. If instanced, in Built-in RP sprites use a <code>_RendererColor</code> property in the instancing buffer. In newer versions of URP (2023.1+) that has been replaced with <code>unity_SpriteColor</code>, may need to try a Custom Function to access/output that.</p>

</div>

<button id="sprite-local-uv" type="button" class="foldout_button" onclick="
    this.classList.toggle('active');
    var content = this.nextElementSibling;
    if (content.style.display === 'block') {
      content.style.display = 'none';
      this.innerHTML = '<b>⯈ How to obtain Local Sprite UVs (0-1 across each sprite) for sprite sheets \/ sprite atlas</b>';
    } else {
      content.style.display = 'block';
      this.innerHTML = '<b>⯆ How to obtain Local Sprite UVs (0-1 across each sprite) for sprite sheets \/ sprite atlas</b>';

      if (history.pushState) {
        var newurl = window.location.protocol + '//' + window.location.host + window.location.pathname;
        newurl = newurl + '#sprite-local-uv';
        window.history.pushState({path:newurl}, '', newurl);
      }

    }
"><b>⯈ How to obtain Local Sprite UVs (0-1 across each sprite) for sprite sheets / sprite atlas</b></button>
<div class="foldout">
See <a href="https://www.cyanilux.com/tutorials/sprite-local-uv/">Local UVs for Sprites in Sprite Sheet/Atlas</a> post.
</div>

<button id="mesh-origin" type="button" class="foldout_button" onclick="
    this.classList.toggle('active');
    var content = this.nextElementSibling;
    if (content.style.display === 'block') {
      content.style.display = 'none';
      this.innerHTML = '<b>⯈ How do you get the origin of a Mesh in the shader?</b>';
    } else {
      content.style.display = 'block';
      this.innerHTML = '<b>⯆ How do you get the origin of a Mesh in the shader?</b>';

      if (history.pushState) {
        var newurl = window.location.protocol + '//' + window.location.host + window.location.pathname;
        newurl = newurl + '#mesh-origin';
        window.history.pushState({path:newurl}, '', newurl);
      }

    }
"><b>⯈ How do you get the origin of a Mesh in the shader?</b></button>
<div class="foldout">
<p>The origin of a mesh is (0,0,0) in object space. To calculate this in world space we could use a matrix multiplciation, like <code>float3 originWS = mul(UNITY_MATRIX_M, float4(0,0,0,1)).xyz</code>, however a cheaper method is to extract the translation data from the matrix :</p>
<ul>
<li><code>UNITY_MATRIX_M._m03_m13_m23</code></li>
<li>(or <code>unity_ObjectToWorld._m03_m13_m23</code>)</li>
</ul>
<p>This is equivalent to the <strong>Position</strong> output of the <b class="node">Object</b> node in Shader Graph.</p>

</div>

<button id="sprite-batching" type="button" class="foldout_button" onclick="
    this.classList.toggle('active');
    var content = this.nextElementSibling;
    if (content.style.display === 'block') {
      content.style.display = 'none';
      this.innerHTML = '<b>⯈ Why does the Object space (\u0026amp; \u003cb class=\u0022node\u0022\u003eObject\u003c\/b\u003e node) not work correctly for Sprites?</b>';
    } else {
      content.style.display = 'block';
      this.innerHTML = '<b>⯆ Why does the Object space (\u0026amp; \u003cb class=\u0022node\u0022\u003eObject\u003c\/b\u003e node) not work correctly for Sprites?</b>';

      if (history.pushState) {
        var newurl = window.location.protocol + '//' + window.location.host + window.location.pathname;
        newurl = newurl + '#sprite-batching';
        window.history.pushState({path:newurl}, '', newurl);
      }

    }
"><b>⯈ Why does the Object space (&amp; <b class="node">Object</b> node) not work correctly for Sprites?</b></button>
<div class="foldout">
<p>Note : Unity 2023.1+ now uses SRP Batching for sprites (in play mode at least) which somewhat fixes this.</p>
<p>For prior versions (and if SRP batching is disabled) :</p>
<p>To save on drawcalls (and performance), Sprites on the screen that use the same material, are batched so they can be drawn together. It shows as &ldquo;Draw Dynamic&rdquo; in the Frame Debugger window. When this batching occurs, meshes for each sprite are transformed into World space and combined into a single object. The model matrix (<code>UNITY_MATRIX_M</code>) is cleared to an identity matrix (scale of 1, no rotation/translation)</p>
<p>The model matrix is usually responsible for transforming vertex data stored in the mesh into World space, but an identity matrix is used so the values aren&rsquo;t altered. &ldquo;Object space&rdquo; now doesn&rsquo;t really exist on the shader side, as the vertex positions are <em>already stored in World space</em>.</p>
<p>Anything else that relies on the model matrix also won&rsquo;t work correctly, such as calculating the origin and scale of the object (outputs on the <b class="node">Object</b> node)</p>
<p>There isn&rsquo;t really a good way around this afaik, but I don&rsquo;t work in 2D that often. You could break batching by using different material instances, but that may not be good for performance. Typically you would try to rely on UV coordinates rather than vertex positions.</p>
<p>You could consider using MeshRenderers instead as they can support the SRP Batcher - which doesn&rsquo;t combine meshes, but instead batches setup between the draw calls.</p>

</div>

<button id="samplers" type="button" class="foldout_button" onclick="
    this.classList.toggle('active');
    var content = this.nextElementSibling;
    if (content.style.display === 'block') {
      content.style.display = 'none';
      this.innerHTML = '<b>⯈ Error : \u003ccode\u003emaximum ps_5_0 sampler register index (16) exceeded\u003c\/code\u003e</b>';
    } else {
      content.style.display = 'block';
      this.innerHTML = '<b>⯆ Error : \u003ccode\u003emaximum ps_5_0 sampler register index (16) exceeded\u003c\/code\u003e</b>';

      if (history.pushState) {
        var newurl = window.location.protocol + '//' + window.location.host + window.location.pathname;
        newurl = newurl + '#samplers';
        window.history.pushState({path:newurl}, '', newurl);
      }

    }
"><b>⯈ Error : <code>maximum ps_5_0 sampler register index (16) exceeded</code></b></button>
<div class="foldout">
<p>This error means the shader is using more than 16 samplers. While shaders can support more textures (DX11 supports 128), it has a much lower limit to the number of samplers. To get around this, we can <strong>re-use samplers from other textures</strong> or use <strong>inline sampler states</strong>.</p>
<ul>
<li>Note this requires using the DX11-style syntax where samplers are separated from textures (e.g. <code>Texture2D</code> and <code>SamplerState</code>, rather than <code>sampler2D</code>).</li>
<li>Can find more information on the <a href="https://docs.unity3d.com/Manual/SL-SamplerStates.html">SL-SamplerStates docs</a> page.</li>
</ul>
<p>In Shader Graph, can use <b class="node">Sampler State</b> node to achieve this, which would be connected to the sampler port on the <b class="node">Sample Texture 2D</b> node.</p>

</div>

<button id="glsl-mod" type="button" class="foldout_button" onclick="
    this.classList.toggle('active');
    var content = this.nextElementSibling;
    if (content.style.display === 'block') {
      content.style.display = 'none';
      this.innerHTML = '<b>⯈ HLSL fmod vs GLSL mod</b>';
    } else {
      content.style.display = 'block';
      this.innerHTML = '<b>⯆ HLSL fmod vs GLSL mod</b>';

      if (history.pushState) {
        var newurl = window.location.protocol + '//' + window.location.host + window.location.pathname;
        newurl = newurl + '#glsl-mod';
        window.history.pushState({path:newurl}, '', newurl);
      }

    }
"><b>⯈ HLSL fmod vs GLSL mod</b></button>
<div class="foldout">
<p>Be aware that the GLSL <code>mod</code> function is not an exact equivalent to <code>fmod</code> function in HLSL, the result will be different when dealing with negative values.</p>
<ul>
<li>HLSL fmod is equivalent to <code>x - y * trunc(x/y)</code></li>
<li>GLSL mod is equivalent to <code>x - y * floor(x/y))</code></li>
</ul>
<p>If you are converting a shader, you may want to implement your own mod function using that code instead.</p>

</div>

<button id="cg-vs-hlsl" type="button" class="foldout_button" onclick="
    this.classList.toggle('active');
    var content = this.nextElementSibling;
    if (content.style.display === 'block') {
      content.style.display = 'none';
      this.innerHTML = '<b>⯈ CG vs HLSL</b>';
    } else {
      content.style.display = 'block';
      this.innerHTML = '<b>⯆ CG vs HLSL</b>';

      if (history.pushState) {
        var newurl = window.location.protocol + '//' + window.location.host + window.location.pathname;
        newurl = newurl + '#cg-vs-hlsl';
        window.history.pushState({path:newurl}, '', newurl);
      }

    }
"><b>⯈ CG vs HLSL</b></button>
<div class="foldout">
<p>While many shaders in the Built-in RP use <code>CGPROGRAM</code> and <code>ENDCG</code> in their shader code, they are still actually written (and compiled) using <strong>HLSL</strong>. Unity used to use Nvidia&rsquo;s <strong>CG</strong> language, but it was deprecated and is no longer used.</p>
<p>When using the <code>CGPROGRAM</code> tag, Unity automatically includes some files from the Built-in RP shader includes (such as <code>HLSLSupport.cginc</code> and <code>UnityShaderVariables.cginc</code>). This can cause conflicts with other shader libraries - so shaders written for the Post Processing package, URP, and HDRP, should all use <code>HLSLPROGRAM</code> and <code>ENDHLSL</code> instead.</p>
<p>Even if it is all HLSL, it&rsquo;s important to note that the code written for each pipeline can still vary quite a lot as they use separate include files, which can contain different functions and macros. Can view the ShaderLibrary code via :</p>
<ul>
<li>For Built-in RP, can view via <a href="https://github.com/TwoTailsGames/Unity-Built-in-Shaders">this unofficial Github repo</a>, or <a href="https://unity3d.com/get-unity/download/archive">download it from Unity&rsquo;s site</a> (Select &ldquo;Built-in Shaders&rdquo; option from a dropdown for the version you are using)</li>
<li><a href="https://github.com/Unity-Technologies/Graphics/tree/master/Packages/com.unity.render-pipelines.core/ShaderLibrary">SRP (Scriptable Render Pipeline) core</a> - Accessible to URP, HDRP and custom SRPs.</li>
<li><a href="https://github.com/Unity-Technologies/Graphics/tree/master/Packages/com.unity.render-pipelines.universal/ShaderLibrary">URP</a> - Also see my <a href="https://www.cyanilux.com/tutorials/urp-shader-code/">Writing Shader Code for URP</a> post.</li>
<li><a href="https://github.com/Unity-Technologies/Graphics/tree/master/Packages/com.unity.render-pipelines.high-definition/Runtime">HDRP</a></li>
</ul>

</div>


<script>
    if (window.location.search == "?expand-all-foldouts"){
        const foldouts = document.getElementsByClassName("foldout_button");
        for (let i = 0; i < foldouts.length; i++) {
            const obj = foldouts.item(i);
            console.log(obj);
            obj.classList.add('active');
            obj.nextElementSibling.style.display = 'block';
            obj.innerHTML = obj.innerHTML.replace("⯈", "⯆");
        }
    }
    
    // When we jump to page using #anchor, it needs to trigger the foldout to be active
    if (window.location.hash){
        console.log(window.location.hash.substring(1));
        const obj = document.getElementById(window.location.hash.substring(1));
        console.log(obj);
        if (obj && obj.classList == "foldout_button"){
            obj.click();
            //obj.classList.add('active');
            //obj.nextElementSibling.style.display = 'block';
        }
    }
</script>



        </div>
        </br>

<p class="footer"><a class="small-text" href="https://twitter.com/Cyanilux">© 2019-2024 Cyanilux </a></p>

<p class="small-text" style="text-align:center;">



	<a href="https://www.cyanilux.com/#license">
	
	License / Usage
	</a>
	 &#8212; 

	<a href="https://www.cyanilux.com/cookies">
	
	Cookies & Privacy
	</a>
	 &#8212; 

	<a href="https://www.cyanilux.com/index.xml">
	
	RSS Feed
	</a>
	

</p>
</br>

<div class="cookie-container">
<p>Hello! This site uses cookies related to Twitter (for showing embedded tweets) &amp; Google Analytics (to provide anonymous stats about which web pages are visited, links clicked, etc). These help with improving the website and letting me know what content is popular. 
See the <a href="https://www.cyanilux.com/cookies">Cookies & Privacy</a> page for more info.</p>
<button class="cookie-accept-btn"><b>Accept</b></button>
<button class="cookie-refuse-btn"><b>Refuse</b></button>
</div>

<script>
	var webStorageSupported = (typeof(Storage) !== undefined);
	
	function setCookie(cname, cvalue, exdays) {
		var d = new Date();
		d.setTime(d.getTime() + (exdays*24*60*60*1000));
		var expires = "expires="+ d.toUTCString();
		document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
	}
	
	const cookieContainer = document.querySelector(".cookie-container");
	const cookieAcceptButton = document.querySelector(".cookie-accept-btn");
	const cookieRefuseButton = document.querySelector(".cookie-refuse-btn");
	
	cookieAcceptButton.addEventListener("click", () => {
		cookieContainer.classList.remove("active");
	
		if (webStorageSupported){
			localStorage.setItem("cookiesAccepted", "true");
		}else{
			
			setCookie("cookiesAccepted", "true", 365);
		}
		
		location.reload();
	});
	
	cookieRefuseButton.addEventListener("click", () => {
		cookieContainer.classList.remove("active");
	
		
		
		document.cookie.split(";").forEach(function(c) { document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/"); });
		
		if (webStorageSupported){
			localStorage.setItem("cookiesAccepted", "false");
		}else{
			
			setCookie("cookiesAccepted", "false", 14);
		}
	});
	
	setTimeout(() => {
		if (showBanner) {
			cookieContainer.classList.add("active");
		}
	}, 1000);
</script>
    </body>
</html>
