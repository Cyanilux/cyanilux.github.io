<!DOCTYPE html>
<html lang="en">
    <head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<link rel="apple-touch-icon" sizes="180x180" href="https://www.cyanilux.com/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://www.cyanilux.com/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://www.cyanilux.com/favicon-16x16.png">
<link rel="manifest" href="https://www.cyanilux.com/site.webmanifest">
<meta name="msapplication-TileColor" content="#00aba9">
<meta name="theme-color" content="#ffffff">
<link rel="alternate" type="application/rss+xml" title="RSS Feed" href="https://www.cyanilux.com/index.xml"> 
<link rel="stylesheet" type="text/css" href="https://www.cyanilux.com/css/style.css?v=6 ">


<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": "Intro to the Shader Pipeline",
  "name": "Intro to the Shader Pipeline",
  "description": "An introduction to what a Mesh, Shader and Material is in Unity, how to set Shader Properties from C#, various types of Batching, and a brief look at Forward, Forward\u002b and Deferred rendering paths",
  "datePublished": "2021-01-10",
  "dateModified": "2023-10-13",
  "author": {
	"@type": "Person",
	"name": "Cyanilux",
	"url": "https://www.cyanilux.com"
  },
  "image": {
    "@type": "ImageObject",
    "@id": "https://www.cyanilux.com/tutorials/intro-to-the-shader-pipeline/Preview_hu497034e703d475b0e8f89da654da8183_24877_300x0_resize_box_3.png",
    "url": "https://www.cyanilux.com/tutorials/intro-to-the-shader-pipeline/Preview_hu497034e703d475b0e8f89da654da8183_24877_300x0_resize_box_3.png",
    "height": "251",
    "width": "300"
  },
  "url": "https://www.cyanilux.com/tutorials/intro-to-the-shader-pipeline/",
  "inLanguage": "en-gb",
  "wordCount": "4561",
  "isPartOf": {
    "@type" : "Blog",
    "@id": "https://www.cyanilux.com",
    "name": "Cyanilux - Game Dev Blog \u0026 Tutorials"
  },
  "keywords": [
    "Unity", 
    "Tutorial", 
    "HLSL"
  ]
}
</script>

<meta name="twitter:card" content="summary_large_image"/>
	<meta name="twitter:image" content="https://www.cyanilux.com/tutorials/intro-to-the-shader-pipeline/Preview.png"/>
<meta name="twitter:title" content="Intro to the Shader Pipeline"/>
<meta name="twitter:description" content="An introduction to what a Mesh, Shader and Material is in Unity, how to set Shader Properties from C#, various types of Batching, and a brief look at Forward, Forward&#43; and Deferred rendering paths"/>

<meta property="og:title" content="Intro to the Shader Pipeline" />
<meta property="og:description" content="An introduction to what a Mesh, Shader and Material is in Unity, how to set Shader Properties from C#, various types of Batching, and a brief look at Forward, Forward&#43; and Deferred rendering paths" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.cyanilux.com/tutorials/intro-to-the-shader-pipeline/" />

	
        
        
            <meta name="og:image" content="https://www.cyanilux.com/tutorials/intro-to-the-shader-pipeline/Preview.png"/>
        
    
<meta property="article:published_time" content="2021-01-10T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-10-13T00:00:00+00:00" />
<title>Intro to the Shader Pipeline | Cyanilux</title>
<meta name="description" content="An introduction to what a Mesh, Shader and Material is in Unity, how to set Shader Properties from C#, various types of Batching, and a brief look at Forward, Forward&#43; and Deferred rendering paths. HLSL | Unity Shader Tutorials, @Cyanilux" />
<link rel="canonical" href="https://www.cyanilux.com/tutorials/intro-to-the-shader-pipeline/" />
<script>
	var webStorageSupported = (typeof(Storage) !== undefined);
	
	function getCookie(cname) {
		var name = cname + "=";
		var decodedCookie = decodeURIComponent(document.cookie);
		var ca = decodedCookie.split(';');
		for(var i = 0; i <ca.length; i++) {
			var c = ca[i];
			while (c.charAt(0) == ' ') {
				c = c.substring(1);
			}
			if (c.indexOf(name) == 0) {
				return c.substring(name.length, c.length);
			}
		}
		return "";
	}
	
	var cookie;
	if (webStorageSupported){
		cookie = localStorage.getItem("cookiesAccepted");
	}else{
		cookie = getCookie("cookiesAccepted");
	}
	
	var showBanner = false;
	var cookiesAccepted = false;
	if (cookie == "true"){
		cookiesAccepted = true;
		showBanner = false;
	}else if (cookie === null || cookie == ""){
		showBanner = true;
	}
</script>



<script>
	if (cookiesAccepted){
		
		document.write("<script async src=\"https://www.googletagmanager.com/gtag/js?id=G-11MK1LK6C3\"><\/script>" +
		"<script>\n"+
		"window.dataLayer = window.dataLayer || [];\n" +
		"function gtag(){dataLayer.push(arguments);}\n" +
		"gtag('js', new Date());\n" +
		"gtag('config', 'G-11MK1LK6C3', { 'anonymize_ip': true });\n" + 
		"<\/script>");
	}
</script>


</head>
    <body>
        
<div class="header">
	<div class="logo-header-div"> 
	<a class="link-plain" href="https://www.cyanilux.com">
		<img class="logo" alt="Logo" width="128" height="128" src="https://www.cyanilux.com/logo-small.png"/>
	</a>
	<div class="logo-text-div">
		<h1 class="title-no-margin">
			<a class="logo-text" href="https://www.cyanilux.com">Cyanilux</a>
		</h1>
		<b class="logo-subtext">Game Dev Blog &amp; Tutorials</b>
	</div>
	</div>
	
	<div class="nav-links-div">
	<nav id="nav-links" class="nav-links">
		<ul>
			
			<li><a class="nav-link" href="https://twitter.com/Cyanilux">
			<img src="https://www.cyanilux.com/logo-twitter.png" alt="Twitter"></img>
			</a>
			</li>
			
			<li><a class="nav-link" href="https://mastodon.gamedev.place/@Cyanilux">
			<img src="https://www.cyanilux.com/logo-mastodon.png" alt="Mastodon"></img>
			</a>
			</li>
			
			<li><a class="nav-link" href="http://discord.gg/2V93q9w">
			<img src="https://www.cyanilux.com/logo-discord.png" alt="Discord"></img>
			</a>
			</li>
			
			<li><a class="nav-link" href="https://github.com/Cyanilux">
			<img src="https://www.cyanilux.com/logo-github.png" alt="Github"></img>
			</a>
			</li>
			
		</ul>
	</nav>
	</div>
	
	<nav id="nav" class="nav">
	<ul>
		
		<li><b><a class="nav-link" href="https://www.cyanilux.com/contents/">
		Contents
		</a></b>
		</li>
		
		<li><b><a class="nav-link" href="https://www.cyanilux.com/recent/">
		Recent Posts
		</a></b>
		</li>
		
		<li><b><a class="nav-link" href="https://www.cyanilux.com/resources/">
		Resources
		</a></b>
		</li>
		
		<li><b><a class="nav-link" href="https://www.cyanilux.com/faq/">
		FAQ
		</a></b>
		</li>
		
	</ul>
	</nav>
</div>
        <div class="content">
        

<h1>Intro to the Shader Pipeline</h1>
<div class="post-metadata">


<div class="tag" style="background-color:#505050;">
	<a href="https://www.cyanilux.com/tutorials/posts/" style="text-decoration: none; color:#eeeeee;">
	Posts
	</a>
</div>




	<div class="tag" style="background-color:#108010;">
	
	<a href="https://www.cyanilux.com/tags/hlsl" style="text-decoration: none; color:#eeeeee;">
	HLSL
	</a>
	</div>




<div style="width:10px"></div>
<time datetime="2021-01-10">&#128337 10 Jan 2021</time>


<div style="width:5px"></div>
<time datetime="2023-10-13"> (updated 13 Oct 2023)</time>

</div>
<p>Hello! This is a small introduction to shader related concepts and how they are used to render graphics in Unity.</p>
<p>(Updated October 2023)</p>
<h3 id="sections-">Sections :</h3>
<ul>
<li><a href="#mesh">What is a Mesh?</a></li>
<li><a href="#shader">What is a Shader?</a></li>
<li><a href="#render-pipelines">Render Pipelines</a></li>
<li><a href="#shader-code">Shader Code</a></li>
<li><a href="#passes">Shader Passes</a></li>
<li><a href="#forward-vs-deferred">Rendering Paths</a></li>
<li><a href="#other-types">Other Types of Shaders</a></li>
<li><a href="#materials">Materials &amp; Properties</a></li>
<li><a href="#properties">Setting Properties from C#</a></li>
<li><a href="#properties-global">Global Shader Properties</a></li>
<li><a href="#material-instances">Material Instances &amp; Batching</a></li>
<li><a href="#srp-batcher">SRP Batcher</a></li>
</ul>
<hr>
<h2 id="mesh">What is a Mesh?</h2>
<p>A <strong>mesh</strong> contains the data for a <strong>3D model</strong>, typically consisting of <strong>vertices</strong> and how they connect into <strong>triangles</strong>. Each triangle is made up of 3 vertices - though a vertex can be shared between multiple triangles (so there won&rsquo;t always be triple the amount of vertices than triangles).</p>
<div class="img-center">
<a href="Cube.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="412" height="389" alt="(Image)" src="Cube.png" />
</a>
<p class="img-text">Example Cube Mesh, consisting of 12 triangles. In Blender (3D modelling software), this has 8 vertices, however this value may change when importing into Unity depending on whether it&rsquo;s per-vertex data is the same between shared vertices.</p>
</div>
<p>The terms &ldquo;mesh&rdquo; and &ldquo;model&rdquo; are usually used as interchangeable words. But if we are being specific, a mesh always refers to the <em>geometry</em> (vertices/triangles) while a model may refer to the <em>imported file</em>, which can actually contain multiple objects, as well as materials, animations, etc. When a model has an object with <em>multiple materials</em> applied, Unity imports these as <strong>sub-meshes</strong> stored within the mesh. These sub-meshes share the same vertices array, but have different triangle arrays - corresponding to an element of the Materials array under the MeshRenderer component.</p>
<p>A model is commonly made in external 3D modelling programs, such as Blender, and imported into unity (usually using the .FBX format) but we can also generate (and/or edit) a Mesh at runtime using the methods in the <a href="https://docs.unity3d.com/ScriptReference/Mesh.html">C# Mesh class</a>.</p>
<p>When we mention &ldquo;vertex&rdquo; we are usually referring to it&rsquo;s position in 3D space, but every vertex in the mesh can contain many pieces of data. This includes data such as :</p>
<ul>
<li><strong>Position</strong> in 3D space (<strong>Object</strong> space, so (0,0,0) is at the origin of the mesh).</li>
<li><strong>UVs</strong>, also known as <strong>Texture Coordinates</strong> as they are most commonly used for applying a texture to the model. These coordinates are typically Vector2 (two floating point values, each axis labelled as either xy or uv) but the actual UV channels can be Vector4, so can contain up to 4 floats in order to pass data in. See <a href="https://docs.unity3d.com/ScriptReference/Mesh.SetUVs.html">Mesh.SetUVs</a>.</li>
<li><strong>Normals</strong> (a direction used for shading. Some modelling programs (e.g. Blender) may also use these to determine the winding order of the vertices, which shows which way the face is pointing. It is possible in a shader to cull the front or back side of a face when rendering)</li>
<li><strong>Tangents</strong> (a direction perpendicular (90 degrees) to the normal that follows the meshes surface along the horizontal texture coord (uv.x). Used for constructing Tangent Space, which is important for shading techniques such as <strong>Normal/Bump Mapping</strong>)</li>
<li><strong>Vertex Colours</strong> (a colour given to each vertex)</li>
</ul>
<p>While two vertices may share the same position in 3D space, if their other data doesn&rsquo;t also match then they must be two separate elements in the vertex data arrays.</p>
<div class="img-center">
<a href="CubeNormals.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="716" height="351" alt="(Image)" src="CubeNormals.png" />
</a>
<p class="img-text">Example Cube Mesh. Both have <b>12</b> triangles but the left has <b>24</b> vertices, while the right has <b>8</b> vertices.</p>
</div>
<p>This is quite common if a model has <strong>flat shading</strong> rather than <strong>smooth shading</strong> like in the image above. Flat shading will increase the number of vertices because the <strong>Vertex Normals</strong> need to point in different directions depending on which face they are a part of. (This might not happen in the modelling program itself, but would when it&rsquo;s exported to Unity). Smooth shading instead takes an <strong>average</strong> of these directions, so those vertices can be shared, assuming all other data is also the same!</p>
<hr>
<h2 id="shader">What is a Shader?</h2>
<p>A <a href="https://en.wikipedia.org/wiki/Shader">Shader</a> is code that runs on the <a href="https://en.wikipedia.org/wiki/Graphics_processing_unit">GPU (Graphics processing unit)</a>, similar to how a C# script is for the CPU. In Unity a single &ldquo;.shader&rdquo; file contains a <strong>shader program</strong>, which usually contains multiple &ldquo;<strong>passes</strong>&rdquo; that are used to render a mesh. Each pass contains a <strong>Vertex shader</strong> and <strong>Fragment shader</strong> (sometimes also referred to as a pixel shader). (Perhaps slightly confusingly, it&rsquo;s common to use &ldquo;shader&rdquo; to refer to the specific stages, as well as the shader program/file as a whole).</p>
<p>The <strong>vertex shader</strong> runs for each vertex in a mesh and is responsible for transforming the 3D vertex positions (object space) from the mesh into <strong>Clip space positions</strong> (positions used to clip geometry to only render what is visible by a camera. There&rsquo;s a few extra steps to turn this into a 2D screen position. I&rsquo;ll hopefully be going over spaces in more detail in a future post). It also should pass other data that will be needed for calculations into the fragment stage, such as data from the mesh (UVs, normals, etc).</p>
<p>For tools like Shader Graph, this is mostly handled for us but it&rsquo;s still very important to recognise there is two separate stages going on here - though this should be pretty clear as the <a href="https://docs.unity3d.com/Packages/com.unity.shadergraph@10.2/manual/Master-Stack.html">Master Stack</a> separates the output ports into Vertex and Fragment stages (as of Unity 2020.2+). The <strong>Position</strong> port (under the Vertex stage) is exposed for us to override the object space position before it is transformed to clip space, e.g. for <a href="https://www.cyanilux.com/tutorials/vertex-displacement">Vertex Displacement</a>. We can also override the Normal and Tangent that is passed to the fragment stage (important for lit shading to be correct). Shader Graph will automatically use data from the mesh if these ports are left blank.</p>
<p>For each triangle, and vertex in that triangle, the clip space positions passed out from the vertex stage is used to create <strong>fragments</strong> during a stage known as <strong>Rasterization</strong>. You can think of these fragments as &ldquo;potential pixels&rdquo; on the 2D screen (though multiple triangles can of course overlap which means fragments can be discarded or blend with the current pixel colour).</p>
<p>All of the per-vertex data passed into the fragment shader also gets <strong>interpolated</strong> across the triangle. A common example is while each vertex can specify a single vertex colour, a fragment shader outputting this results in blended colours.</p>
<div class="img-center">
<a href="VertexColourInterpolation.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="300" height="251" alt="(Image)" src="VertexColourInterpolation.png" />
</a>
<p class="img-text"></p>
</div>
<p>The <strong>fragment shader</strong> runs for each of these fragments (potential pixels) and determines its <strong>colour</strong> that will be drawn to the screen (and in some cases, outputs a <strong>depth</strong> value too). This could be outputting a solid colour, using vertex colours, sampling textures, and/or handling lighting calculations to produce a more complex <em>shading</em> - where the name &ldquo;shader&rdquo; comes from.</p>
<p>In some cases, we might also want to intentionally discard/clip a pixel from being rendered (e.g. alpha clipping/cutout shader)</p>
<hr>
<h2 id="render-pipelines">Render Pipelines</h2>
<p>Unity has a few <a href="https://docs.unity3d.com/Manual/render-pipelines-overview.html">render pipelines</a> which completely changes how rendering works. The default is the <strong>Built-in Render Pipeline (BiRP)</strong> which many older tutorials and assets are designed to work with. But in 2018/19 Unity also introduced <strong>Scriptable Render Pipelines (SRPs)</strong> such as :</p>
<ul>
<li><a href="https://docs.unity3d.com/Packages/com.unity.render-pipelines.universal@latest">Universal Render Pipeline</a>, intended to work across many platforms. It&rsquo;s mostly equivalent to BiRP, but is meant to be more optimised and customisable. (Known as &ldquo;Lightweight Render Pipeline (LWRP)&rdquo; prior to Unity 2019.3)
<ul>
<li>Note this is also somewhat separated into two - You have the option to use the &ldquo;Universal Renderer Asset&rdquo; (meant for 3D) and the &ldquo;2D Renderer Asset&rdquo; which gives access to URP&rsquo;s <a href="https://docs.unity3d.com/Packages/com.unity.render-pipelines.universal@17.0/manual/2d-index.html">2D Lighting System</a>.</li>
</ul>
</li>
<li><a href="https://docs.unity3d.com/Packages/com.unity.render-pipelines.high-definition@latest">High Definition Render Pipeline</a>, intended for high-end platforms to create cutting-edge, high-fidelity graphics.</li>
<li>Also possible to write your own <a href="https://docs.unity3d.com/Manual/srp-custom.html">Custom Scriptable Render Pipeline</a>. That page has some info, there&rsquo;s also some tutorials such as this series by <a href="https://catlikecoding.com/unity/tutorials/custom-srp/">CatlikeCoding</a> (and it&rsquo;s <a href="https://catlikecoding.com/unity/custom-srp/">continuation</a>).</li>
</ul>
<p>I&rsquo;m not going into a huge amount of detail here but it&rsquo;s important to know these pipelines exist as many Shaders and Assets are created for one or more pipelines and may not work in others. As much of the ShaderLibrary code is different, it is not possible to convert custom <code>.shader</code> files from one pipeline to another and they often need rewriting instead. For the built-in shaders, each pipeline usually has an equivalent and there are some tools to convert materials if upgrading a project. The docs linked above have instructions, (Always a good idea to back-up the project before upgrading!)</p>
<p>When creating a new project, there are also templates for each of these pipelines, as well as sample scenes.</p>
<p>One of the main advantages of these scriptable render pipelines is they support the SRP Batcher - which makes drawcalls (rendering objects to the screen) cheaper. Tools such as Shader Graph and VFX Graph (node based editors for writing shaders and creating particle effects respectively) were also created with these newer pipelines in mind. (Though the Built-in RP does support Shader Graph as of 2021.2).</p>
<p>For beginners, I&rsquo;d recommend using URP &amp; Shader Graph.</p>
<hr>
<h2 id="shader-code">Shader Code</h2>
<p>In Unity shaders are written <strong>HLSL</strong> (High Level Shading Language), though you&rsquo;ll typically also see it referred to as <strong>CG</strong>, especially when dealing with the Built-in RP.</p>
<p>In a <code>.shader</code> file, you&rsquo;ll always see this shader code between <strong>CGPROGRAM</strong> / <strong>HLSLPROGRAM</strong>  and <strong>ENDCG</strong> / <strong>ENDHLSL</strong> tags. (You might also see <strong>CGINCLUDE</strong> / <strong>HLSLINCLUDE</strong> which includes the code in every shader pass). Shaders for URP/HDRP should always use the <strong>HLSL</strong> versions of these tags as the CG ones include some extra files which aren&rsquo;t needed by those pipelines. It will cause the shader to error due to redefintions in their shader libraries.</p>
<p>The rest of the file is written in a Unity-specific syntax known as <strong>ShaderLab</strong>, which includes blocks such as &ldquo;Shader&rdquo;, &ldquo;Properties&rdquo;, &ldquo;SubShader&rdquo;, and &ldquo;Pass&rdquo;. You can find documentation for this Shaderlab syntax in the <a href="https://docs.unity3d.com/Manual/SL-Shader.html">docs pages here</a>.</p>
<p>Technically Shaderlab has some legacy &ldquo;fixed-function&rdquo; ways of creating shaders which means a CG/HLSL PROGRAM isn&rsquo;t needed, but I wouldn&rsquo;t worry about learning these as they are outdated and programming the shader is much more useful.</p>
<p>Alternatively there are also node-based shader editors, such as <a href="https://docs.unity3d.com/Packages/com.unity.shadergraph@latest">Shader Graph</a> (official, avaliable for URP, HDRP and Built-in RP as of Unity 2021.2+), <a href="https://assetstore.unity.com/packages/tools/visual-scripting/amplify-shader-editor-68570">Amplify Shader Editor</a> (but not free), and <a href="https://github.com/FreyaHolmer/ShaderForge">Shader Forge</a> (no longer developed, only works on older Unity versions).</p>
<p>Even if you&rsquo;re working with graphs/nodes, these tools will generate shader code files behind the scenes. Knowing some HLSL can also be useful for Custom Function/Expression nodes which allow you to write code in the graph or call a function from a <code>.hlsl</code> file.</p>
<hr>
<h2 id="passes">Shader Passes</h2>
<p>Shaders can contain multiple subshaders and passes. The <strong>RenderPipeline</strong> tag is useful to tell Unity which pipeline the SubShader is intended for if the shader needs to support multiple pipelines. While the <strong>LightMode</strong> tag is important to tell Unity what a pass is used for.</p>
<p>If Unlit (meaning unaffected by lighting, always fully lit), the &ldquo;main&rdquo; pass is typically one without a <strong>LightMode</strong> tag specified. For Lit shaders it should be tagged &ldquo;UniversalForward&rdquo; (URP), &ldquo;ForwardBase&rdquo; (Built-in Pipeline) or &ldquo;Forward&rdquo; (HDRP), assuming the shader needs to support Forward Rendering (next section will explain this in more detail).</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span><span style="color:#75715e">// e.g.</span>
</span></span><span style="display:flex;"><span>SubShader {
</span></span><span style="display:flex;"><span>	Tags { <span style="color:#e6db74">&#34;RenderType&#34;</span>=<span style="color:#e6db74">&#34;Opaque&#34;</span> <span style="color:#e6db74">&#34;RenderPipeline&#34;</span>=<span style="color:#e6db74">&#34;UniversalPipeline&#34;</span> }
</span></span><span style="display:flex;"><span>	Pass {
</span></span><span style="display:flex;"><span>		Name <span style="color:#e6db74">&#34;Example&#34;</span>
</span></span><span style="display:flex;"><span>		Tags { <span style="color:#e6db74">&#34;LightMode&#34;</span>=<span style="color:#e6db74">&#34;UniversalForward&#34;</span> }
</span></span><span style="display:flex;"><span>	 
</span></span><span style="display:flex;"><span>		HLSLPROGRAM
</span></span><span style="display:flex;"><span>			...
</span></span><span style="display:flex;"><span>		ENDHLSL
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	Pass {
</span></span><span style="display:flex;"><span>		Name <span style="color:#e6db74">&#34;Example2&#34;</span>
</span></span><span style="display:flex;"><span>		Tags { <span style="color:#e6db74">&#34;LightMode&#34;</span>=<span style="color:#e6db74">&#34;ShadowCaster&#34;</span> }
</span></span><span style="display:flex;"><span>	 
</span></span><span style="display:flex;"><span>		HLSLPROGRAM
</span></span><span style="display:flex;"><span>			...
</span></span><span style="display:flex;"><span>		ENDHLSL
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// etc.</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></td></tr></table>
</div>
</div>
<p>In URP and the Built-in RP there is usually also a <strong>ShadowCaster</strong> pass in the shader program, which as the name suggests, allows the mesh to cast shadows. Each pass has its own vertex and fragment shader. In this case, the vertex shader uses the shadow bias settings to offset the vertices a little, which helps prevent shadowing artifacts. The fragment shader here usually just outputs 0 (black) as it&rsquo;s colour isn&rsquo;t that important. It only needs to discard/clip the fragment if a shadow shouldn&rsquo;t be cast for that pixel.</p>
<p>There&rsquo;s also a <strong>DepthOnly</strong> pass used in URP and HDRP which is very similar to the ShadowCaster but without the bias offsets. It allows a Depth Prepass to occur, which is sometimes used to create a Depth Texture. You can find more information about that in the <a href="https://www.cyanilux.com/tutorials/depth">Depth</a> post. In the Built-in pipeline I believe it doesn&rsquo;t have this pass, so the Depth Texture is instead created using the ShadowCaster pass.</p>
<p>Depending on the pipeline, there may be more passes that a shader can include. You can find some listed <a href="https://docs.unity3d.com/Manual/SL-PassTags.html">on the PassTags docs page</a> for the built-in pipeline. Looking at the built-in shaders is also a good way to find out about each pass. You can download the built-in pipeline shaders source via the <a href="https://unity3d.com/get-unity/download/archive">unity download page</a>, and also find source for URP and HDRP via the <a href="https://github.com/Unity-Technologies/Graphics">Graphics github</a>.</p>
<p>When using Shader Graph and other node editors, most of these &ldquo;extra&rdquo; passes are handled for us. We only really focus on that main Unlit or Forward pass that outputting to the colour buffer. If alpha clipping is enabled the graph will automatically handle this in other passes like the ShadowCaster &amp; DepthOnly. But if you want to be able to include different alpha values per-pass for example, you can do so with a <b class="node">Custom Function</b> node as explained here - <a href="https://www.cyanilux.com/tutorials/intro-to-shader-graph/#shader-pass-defines">Intro to Shader Graph : Shader Pass Defines</a>.</p>
<hr>
<h2 id="forward-vs-deferred">Rendering Paths</h2>
<h3 id="forward">Forward</h3>
<p>Forward rendering can be considered the &ldquo;regular&rdquo; way of rendering things, where the shader calculates the pixel colour that is directly drawn to the screen.</p>
<p>Every fragment produced by the mesh has to do light calculations, even if it gets covered by another fragment in the same mesh or another object (though opaque objects closer to the camera tend to be drawn first to minimise this). Because of this there is typically a limit to the number of realtime lights that can affect each GameObject. In URP this is 1 Main Directional + 8 Additional Lights. Built-in has a similar limit but I think it can be increased in the graphics/quality settings (though with a performance penalty).</p>
<h3 id="deferred">Deferred</h3>
<p><a href="https://docs.unity3d.com/Manual/RenderTech-DeferredShading.html">Deferred Rendering</a> (or Deferred Shading) instead has the advantage of having no limit to the number of lights per GameObject because the lighting is handled later in the pipeline on <strong>each screen pixel inside the volume of the light</strong>. Having more lights will still effect performance, but only if their ranges are very large on the screen. Though this only works with opaque geometry - Transparents are still be rendered in Forward.</p>
<p>However in order for this to work, there needs to be a bunch of additional buffers (known as geometry buffers / G-buffers) - storing per-pixel data like Albedo (aka Base Color) &amp; Occlusion, Specular &amp; Smoothness, Normals, and Emission &amp; GI. A disadvantage is this takes up more memory.</p>
<p>Instead of using the forward pass which outputs straight to the camera colour buffer, the deferred pass renders to these buffers using <strong>Multiple Render Targets (MRT)</strong>. This isn&rsquo;t supported on all platforms - so some may be limited to using Forward instead.</p>
<p>These g-buffers are then sampled later during a <strong>full-screen pass</strong> which handles the lighting/shading calculations and outputs the final colour for each pixel. It&rsquo;s sometimes possible to override this with a custom shader - though isn&rsquo;t documented and tends to be quite complicated. But useful if you want custom lighting such as toon/cel shaded for the entire scene.</p>
<ul>
<li>For Built-in RP there&rsquo;s some tutorials of this, such as this <a href="https://www.patreon.com/posts/shaders-for-who-34008552">Deferred article by Xibanya / Team Dogpit</a>.</li>
<li>For URP, I believe you can override the shader/material if using the Debug version of the Inspector on the URP Asset (or Universal Renderer Asset?). You&rsquo;d likely want to use the default <a href="https://github.com/Unity-Technologies/Graphics/blob/master/Packages/com.unity.render-pipelines.universal/Shaders/Utils/StencilDeferred.shader">StencilDeferred.shader</a> (and <a href="https://github.com/Unity-Technologies/Graphics/blob/master/Packages/com.unity.render-pipelines.universal/Shaders/Utils/StencilDeferred.hlsl">StencilDeferred.hlsl</a> include) as an example/basis.</li>
<li>I&rsquo;m not familiar with HDRP and it&rsquo;s likely not designed to be edited there - but probably possible if you fork the package.</li>
</ul>
<p>These deferred tutorials may be useful for further reading :</p>
<ul>
<li><a href="https://catlikecoding.com/unity/tutorials/rendering/part-13/">https://catlikecoding.com/unity/tutorials/rendering/part-13/</a></li>
<li><a href="https://gamedevelopment.tutsplus.com/articles/forward-rendering-vs-deferred-rendering--gamedev-12342">https://gamedevelopment.tutsplus.com/articles/forward-rendering-vs-deferred-rendering--gamedev-12342</a></li>
</ul>
<h3 id="forward-plus">Forward+</h3>
<p>URP also has a path called <strong>Forward+</strong>, which as the name suggests is similar to Forward, but it treats additional lights differently. Again, in order to remove the light limits per GameObject - without needing G-Buffers / MRT. (Though there are still <a href="https://docs.unity3d.com/Packages/com.unity.render-pipelines.universal@16.0/manual/urp-universal-renderer.html#real-time-lights-limitations">light limits per camera</a>)</p>
<p>To support this, the shader should include the <code>_FORWARD_PLUS</code> keyword and the additional lights loop should be written in a particular way using macros from URP&rsquo;s ShaderLibrary. As examples, see the <code>AdditionalLights_float</code> function in my <a href="https://github.com/Cyanilux/URP_ShaderGraphCustomLighting/blob/main/CustomLighting.hlsl">Shader Graph Custom Lighting repo</a> or the <code>UniversalFragmentPBR</code>/<code>UniversalFragmentBlinnPhong</code> functions in the URP Shader Library - <a href="https://github.com/Unity-Technologies/Graphics/blob/master/Packages/com.unity.render-pipelines.universal/ShaderLibrary/Lighting.hlsl">Lighting.hlsl</a>.</p>
<p>Here&rsquo;s some docs pages related to these Rendering Paths which may provide more information :</p>
<ul>
<li>BiRP : <a href="https://docs.unity3d.com/Manual/RenderingPaths.html">https://docs.unity3d.com/Manual/RenderingPaths.html</a></li>
<li>URP : <a href="https://docs.unity3d.com/Packages/com.unity.render-pipelines.universal@16.0/manual/urp-universal-renderer.html">https://docs.unity3d.com/Packages/com.unity.render-pipelines.universal@16.0/manual/urp-universal-renderer.html</a></li>
<li>HDRP : <a href="https://docs.unity3d.com/Packages/com.unity.render-pipelines.high-definition@16.0/manual/Forward-And-Deferred-Rendering.html">https://docs.unity3d.com/Packages/com.unity.render-pipelines.high-definition@16.0/manual/Forward-And-Deferred-Rendering.html</a></li>
</ul>
<hr>
<h2 id="other-types">Other Types of Shaders</h2>
<p>In the built-in pipeline there&rsquo;s also <strong>Surface shaders</strong>, (which you can usually identify by the &ldquo;#pragma surface surf&rdquo; and &ldquo;surf&rdquo; function). Behind the scenes these generate a vertex and fragment shader while also handling calculations, such as lighting and shadows for you. However these types of shaders <strong>do not work in URP and HDRP</strong> (though possibly in the future there will be a SRP version). Shader Graph&rsquo;s PBR (or HDRP&rsquo;s Lit) Master nodes are already quite similar to surface shaders if you&rsquo;re okay with working with nodes.</p>
<p>As well as vertex and fragment shaders, there are other stages that can be involved for more complicated techniques, such as :</p>
<ul>
<li>Tesellation (<strong>domain</strong> and <strong>hull</strong> shaders), which convert triangles into smaller triangles, usually based on viewing distance, in order to add more detail to the mesh.</li>
<li><strong>Geometry</strong> shaders, which can add new geometry (e.g. triangles) for each vertex/triangle already in the mesh. For example, producing grass blades. It is worth nothing that the performance of geometry shaders isn&rsquo;t great and there may be better methods to achieve a similar effect.</li>
</ul>
<div class="img-center">
<a href="Pipeline.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="681" height="105" alt="(Image)" src="Pipeline.png" />
</a>
<p class="img-text">Shows how these extra stages fit into the pipeline.</br>(Though this is simplified and doesn&rsquo;t include steps like clipping, face culling, early z-test, z-test, blending, etc)</p>
</div>
<p>These additional shader stages aren&rsquo;t needed for every shader program, and aren&rsquo;t always supported on each platform/GPU. Both of these also aren&rsquo;t included/possible in Shader Graph (yet), so I won&rsquo;t be going over them in this post. You can likely find some examples for shader code online though, such as :</p>
<ul>
<li><a href="https://catlikecoding.com/unity/tutorials/advanced-rendering/tessellation/">https://catlikecoding.com/unity/tutorials/advanced-rendering/tessellation/</a></li>
<li><a href="https://halisavakis.com/my-take-on-shaders-geometry-shaders/">https://halisavakis.com/my-take-on-shaders-geometry-shaders/</a></li>
<li><a href="https://roystan.net/articles/grass-shader.html">https://roystan.net/articles/grass-shader.html</a></li>
<li><a href="https://github.com/Cyanilux/URP_GrassGeometryShader">https://github.com/Cyanilux/URP_GrassGeometryShader</a></li>
</ul>
<p>There is also <strong>Compute</strong> shaders, which run separately from the other shaders mentioned above. They are typically used for generating textures (e.g. an output using RWTexture2D<float4>) or geometry / other arbitrary data (e.g. RWStructuredBuffer<float3>, or with int, or a custom struct). These aren&rsquo;t the focus of this article though. If you&rsquo;re interested in learning more about compute shaders, take a look at tutorials like :</p>
<ul>
<li><a href="https://www.ronja-tutorials.com/2020/07/26/compute-shader.html">https://www.ronja-tutorials.com/2020/07/26/compute-shader.html</a></li>
<li><a href="http://kylehalladay.com/blog/tutorial/2014/06/27/Compute-Shaders-Are-Nifty.html">http://kylehalladay.com/blog/tutorial/2014/06/27/Compute-Shaders-Are-Nifty.html</a></li>
<li><a href="https://lexdev.net/tutorials/case_studies/frostpunk_heatmap.html">https://lexdev.net/tutorials/case_studies/frostpunk_heatmap.html</a></li>
</ul>
<hr>
<h2 id="materials">Materials &amp; Properties</h2>
<p>From a shader we can create <strong>Materials</strong>, which acts as containers for certain data (such as floats, vectors, textures, etc). This data is exposed by the shader using the <a href="https://docs.unity3d.com/Manual/SL-Properties.html">Properties</a> section of the Shaderlab syntax (or the Blackboard in the case of Shader Graph). These properties can then be edited for each material in the inspector.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span>Shader <span style="color:#e6db74">&#34;Example&#34;</span> {
</span></span><span style="display:flex;"><span>    Properties {
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// Property Name/Reference ( &#34;Display Name&#34;, Type) = Default Value</span>
</span></span><span style="display:flex;"><span>		_ExampleTex(<span style="color:#e6db74">&#34;Example Texture&#34;</span>, <span style="color:#ae81ff">2D</span>) = <span style="color:#e6db74">&#34;white&#34;</span> {}
</span></span><span style="display:flex;"><span>		_ExampleColor(<span style="color:#e6db74">&#34;Example Colour&#34;</span>, Color) = (<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>		_ExampleRange(<span style="color:#e6db74">&#34;Example Float Range&#34;</span>, Range(<span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">1.0</span>)) = <span style="color:#ae81ff">0.5</span>
</span></span><span style="display:flex;"><span>		_ExampleFloat(<span style="color:#e6db74">&#34;Example Float&#34;</span>, Float) = <span style="color:#ae81ff">1.0</span>
</span></span><span style="display:flex;"><span>		_ExampleVector(<span style="color:#e6db74">&#34;Example Vector&#34;</span>, Vector) = (<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>		...
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// See ShaderLab Properties docs page linked above for more info</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	...
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// Rest of the shader (SubShader, Passes, etc.)</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></td></tr></table>
</div>
</div>
<p>This allows multiple materials to share the same shader, but we can change textures and other settings to change how the result looks.</p>
<p>For example, the Standard shader that Unity provides (or URP/Lit, HDRP/Lit), can replicate many basic materials fairly well (e.g. plastic, metal, wood, stone, etc.) with the correct texture maps and other values (Albedo, Normal, Occlusion, Metallic/Specular, etc)</p>
<hr>
<h2 id="properties">Setting Properties from C#</h2>
<p>In order to set one of these properties from C#, we need a reference to the Material object and need to know the property name (Reference field in Shader Graph). In order to get the material we can do a few different things. One way is to use a public field :</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> Material material;</span></span></code></pre></td></tr></table>
</div>
</div>
<p>Then assign the material in the inspector. Setting the properties on the material using this method will always affect all objects that share that material though.</p>
<p>Alternatively, we can keep the material private and set it based on the value in the Renderer. e.g.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> Material material;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> Start(){
</span></span><span style="display:flex;"><span>	Renderer renderer = GetComponent&lt;Renderer&gt;();
</span></span><span style="display:flex;"><span>	material = renderer.sharedMaterial;
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// or :</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// material = renderer.material;</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></td></tr></table>
</div>
</div>
<p>This assumes the script is on the same GameObject as the Renderer (e.g. MeshRenderer).</p>
<p>We can then set a property using one of the &ldquo;Set&rdquo; functions. e.g. SetFloat, SetVector, SetTexture, SetColor listed under the <a href="https://docs.unity3d.com/ScriptReference/Material.html">Materials docs scripting page</a>. This could be in Start or Update (though it&rsquo;s better to only call it when the value actually needs to be changed).</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span><span style="color:#75715e">// e.g.</span>
</span></span><span style="display:flex;"><span>material.SetColor(<span style="color:#e6db74">&#34;_ExampleColor&#34;</span>, Color.red);</span></span></code></pre></td></tr></table>
</div>
</div>
<p>Here the &ldquo;_ExampleColor&rdquo; would be the name/reference of the property as defined in the shader. Typically, if you select the .shader (or .shadergraph) file in the Project window it will list the properties it has in the Inspector window.</p>
<p>You can also find them listed in the Properties section of the Shaderlab code. For Shader Graph, this is the &ldquo;Reference&rdquo; field that each property has, not to be confused with its display name.</p>
<p>Typically the reference starts with &ldquo;_&rdquo; as a naming convention. I believe this also helps to avoid errors as without it the reference might be something that is used by the shaderlab syntax already, but don&rsquo;t quote me on that. (e.g. &ldquo;Offset&rdquo; might error because of its <a href="https://docs.unity3d.com/Manual/SL-CullAndDepth.html">shaderlab usage</a>, but &ldquo;_Offset&rdquo; wont? Same with Cull, ZTest, Blend etc.)</p>
<hr>
<h2 id="properties-global">Global Shader Properties</h2>
<p>There are also Global shader properties, which can be set through the <a href="https://docs.unity3d.com/ScriptReference/Shader.html">Shader class</a> and it&rsquo;s static &ldquo;SetGlobal&rdquo; functions. e.g. SetGlobalFloat, SetGlobalVector, SetGlobalTexture, SetGlobalColor, etc.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span><span style="color:#75715e">// e.g.</span>
</span></span><span style="display:flex;"><span>Shader.SetGlobalColor(<span style="color:#e6db74">&#34;_GlobalColor&#34;</span>, Color.red);</span></span></code></pre></td></tr></table>
</div>
</div>
<p>In this example, the &ldquo;_GlobalColor&rdquo; property can be defined by any shader that needs access to the colour in the same way a regular property would be used, except it doesn&rsquo;t need to be in the exposed Shaderlab Properties section.</p>
<p>In Shader Graph, each property in the Blackboard has an Exposed tickbox instead. Unexposed ones won&rsquo;t appear in the material inspector but can still be set by using these SetGlobal functions.</p>
<hr>
<h2 id="material-instances">Material Instances &amp; Batching</h2>
<p>It&rsquo;s important to understand the difference between <code>renderer.sharedMaterial</code> and <code>renderer.material</code> when dealing with obtaining the material to change it&rsquo;s properties.</p>
<p>Using <code>.sharedMaterial</code>, as the name might suggest gives you the material shared by all objects. This means that changing a property on it will affect <strong>all</strong> objects (similar to setting properties on a <code>public Material</code>).</p>
<p>Using <code>.material</code> instead <strong>creates a new instance</strong> (clone) of the material the first time it is called, and automatically assigns it to the renderer. Setting a property using this will only affect that object. However note that it is also your responsibility to destroy this material instance when it is no longer needed. e.g. in OnDestroy :</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> Material material;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> Start(){
</span></span><span style="display:flex;"><span>	Renderer renderer = GetComponent&lt;Renderer&gt;();
</span></span><span style="display:flex;"><span>	material = renderer.material;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> OnDestroy(){
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// if using renderer.material, need to destroy the instance when it is no longer used :</span>
</span></span><span style="display:flex;"><span>	Destroy(material);
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// or Destroy(GetComponent&lt;Renderer&gt;().material); if not caching it in a private variable</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></td></tr></table>
</div>
</div>
<p>Typically for the built-in pipeline using many material instances is bad, as it breaks <strong>Batching</strong> - which typically combines meshes that use the same material together so they can be drawn all at once, rather than separately. This can help with performance - though it is worth noting that since it combines meshes, certain data (like the Model matrix, <code>UNITY_MATRIX_M</code> / <code>Unity_ObjectToWorld</code> and inverse ones) is no longer on a per-object basis which may lead to unintended results if the shader relies on Object space.</p>
<p>When referring to batching, there&rsquo;s a few difference types, see docs pages linked below for more details :</p>
<ul>
<li><a href="https://docs.unity3d.com/Manual/static-batching.html">Static Batching</a> - Requires GameObjects to be marked as <a href="https://docs.unity3d.com/Manual/StaticObjects.html">static</a> (or at least have the &ldquo;Batching Static&rdquo; flag enabled). This combines meshes that share the same material into one large mesh, in order to reduce the number of draw calls required to render those objects.</li>
<li><a href="https://docs.unity3d.com/Manual/dynamic-batching.html">Dynamic Batching</a> - Always used for Particles, Sprites. Can be enabled for meshes too (would likely only do this in Built-in RP). Similar to static batching, but according to the docs vertices are transformed into world space on the CPU. On modern devices, this can be more expensive than the regular draw call overhead.</li>
<li><a href="https://docs.unity3d.com/Manual/SRPBatcher.html">SRP Batching</a> - For SRPs (e.g. URP, HDRP, Custom SRP). This batches the <em>setup between</em> draw calls in order to make them cheaper, rather than combining meshes. Material data is also persistent on GPU. Next section goes into a bit more detail.</li>
</ul>
<p>Similar to batching, another way to draw lots of objects together but still have different material values is to use <a href="https://docs.unity3d.com/Manual/GPUInstancing.html">GPU Instancing</a> and <a href="https://docs.unity3d.com/ScriptReference/MaterialPropertyBlock.html">Material Property Blocks</a> together. MPBs can also be used without GPU Instancing, however it will still lead to separate draw calls so there will be little performance benefit without also making the shader support instancing.</p>
<hr>
<h2 id="srp-batcher">SRP Batcher</h2>
<p>The Scriptable Render Pipelines (URP or HDRP) also have another method of batching - the <strong>SRP Batcher</strong>.</p>
<p>Rather than combining meshes / draw calls, it batches the <em>setup between</em> those draw calls. According to the <a href="https://docs.unity3d.com/Manual/SRPBatcher.html">docs page</a>, materials also have persistent constant buffers (UnityPerMaterial CBUFFERs) located in GPU memory, that would only need updating when properties change.</p>
<p>This type of batching works even with different material instances (as long as they share the same shader variant - they won&rsquo;t batch if materials use different keywords or shaders). So in the SRPs (URP, HDRP and Custom SRP), it&rsquo;s actually safe to use <code>renderer.material</code> to edit properties without breaking these batches. They&rsquo;ll likely still produce some memory overhead though. Of course, you should still use <code>.sharedMaterial</code> to avoid creating instances where they aren&rsquo;t necessary.</p>
<p>Also, since the SRP Batcher doesn&rsquo;t combine meshes, the Model matrix and it&rsquo;s inverse stays intact. Object space can be used in the shader without the unintended results you would get with the other batching methods.</p>
<p>Shaders created using Shader Graph will automatically support the SRP Batcher, but custom HLSL code shaders need to define a <strong>UnityPerMaterial CBUFFER</strong>. This should contain all the per-material properties except for textures. Every pass in the shader needs to use the same CBUFFER values, so I&rsquo;d recommend putting it inside the SubShader in HLSLINCLUDE tags, as this will automatically include it in every pass for you.</p>
<p>It also needs a <strong>UnityPerDraw CBUFFER</strong>, but this is set up automatically by URP/HDRP when using the correct include files.</p>
<p>The following example would work for URP (assuming these floats/vectors are also defined in the Properties block) :</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>HLSLINCLUDE
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;Packages/com.unity.render-pipelines.universal/ShaderLibrary/Core.hlsl&#34;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    CBUFFER_START(UnityPerMaterial)
</span></span><span style="display:flex;"><span>    float4 _ExampleTexture_ST; <span style="color:#75715e">// Tiling &amp; Offset values for a texture
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    float4 _ExampleColor;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">float</span> _ExampleRange;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">float</span> _ExampleFloat;
</span></span><span style="display:flex;"><span>    float4 _ExampleVector;
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// etc.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    CBUFFER_END
</span></span><span style="display:flex;"><span>ENDHLSL</span></span></code></pre></td></tr></table>
</div>
</div>
<p>You can find some full examples in my <a href="https://www.cyanilux.com/tutorials/urp-shader-code/">Writing Shader Code for URP (v2)</a> article.</p>
<p>Note that <strong>Material Property Blocks</strong> will break batching via the SRP Batcher so must be avoided in URP/HDRP. You can see what is being batched by using the <a href="https://docs.unity3d.com/Manual/FrameDebugger.html">Frame Debugger</a> window to check if it&rsquo;s working properly or not (e.g. would be displayed as &ldquo;SRP Batch&rdquo; rather than Draw commands)
<br><hr>

<div style="display:block;text-align: center">
<h2>Thanks for reading! 😊</h2>
<p> If this post helped, consider sharing a link with others!</p>
</div>

<div class="footer-btns">
<script type='text/javascript' src='https://storage.ko-fi.com/cdn/widget/Widget_2.js'></script><script type='text/javascript'>kofiwidget2.init('Support me on Ko-fi! ✨', '#e664fa', 'X8X0J5MD6');kofiwidget2.draw();</script>
<a href="http://discord.gg/2V93q9w">
<div class="btn-discord">
<img class="img" src="https://www.cyanilux.com/logo-discord-2.png" alt="Discord" style="width:22px">
Join my discord! 💬
</img>
</div>
</a>
</div></p>


        </div>
        </br>

<p class="footer"><a class="small-text" href="https://twitter.com/Cyanilux">© 2019-2023 Cyanilux </a></p>

<p class="small-text" style="text-align:center;">



	<a href="https://www.cyanilux.com/#license">
	
	License / Usage
	</a>
	 &#8212; 

	<a href="https://www.cyanilux.com/cookies">
	
	Cookies & Privacy
	</a>
	 &#8212; 

	<a href="https://www.cyanilux.com/index.xml">
	
	RSS Feed
	</a>
	

</p>
</br>

<div class="cookie-container">
<p>Hello! This site uses cookies related to Twitter (for showing embedded tweets) &amp; Google Analytics (to provide anonymous stats about which web pages are visited, links clicked, etc). These help with improving the website and letting me know what content is popular. 
See the <a href="https://www.cyanilux.com/cookies">Cookies & Privacy</a> page for more info.</p>
<button class="cookie-accept-btn"><b>Accept</b></button>
<button class="cookie-refuse-btn"><b>Refuse</b></button>
</div>

<script>
	var webStorageSupported = (typeof(Storage) !== undefined);
	
	function setCookie(cname, cvalue, exdays) {
		var d = new Date();
		d.setTime(d.getTime() + (exdays*24*60*60*1000));
		var expires = "expires="+ d.toUTCString();
		document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
	}
	
	const cookieContainer = document.querySelector(".cookie-container");
	const cookieAcceptButton = document.querySelector(".cookie-accept-btn");
	const cookieRefuseButton = document.querySelector(".cookie-refuse-btn");
	
	cookieAcceptButton.addEventListener("click", () => {
		cookieContainer.classList.remove("active");
	
		if (webStorageSupported){
			localStorage.setItem("cookiesAccepted", "true");
		}else{
			
			setCookie("cookiesAccepted", "true", 365);
		}
		
		location.reload();
	});
	
	cookieRefuseButton.addEventListener("click", () => {
		cookieContainer.classList.remove("active");
	
		
		
		document.cookie.split(";").forEach(function(c) { document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/"); });
		
		if (webStorageSupported){
			localStorage.setItem("cookiesAccepted", "false");
		}else{
			
			setCookie("cookiesAccepted", "false", 14);
		}
	});
	
	setTimeout(() => {
		if (showBanner) {
			cookieContainer.classList.add("active");
		}
	}, 1000);
</script>
    </body>
</html>
