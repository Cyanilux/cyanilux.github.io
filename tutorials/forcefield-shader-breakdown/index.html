<!DOCTYPE html>
<html lang="en">
    <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
	
	<link rel="apple-touch-icon" sizes="180x180" href="https://www.cyanilux.com/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="https://www.cyanilux.com/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="https://www.cyanilux.com/favicon-16x16.png">
	<link rel="manifest" href="https://www.cyanilux.com/site.webmanifest">
	<meta name="msapplication-TileColor" content="#00aba9">
	<meta name="theme-color" content="#ffffff">
	
	
    <link rel="stylesheet" type="text/css" href="https://www.cyanilux.com/css/style.css?v=5 ">
	
	<meta itemprop="name" content="Forcefield Shader Breakdown">
<meta itemprop="description" content="A forcefield shader using fresnel effect for glowing edges, scene depth for object intersections and scene colour to produce ripples/distortion"><meta itemprop="datePublished" content="2019-09-04T00:00:00+00:00" />
<meta itemprop="dateModified" content="2019-09-04T00:00:00+00:00" />
<meta itemprop="wordCount" content="3059"><meta itemprop="image" content="https://www.cyanilux.com/Preview.png">
<meta itemprop="keywords" content="URP,Shader Graph," />
	
	
	<meta name="twitter:card" content="summary_large_image"/>
	<meta name="twitter:image" content="https://www.cyanilux.com/tutorials/forcefield-shader-breakdown/Preview.png"/>
<meta name="twitter:title" content="Forcefield Shader Breakdown"/>
<meta name="twitter:description" content="A forcefield shader using fresnel effect for glowing edges, scene depth for object intersections and scene colour to produce ripples/distortion"/>

	
<meta property="og:title" content="Forcefield Shader Breakdown" />
<meta property="og:description" content="A forcefield shader using fresnel effect for glowing edges, scene depth for object intersections and scene colour to produce ripples/distortion" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.cyanilux.com/tutorials/forcefield-shader-breakdown/" />

	
        
        
            <meta name="og:image" content="https://www.cyanilux.com/tutorials/forcefield-shader-breakdown/Preview.png"/>
        
    
<meta property="article:published_time" content="2019-09-04T00:00:00+00:00" />
<meta property="article:modified_time" content="2019-09-04T00:00:00+00:00" />
	
	
	
    
    
    <title>Forcefield Shader Breakdown | Cyanilux</title>
	
	
	
		
		
		<meta name="description" content="A forcefield shader using fresnel effect for glowing edges, scene depth for object intersections and scene colour to produce ripples/distortion. URP, Shader Graph | Unity Shader Tutorials, @Cyanilux" />
		
	
	
	
	<link rel="canonical" href="https://www.cyanilux.com/tutorials/forcefield-shader-breakdown/" />
	
	
	<div class="cookie-container">
	  <p>Hello! This site uses cookies related to Twitter (for showing embedded tweets) &amp; Google Analytics (to provide anonymous stats about which web pages are visited, links clicked, etc). These help with improving the website and letting me know what content is popular. 
	  See the <a href="https://www.cyanilux.com/cookies">Cookies & Privacy</a> page for more info.</p>
	  <button class="cookie-accept-btn"><b>Accept</b></button>
	  <button class="cookie-refuse-btn"><b>Refuse</b></button>
	</div>
	
	<script>
	var webStorageSupported = (typeof(Storage) !== undefined);
	
	function setCookie(cname, cvalue, exdays) {
		var d = new Date();
		d.setTime(d.getTime() + (exdays*24*60*60*1000));
		var expires = "expires="+ d.toUTCString();
		document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
	}
	
	function getCookie(cname) {
		var name = cname + "=";
		var decodedCookie = decodeURIComponent(document.cookie);
		var ca = decodedCookie.split(';');
		for(var i = 0; i <ca.length; i++) {
			var c = ca[i];
			while (c.charAt(0) == ' ') {
				c = c.substring(1);
			}
			if (c.indexOf(name) == 0) {
				return c.substring(name.length, c.length);
			}
		}
		return "";
	}
	
	const cookieContainer = document.querySelector(".cookie-container");
	const cookieAcceptButton = document.querySelector(".cookie-accept-btn");
	const cookieRefuseButton = document.querySelector(".cookie-refuse-btn");
	
	cookieAcceptButton.addEventListener("click", () => {
		cookieContainer.classList.remove("active");
	  
		if (webStorageSupported){
			localStorage.setItem("cookiesAccepted", "true");
		}else{
			
			setCookie("cookiesAccepted", "true", 365);
		}
		
		location.reload();
	});
	
	cookieRefuseButton.addEventListener("click", () => {
		cookieContainer.classList.remove("active");
	  
		
		
		document.cookie.split(";").forEach(function(c) { document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/"); });
		
		if (webStorageSupported){
			localStorage.setItem("cookiesAccepted", "false");
		}else{
			
			setCookie("cookiesAccepted", "false", 14);
		}
	});
	
	var cookie;
	if (webStorageSupported){
		cookie = localStorage.getItem("cookiesAccepted");
	}else{
		cookie = getCookie("cookiesAccepted");
	}
	
	var showBanner = false;
	var cookiesAccepted = false;
	if (cookie == "true"){
		cookiesAccepted = true;
		showBanner = false;
	}else if (cookie === null || cookie == ""){
		showBanner = true;
	}
	
	setTimeout(() => {
		if (showBanner) {
			cookieContainer.classList.add("active");
		}
	}, 1000);
	
	</script>
	
	
	
	<script>
	if (cookiesAccepted){
		
		document.write("<script async src=\"https://www.googletagmanager.com/gtag/js?id=G-11MK1LK6C3\"><\/script>" +
		"<script>\n"+
		"window.dataLayer = window.dataLayer || [];\n" +
		"function gtag(){dataLayer.push(arguments);}\n" +
		"gtag('js', new Date());\n" +
		"gtag('config', 'G-11MK1LK6C3', { 'anonymize_ip': true });\n" + 
		"<\/script>");
	}
	</script>
	
</head>
    <body>
        
<div class="header">
	<div class="logo-header-div"> 
	<a class="link-plain" href="https://www.cyanilux.com">
		<img class="logo" alt="Logo" width="128" height="128" src="https://www.cyanilux.com/logo-small.png"/>
	</a>
	<div class="logo-text-div">
		<h1 class="title-no-margin">
			<a class="logo-text" href="https://www.cyanilux.com">Cyanilux</a>
		</h1>
		<b class="logo-subtext">Game Dev Blog &amp; Tutorials</b>
	</div>
	</div>
	
	<div class="nav-links-div">
	<nav id="nav-links" class="nav-links">
		<ul>
			
			<li><a class="nav-link" href="https://twitter.com/Cyanilux">
			<img src="https://www.cyanilux.com/logo-twitter.png" alt="Twitter"></img>
			</a>
			</li>
			
			<li><a class="nav-link" href="https://mastodon.gamedev.place/@Cyanilux">
			<img src="https://www.cyanilux.com/logo-mastodon.png" alt="Mastodon"></img>
			</a>
			</li>
			
			<li><a class="nav-link" href="http://discord.gg/2V93q9w">
			<img src="https://www.cyanilux.com/logo-discord.png" alt="Discord"></img>
			</a>
			</li>
			
			<li><a class="nav-link" href="https://github.com/Cyanilux">
			<img src="https://www.cyanilux.com/logo-github.png" alt="Github"></img>
			</a>
			</li>
			
		</ul>
	</nav>
	</div>
	
	<nav id="nav" class="nav">
	<ul>
		
		<li><b><a class="nav-link" href="https://www.cyanilux.com/contents/">
		Contents
		</a></b>
		</li>
		
		<li><b><a class="nav-link" href="https://www.cyanilux.com/recent/">
		Recent Posts
		</a></b>
		</li>
		
		<li><b><a class="nav-link" href="https://www.cyanilux.com/resources/">
		Resources
		</a></b>
		</li>
		
		<li><b><a class="nav-link" href="https://www.cyanilux.com/faq/">
		FAQ
		</a></b>
		</li>
		
	</ul>
	</nav>
</div>
        <div class="content">
        

<h1>Forcefield Shader Breakdown</h1>
<div class="post-metadata">


<div class="tag" style="background-color:#505050;">
	<a href="https://www.cyanilux.com/tutorials/breakdowns/" style="text-decoration: none; color:#eeeeee;">
	Breakdowns
	</a>
</div>




	<div class="tag" style="background-color:#00aabb;">
	
	<a href="https://www.cyanilux.com/tags/urp" style="text-decoration: none; color:#eeeeee;">
	URP
	</a>
	</div>

	<div class="tag" style="background-color:#101010;">
	
	<a href="https://www.cyanilux.com/tags/shader-graph" style="text-decoration: none; color:#eeeeee;">
	Shader Graph
	</a>
	</div>



<div style="width:10px"></div>


<time datetime="2019-09-04">&#128337 Sep 4, 2019</time>

</div>
<script>
	if (cookiesAccepted){
		document.write("\u003cblockquote class=\"twitter-tweet\" data-dnt=\"true\" data-theme=\"dark\"\u003e\u003cp lang=\"en\" dir=\"ltr\"\u003eMore forcefield stuff! üåê I added some distortion ripples so it can react to collisions/damage. Currently just passing through random points on the sphere. See thread for more details. \u003ca href=\"https://twitter.com/hashtag/unity3D?src=hash\u0026amp;ref_src=twsrc%5Etfw\"\u003e#unity3D\u003c/a\u003e \u003ca href=\"https://twitter.com/hashtag/madewithunity?src=hash\u0026amp;ref_src=twsrc%5Etfw\"\u003e#madewithunity\u003c/a\u003e \u003ca href=\"https://twitter.com/hashtag/shaders?src=hash\u0026amp;ref_src=twsrc%5Etfw\"\u003e#shaders\u003c/a\u003e \u003ca href=\"https://twitter.com/hashtag/shadergraph?src=hash\u0026amp;ref_src=twsrc%5Etfw\"\u003e#shadergraph\u003c/a\u003e \u003ca href=\"https://twitter.com/hashtag/VFX?src=hash\u0026amp;ref_src=twsrc%5Etfw\"\u003e#VFX\u003c/a\u003e \u003ca href=\"https://twitter.com/hashtag/VFXFriday?src=hash\u0026amp;ref_src=twsrc%5Etfw\"\u003e#VFXFriday\u003c/a\u003e \u003ca href=\"https://t.co/JyouVAKPWQ\"\u003epic.twitter.com/JyouVAKPWQ\u003c/a\u003e\u003c/p\u003e\u0026mdash; Cyan ‚ú® (@Cyanilux) \u003ca href=\"https://twitter.com/Cyanilux/status/1162321274007367680?ref_src=twsrc%5Etfw\"\u003eAugust 16, 2019\u003c/a\u003e\u003c/blockquote\u003e\n\u003cscript async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"\u003e\u003c/script\u003e\n");
	}else{
		document.write("<hr><p><a href=\"https://twitter.com/Cyanilux/status/1162321274007367680\">https://twitter.com/Cyanilux/status/1162321274007367680</a><p>"+
		"<p style=\"color:#aaaaaa\">Cookies are not accepted so cannot show embedded tweet.<br>"+
		"<a style=\"color:#00aabb\" onclick=\""+
		"const cookieContainer = document.querySelector('.cookie-container');" +
		"cookieContainer.classList.add('active');" +
		"\">Click here</a> to show cookie dialog if you want to change that</p><hr>");
	}
</script>
<h2 id="intro">Intro</h2>
<p>This post is a more advanced version of the <a href="https://www.cyanilux.com/tutorials/forcefield-shader-breakdown-simple">Simple Forcefield Breakdown</a>. You don‚Äôt have to read that one first, but it might help with understanding this one further. This shader uses a rim / fresnel effect along with the camera&rsquo;s colour and depth textures to produce a spherical (or hemispherical (dome-shaped)) forcefield (or energy shield) that distorts the view through it, with glowing edges and intersections with objects in the scene. We will also add the ability to produce distortion ripples at points of collision with scene objects, through the use of a custom function.</p>
<h2 id="notes">Notes</h2>
<ul>
<li>This is an <strong>Unlit</strong> shader. <strong>Transparent</strong> surface mode and <strong>Alpha</strong> blending (but alpha will always be set to 1!)</li>
<li>If you are looking to make a forcefield without any distortion to visuals ‚Äì you should follow the simple version instead (linked above).</li>
<li>The distortion is created using the <b class="node">Scene Color</b> node, which in the URP (/LWRP if using older versions) only shows opaque objects (not sure about HDRP). Because of this, transparent objects will not be visible through the forcefield.</li>
<li>This may not be the most efficient way to achieve a forcefield effect with distortion. One of the main issues I encountered was trying to get both the front and back faces to be visible through the forcefield. Without distortion this is pretty easy as we can just use transparency, however when we add distortion through the use of the <b class="node">Scene Color</b> node we will need to only render the front faces. If we want back faces to be visible too, we would have to fake them entirely by assuming the shader is always going to be applied to a hemisphere. This is what I‚Äôll be doing in this post, but there may be alternatives ‚Äì such as using a multi-camera setup to render the scene, including the back faces of the forcefield, to a texture which can be sampled instead of using the <b class="node">Scene Color</b> node. Another alternative is to have the distortion completely separate on a post processing effect ‚Äì but you‚Äôll need another camera (or renderer feature) to render a specific layer of the scene to describe which parts should be distorted and in what direction (similar to this <a href="https://www.youtube.com/watch?v=xH5uUfeB2Go">Makin‚Äô Stuff Look Good video</a>).</li>
</ul>
<h2 id="breakdown">Breakdown</h2>
<p>Before we start, we need to click on the small cog on our <b class="node">Master</b> node and switch to <strong>Transparent</strong> rendering mode, with <strong>Alpha</strong> blending and keeping it to <strong>Single Sided</strong>. These will be important, as we will be using the <b class="node">Scene Color</b> and <b class="node">Scene Depth</b> nodes. If you aren&rsquo;t familiar with these you can read about them here : <a href="https://www.cyanilux.com/tutorials/scene-color">Scene Color</a> post, <a href="https://www.cyanilux.com/tutorials/depth/#scene-depth-node">Depth</a> post.</p>
<p>We‚Äôll first create a <b class="node">Fresnel Effect</b> node. This will output a value based on the mesh‚Äôs surface normal and view direction, producing what looks like a ‚Äúglow‚Äù around the edge of the object. We can increase the <strong>Power</strong> input to make this glow closer to the edges ‚Äì I‚Äôm using a value of <strong>8</strong>. For more info about this node see the <a href="https://www.cyanilux.com/tutorials/fresnel-effect">Fresnel Effect</a> post. I‚Äôm also putting this into a <b class="node">Multiply</b> with a value of <strong>2</strong> to make it a bit brighter.</p>
<div class="img-center">
<a href="Graph1.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="750" height="298" alt="(Image)" src="Graph1.png" />
</a>
<p class="img-text"></p>
</div>
<p>Next we‚Äôll handle the intersection effect with scene objects. To do this, we‚Äôll create a <b class="node">Screen Position</b> node with the mode set to <strong>Raw</strong> and put it into a <b class="node">Split</b>. This gives us the <strong>depth</strong> of the pixel/fragment on the surface of the object in the <strong>W/A</strong> component. We will also need to create a <b class="node">Scene Depth</b> node set to the <strong>Eye</strong> sampling mode.</p>
<p>Because we want this shader to support distortion later, this will be different from the intersection effect made in the simple version of this shader ‚Äì as we cannot use the <strong>Two Sided</strong> mode but still want the intersection to show for both front and back faces. The method I‚Äôm using for this is similar to what was done in the <a href="https://www.cyanilux.com/tutorials/water-shader-breakdown">Water Shader Breakdown</a> for the caustics effect. By knowing the position, object depth and the scene depth we can reconstruct the world position in the scene for that fragment, which we can then use to test if the fragment is on the edge of a hemisphere.</p>
<div class="notice">
<div style="background-color: #303030; margin-right: 10px;">
<div class="notice-exclamation">
!
</div>
</div>
<div style="margin: 5px;">
<p>In Shader Graph v11 (Unity 2021.1+) the <b class="node">View Direction</b> node is now normalised in all pipelines. We must use the newer <b class="node">View Vector</b> node to achieve the correct result.</p>
<p>(Text in this post has been changed to account for this, but images have not!)</p>
<p>If you are using prior versions of URP, continue using the <b class="node">View Direction</b>.</p>
<p>For HDRP, the graph at the end of the <a href="https://www.cyanilux.com/tutorials/fog-plane-shader-breakdown#hdrp">Fog Plane Shader Breakdown</a> may provide a better example.</p>

</div>
</div>
<p>To reconstruct this world position based on depth, create a <b class="node">View Vector</b> node set to <strong>World</strong> space, and <b class="node">Divide</b> it by the object‚Äôs depth from the <strong>W/A</strong> component of the <b class="node">Split</b> node from earlier. Then <b class="node">Multiply</b> it by the output from the <b class="node">Scene Depth</b> node. Create a <b class="node">Camera</b> node, and take the <strong>Position</strong> output and <b class="node">Subtract</b> the output from our <b class="node">Multiply</b>. If you aren‚Äôt sure about how this works, see the water or fog-plane breakdowns linked above.</p>
<div class="img-center">
<a href="Graph2.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="750" height="315" alt="(Image)" src="Graph2.png" />
</a>
<p class="img-text"></p>
</div>
<p>With this, we can do an intersection effect by comparing the distance from this position to the center of the forcefield (which will be at the object‚Äôs origin). Take the output of our worldspace scene position and put it into the <strong>A</strong> input on a <b class="node">Distance</b> node. In order to get the object‚Äôs worldspace origin we‚Äôll create an <b class="node">Object</b> node and take the <strong>Position</strong> output and put that into the <strong>B</strong> input.</p>
<p>Currently this gives us values of 0 close to the forcefield origin, while the further parts has a higher output. Since we want to draw the intersection effect on the edge of the forcefield we need to take the output from the <b class="node">Distance</b> and <b class="node">Subtract</b> a value from it (I‚Äôll come back to what value in a second), then take the <b class="node">Absolute</b>. This will push those distance values of 0 into negatives then uses the absolute to ‚Äúflip‚Äù them into the positive again.</p>
<p>The value in that <b class="node">Subtract</b> should be based on the forcefield scale. We can obtain this by taking the <strong>Scale</strong> output from the <b class="node">Object</b> node. This is a <strong>Vector3</strong> however, and we only want a <strong>Vector1</strong> so we‚Äôll put it into a <b class="node">Split</b> node and take the <strong>X/R</strong> component. You may also need to <b class="node">Multiply</b> this by an additional scaling value if the scale of the mesh doesn‚Äôt have a radius of 1 (aka 2 units wide).</p>
<p>We‚Äôll then take the output from the <b class="node">Absolute</b> and put it into a <b class="node">One Minus</b> node as we want values of 1 on the forcefield edge instead of 0, then put it into a <b class="node">Saturate</b> node and a <b class="node">Power</b> node with a second value of <strong>15</strong>. Then <b class="node">Add</b> the output of our fresnel‚Äôs <b class="node">Multiply</b> to this. We will then <b class="node">Multiply</b> by a <b class="node">Color</b> node (or property if you want to be able to edit it from the inspector), to tint the forcefield to a blue colour. I&rsquo;m also using <strong>HDR</strong> mode with an <strong>Intensity</strong> of <strong>2</strong>.</p>
<div class="img-center">
<a href="Graph3.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="750" height="270" alt="(Image)" src="Graph3.png" />
</a>
<p class="img-text"></p>
</div>
<p>If you temporarily put this into the <strong>Color</strong> input on the <b class="node">Master</b> node you should see that the forcefield is black, but you can see the blue edges where it intersects with objects in the scene. Unlike in the simple version of this we won‚Äôt be making the forcefield actually transparent as we want to add distortion. To do this we will use the <b class="node">Scene Color</b> node, which is a texture of all the opaque objects the camera has rendered. Before sampling this texture, we can offset the coordinates slightly to create distortions.</p>
<p>Create a <b class="node">Screen Position</b> node and put it into an <b class="node">Add</b> node in order to handle this offset, leaving the other input empty for now. Then put the output of this into a <b class="node">Scene Color</b> node. We‚Äôll then take the output of that and put it into the <strong>A</strong> input on a <b class="node">Lerp</b> node. Put the forcefield <b class="node">Color</b> node we used earlier into the <strong>B</strong> input and put a <b class="node">Vector1</b> node with a value of <strong>0.02</strong> in the <strong>T</strong> input. This will allow us to interpolate between the scene colour and the forcefield colour based on a value which will control the visibility. Due to the forcefield colour being quite intense, we will want to keep this value very small. We can now take the <b class="node">Lerp</b> output and <b class="node">Add</b> it with our other colour (the output of the <b class="node">Multiply</b> node from earlier) and put that into the <strong>Colour</strong> input on the <b class="node">Master</b> node. We should now see the scene through the forcefield, but it isn‚Äôt distorted yet.</p>
<div class="img-center">
<a href="Graph4.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="750" height="399" alt="(Image)" src="Graph4.png" />
</a>
<p class="img-text"></p>
</div>
<p>Going back to the <b class="node">Screen Position</b> node from before, we need to offset it in order to create the distortion. We‚Äôll use a <b class="node">Gradient Noise</b> node to do this, with a <strong>Scale</strong> value of <strong>25</strong>. As the output of this is between 0 and 1, we will want to <b class="node">Subtract</b> <strong>0.5</strong> to move it into the range of <strong>-0.5 to 0.5</strong> so we are distorting the view evenly in each direction. We can then <b class="node">Multiply</b> it by a small value such as <strong>0.01</strong>, to control the strength of the distortion, and put it into the second input on the <b class="node">Add</b> node (the one with the <b class="node">Screen Position</b> going into it).</p>
<p>We can also offset the <strong>UVs</strong> over time so that the distortion moves. Create a <b class="node">Time</b> node and take the <strong>Time</strong> output and <b class="node">Multiply</b> by a value of <strong>0.1</strong> to control the speed of the scrolling noise. Then put it into an <b class="node">Add</b> node with a <b class="node">Position</b> node set to <strong>View</strong> space. Put the output of this into the <strong>UV</strong> input on the <b class="node">Gradient Noise</b> node.</p>
<div class="img-center">
<a href="Graph5.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="750" height="404" alt="(Image)" src="Graph5.png" />
</a>
<p class="img-text"></p>
</div>
<h2 id="ripples">Ripples</h2>
<p>So far we have a nice forcefield effect, but one of the things I wanted to add was a rippling reaction with projectiles that are fired at the forcefield as seen in the GIF in the original tweet. In order to do this we need to use a <b class="node">Custom Function</b> node, as we need access to a couple things that aren‚Äôt yet supported in shadergraph normally. This function will output a <strong>Vector3 distortion direction</strong> which we will use to further offset the <b class="node">Screen Position</b> going into the <b class="node">Scene Color</b> node. It will also output a <strong>Vector1</strong> value which will allow us to colour the ripple slightly to make it more obvious. Note that I‚Äôm focusing on the front faces only here ‚Äì it may be possible to extend it to the back faces too, however I won‚Äôt be going through that in this post.</p>
<p>In order to allow for multiple ripples to be handled at the same time, we will need an <strong>array</strong> to store the positions of the origin of each ripple. We will then also need another value to control the lifetime of the ripple. To send these points into the shader we will need a <strong>C# Script</strong>, which will also control updating the lifetime and removing the point when it reaches a lifetime larger than 1. Since we have 4 values, we could use a <strong>Vector4/float4</strong> array for this ‚Äì but as we might want to add more values to control further things (such as power/scale, perhaps even a different colour for each ripple) I will be using a <strong>float array</strong>.</p>
<p>It is possible to have arrays in shaders. Although shadergraph doesn‚Äôt support them normally we can still use a <b class="node">Custom Function</b> node to declare the array and loop through it. We will need to be using the <strong>File</strong> mode in order to do this, as it needs to be specified outside of the function itself (which can&rsquo;t be done using the <strong>String</strong> mode).</p>
<p>When defining the array we also need to specify a fixed length. We‚Äôll be allowing our shader to store up to 6 ripple points, each having 4 components (3 of which are the XYZ position, and the final being the lifetime, as mentioned before), this means we need an array of length <strong>6*4</strong>. We‚Äôll come back to the actual shader function later.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span>uniform <span style="color:#66d9ef">float</span> _Points[<span style="color:#ae81ff">6</span>*<span style="color:#ae81ff">4</span>];</span></span></code></pre></td></tr></table>
</div>
</div>
<p>If you want more information about arrays in shaders see this article by <a href="https://www.alanzucconi.com/2016/10/24/arrays-shaders-unity-5-4/">Alan Zucconi</a>.</p>
<p>In order to initialise the array it has to be done externally, via a <strong>C# Script</strong> using <strong>Material.SetFloatArray(array)</strong>.</p>
<p>The script I‚Äôm using looks like the following :</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span><span style="color:#66d9ef">using</span> UnityEngine;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">[ExecuteInEditMode]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ArrayTest</span> : MonoBehaviour {
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Material material;
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Initalize Array</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// This should have the same length as in the shader!</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">float</span>[] points = <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">float</span>[] {
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0.1f</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0.2f</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0.4f</span>,
</span></span><span style="display:flex;"><span>        -<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0.5f</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">0</span>, -<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0.6f</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, -<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0.8f</span>,
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// These values here are used for testing purposes to see if it&#39;s working.</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// Basically a ripple in each axis direction, each with a different radius.</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> Update(){
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (material == <span style="color:#66d9ef">null</span>) <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i = <span style="color:#ae81ff">0</span>; i &lt; points.Length; i += <span style="color:#ae81ff">4</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">float</span> t = points[i + <span style="color:#ae81ff">3</span>];
</span></span><span style="display:flex;"><span>            t += Time.deltaTime;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (t &gt; <span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// Lifetime Complete</span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// Create a new random point</span>
</span></span><span style="display:flex;"><span>                t = <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>                Vector3 sphere = Random.onUnitSphere;
</span></span><span style="display:flex;"><span>                 
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// Keep it in the top hemisphere - leave this out for a sphere!</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (sphere.y &lt; <span style="color:#ae81ff">0</span>) sphere.y = -sphere.y;
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// Set position</span>
</span></span><span style="display:flex;"><span>                points[i] = sphere.x;
</span></span><span style="display:flex;"><span>                points[i + <span style="color:#ae81ff">1</span>] = sphere.y;
</span></span><span style="display:flex;"><span>                points[i + <span style="color:#ae81ff">2</span>] = sphere.z;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Set lifetime</span>
</span></span><span style="display:flex;"><span>            points[i + <span style="color:#ae81ff">3</span>] = t;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        material.SetFloatArray(<span style="color:#e6db74">&#34;_Points&#34;</span>, points);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></td></tr></table>
</div>
</div>
<p>This script is just replacing the points in the array with random points when they reach the lifetime of 1 ‚Äì so we get constant rippling effects for testing purposes. I won‚Äôt be going through the script for actual gameplay mechanics, but you would want to be able to:</p>
<ul>
<li>Add points based on collisions (e.g. MonoBehaviour.OnCollisionEnter/OnTriggerEnter). If there are no spaces for new points (if there are more than 6 collisions at once) but we want to add one, we would likely want to loop through the array and find the one with the largest lifetime and replace it with the new point.</li>
<li>‚ÄúRemove‚Äù points when they reach their lifetime of 1. Note : It‚Äôs important that the array length stays fixed and data is present when sending it to the shader so it can replace it correctly ‚Äì so for removing points you will need to specify the values still, giving { 0, 0, 0, 2 } or something, where in the loop if the lifetime is 2 we know it‚Äôs a space for a new point, and our shader function should be outputting 0 to prevent anything being rendered for that point.</li>
</ul>
<p>The following is the shader function used by the <b class="node">Custom Function</b> node :</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span>uniform <span style="color:#66d9ef">float</span> _Points[<span style="color:#ae81ff">6</span>*<span style="color:#ae81ff">4</span>];
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> Test_float(float3 position, <span style="color:#66d9ef">out</span> float3 direction, <span style="color:#66d9ef">out</span> <span style="color:#66d9ef">float</span> strength){
</span></span><span style="display:flex;"><span>    float3 directionOutput = <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">float</span> strengthOutput = <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">     
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [unroll]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i = <span style="color:#ae81ff">0</span>; i &lt; <span style="color:#ae81ff">6</span>*<span style="color:#ae81ff">4</span>; i += <span style="color:#ae81ff">4</span>){
</span></span><span style="display:flex;"><span>        float3 p = float3(_Points[i], _Points[i+<span style="color:#ae81ff">1</span>], _Points[i+<span style="color:#ae81ff">2</span>]); <span style="color:#75715e">// Position</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">float</span> t = _Points[i+<span style="color:#ae81ff">3</span>]; <span style="color:#75715e">// Lifetime</span>
</span></span><span style="display:flex;"><span>         
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Ripple Shape :</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">float</span> rippleSize = <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">float</span> gradient = smoothstep(t/<span style="color:#ae81ff">3</span>, t, distance(position, p) / rippleSize);
</span></span><span style="display:flex;"><span>         
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// frac means it will have a sharp edge, while sine makes it more &#34;soft&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//float ripple = frac(gradient);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">float</span> ripple = saturate(sin(<span style="color:#ae81ff">5</span> * (gradient)));
</span></span><span style="display:flex;"><span>         
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Distortion Direction &amp; Strength :</span>
</span></span><span style="display:flex;"><span>        float3 rippleDirection = normalize(position-p);
</span></span><span style="display:flex;"><span>         
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">float</span> lifetimeFade = saturate(<span style="color:#ae81ff">1</span>-t); <span style="color:#75715e">// Goes from 1 at t=0, to 0 at t=1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">float</span> rippleStrength = lifetimeFade * ripple;
</span></span><span style="display:flex;"><span>         
</span></span><span style="display:flex;"><span>        directionOutput += rippleDirection * rippleStrength * <span style="color:#ae81ff">0.2</span>;
</span></span><span style="display:flex;"><span>        strengthOutput += rippleStrength;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>     
</span></span><span style="display:flex;"><span>    direction = directionOutput;
</span></span><span style="display:flex;"><span>    strength = strengthOutput;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></td></tr></table>
</div>
</div>
<p>We specify the function inside the ‚Äúvoid Test_float‚Äù, where the name of the function has to match the one given in the <b class="node">Custom Function</b> node, in this case it was named <strong>‚ÄúTest‚Äù</strong> ‚Äì (But you can call it whatever you want)</p>
<p>We create some variables to hold the outputs, then loop through the array with the same length of <strong>6*4</strong> with ‚Äúi += 4‚Äù so we can obtain all 4 values for each point in each iteration of the loop. We read the position and lifetime from the array via ‚Äú_Points[i+n]‚Äù then set up the shape of the ripple based on the distance from the fragment‚Äôs position we passed in, and the point‚Äôs position.</p>
<p>This function needs to be saved in a <strong>HLSL File</strong> (in this case I saved in under ‚Äútest2.hlsl‚Äù, but call it whatever you want). Set the file as the source on the <b class="node">Custom Function</b> node by clicking the cog icon on it. We also need to make sure we have a <strong>Vector3</strong> input, and the <strong>Vector3</strong> and <strong>Vector1</strong> outputs defined on the node (I‚Äôve named these Position, Direction and Ripple, they don‚Äôt have to match the same names as the function code ‚Äì but they do have to be in the correct order).</p>
<div class="img-center">
<a href="Graph6.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="510" height="315" alt="(Image)" src="Graph6.png" />
</a>
<p class="img-text"></p>
</div>
<p>We next need to take the <strong>Direction</strong> output from our <b class="node">Custom Function</b> node and put it into a <b class="node">Transform</b> node from <strong>World</strong> to <strong>View</strong> space in <strong>Direction</strong> mode. We can then take the output of that and <b class="node">Add</b> it to where we are offsetting the <b class="node">Screen Position</b> into the <b class="node">Scene Color</b> node.</p>
<p>Also, take the <strong>Ripple</strong> output from the <b class="node">Custom Function</b>, <b class="node">Multiply</b> it by <strong>0.4</strong> then <b class="node">Add</b> it to the colour output right before the <b class="node">Multiply</b> with the forcefield colour.</p>
<div class="img-center">
<a href="Graph7.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="750" height="314" alt="(Image)" src="Graph7.png" />
</a>
<p class="img-text"></p>
</div>
<p>We should also take the distorted screen position output (from the <b class="node">Add</b> node, before going into the <b class="node">Scene Color</b>) and put it into the input of the <b class="node">Scene Depth</b> node we made earlier. This will make sure we sample the distorted depth value so the intersection effect will be accurate to what is being viewed through the forcefield. I haven‚Äôt put these nodes close together so this will put a long line across our graph, hence why I‚Äôve left this last to prevent confusion with other node connections.</p>
<p>Here‚Äôs a final image of the full graph, also showing that connection :</p>
<div class="img-center">
<a href="GraphFull.png" target="_blank" rel="noopener noreferrer">
<img loading="lazy" width="750" height="359" alt="(Image)" src="GraphFull.png" />
</a>
<p class="img-text"></p>
</div>
<br><hr>

<div style="display:block;text-align: center">
<h2>Thanks for reading!</h2>
<p> If this post helped, consider sharing a link with others!</p>
</div>

<div class="footer-btns">
<script type='text/javascript' src='https://storage.ko-fi.com/cdn/widget/Widget_2.js'></script><script type='text/javascript'>kofiwidget2.init('Support me on Ko-fi! ‚ú®', '#e664fa', 'X8X0J5MD6');kofiwidget2.draw();</script>
<a href="http://discord.gg/2V93q9w">
<div class="btn-discord">
<img class="img" src="https://www.cyanilux.com/logo-discord-2.png" alt="Discord" style="width:22px">
Join my discord! üí¨
</img>
</div>
</a>
</div>


        </div>
        </br>
<p class="footer">
<a class="small-text" href="https://twitter.com/Cyanilux">¬© Cyanilux</a>
	<p class="small-text" style="text-align:center;">
	
	
	
		<a href="https://www.cyanilux.com/#license">
		
		License / Usage
		</a>
		 &#8212; 
	
		<a href="https://www.cyanilux.com/cookies">
		
		Cookies & Privacy
		</a>
		 &#8212; 
	
		<a href="https://www.cyanilux.com/index.xml">
		
		RSS Feed
		</a>
		
	
	</p>
</p>
</br>
    </body>
</html>
